<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring容器的基本实现 | snote</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/snote/img/logo.png">
    <meta name="description" content="study note">
    
    <link rel="preload" href="/snote/assets/css/0.styles.733b32e4.css" as="style"><link rel="preload" href="/snote/assets/js/app.3cc04e36.js" as="script"><link rel="preload" href="/snote/assets/js/5.22329d81.js" as="script"><link rel="preload" href="/snote/assets/js/1.5e23c49c.js" as="script"><link rel="preload" href="/snote/assets/js/19.4e10afcb.js" as="script"><link rel="preload" href="/snote/assets/js/77.11cc1a2c.js" as="script"><link rel="prefetch" href="/snote/assets/js/10.1e6036a4.js"><link rel="prefetch" href="/snote/assets/js/100.e53901ab.js"><link rel="prefetch" href="/snote/assets/js/101.7ff3bf92.js"><link rel="prefetch" href="/snote/assets/js/102.72df3fb1.js"><link rel="prefetch" href="/snote/assets/js/103.39232b43.js"><link rel="prefetch" href="/snote/assets/js/104.19b1fd3c.js"><link rel="prefetch" href="/snote/assets/js/105.a9e362b5.js"><link rel="prefetch" href="/snote/assets/js/106.77930f24.js"><link rel="prefetch" href="/snote/assets/js/107.ea9f01d0.js"><link rel="prefetch" href="/snote/assets/js/108.7ff74d7c.js"><link rel="prefetch" href="/snote/assets/js/109.e55033b4.js"><link rel="prefetch" href="/snote/assets/js/11.9b2b7f36.js"><link rel="prefetch" href="/snote/assets/js/110.d399212c.js"><link rel="prefetch" href="/snote/assets/js/111.9ca56f5e.js"><link rel="prefetch" href="/snote/assets/js/112.97d8e09c.js"><link rel="prefetch" href="/snote/assets/js/113.b00a35d2.js"><link rel="prefetch" href="/snote/assets/js/114.7071cc16.js"><link rel="prefetch" href="/snote/assets/js/115.71bfbee0.js"><link rel="prefetch" href="/snote/assets/js/116.d3cc8989.js"><link rel="prefetch" href="/snote/assets/js/117.52c30bbd.js"><link rel="prefetch" href="/snote/assets/js/118.d17bd671.js"><link rel="prefetch" href="/snote/assets/js/119.17200614.js"><link rel="prefetch" href="/snote/assets/js/12.8e64e191.js"><link rel="prefetch" href="/snote/assets/js/120.c4c779cd.js"><link rel="prefetch" href="/snote/assets/js/121.6e65fbc1.js"><link rel="prefetch" href="/snote/assets/js/122.304ccf9d.js"><link rel="prefetch" href="/snote/assets/js/123.b744823c.js"><link rel="prefetch" href="/snote/assets/js/124.f5ab81c9.js"><link rel="prefetch" href="/snote/assets/js/125.aaa33725.js"><link rel="prefetch" href="/snote/assets/js/126.10649710.js"><link rel="prefetch" href="/snote/assets/js/127.f35b2900.js"><link rel="prefetch" href="/snote/assets/js/128.833a1e82.js"><link rel="prefetch" href="/snote/assets/js/129.83493639.js"><link rel="prefetch" href="/snote/assets/js/13.d156e68f.js"><link rel="prefetch" href="/snote/assets/js/130.3c356544.js"><link rel="prefetch" href="/snote/assets/js/131.77654b97.js"><link rel="prefetch" href="/snote/assets/js/132.3e636caa.js"><link rel="prefetch" href="/snote/assets/js/133.b8a7f38a.js"><link rel="prefetch" href="/snote/assets/js/134.35ccee41.js"><link rel="prefetch" href="/snote/assets/js/135.13f63617.js"><link rel="prefetch" href="/snote/assets/js/136.2cd53605.js"><link rel="prefetch" href="/snote/assets/js/137.8331c390.js"><link rel="prefetch" href="/snote/assets/js/138.0c433171.js"><link rel="prefetch" href="/snote/assets/js/139.a6287a10.js"><link rel="prefetch" href="/snote/assets/js/14.41b00a6a.js"><link rel="prefetch" href="/snote/assets/js/140.53857f35.js"><link rel="prefetch" href="/snote/assets/js/141.173a51f6.js"><link rel="prefetch" href="/snote/assets/js/142.ea2a40cd.js"><link rel="prefetch" href="/snote/assets/js/143.bf22752b.js"><link rel="prefetch" href="/snote/assets/js/144.ee4de6bb.js"><link rel="prefetch" href="/snote/assets/js/145.c3171214.js"><link rel="prefetch" href="/snote/assets/js/146.3784d416.js"><link rel="prefetch" href="/snote/assets/js/147.724d5523.js"><link rel="prefetch" href="/snote/assets/js/148.887b57b8.js"><link rel="prefetch" href="/snote/assets/js/149.365a3713.js"><link rel="prefetch" href="/snote/assets/js/15.d7973cb5.js"><link rel="prefetch" href="/snote/assets/js/150.5a119004.js"><link rel="prefetch" href="/snote/assets/js/151.35989bab.js"><link rel="prefetch" href="/snote/assets/js/152.a53a5bcf.js"><link rel="prefetch" href="/snote/assets/js/153.c49175be.js"><link rel="prefetch" href="/snote/assets/js/154.132d5c92.js"><link rel="prefetch" href="/snote/assets/js/155.4d2859d7.js"><link rel="prefetch" href="/snote/assets/js/156.24fa7e30.js"><link rel="prefetch" href="/snote/assets/js/157.d00b5ab7.js"><link rel="prefetch" href="/snote/assets/js/158.58345bf0.js"><link rel="prefetch" href="/snote/assets/js/159.30fd6c79.js"><link rel="prefetch" href="/snote/assets/js/16.2a0f8a1e.js"><link rel="prefetch" href="/snote/assets/js/160.0415e6c5.js"><link rel="prefetch" href="/snote/assets/js/161.af36ab6d.js"><link rel="prefetch" href="/snote/assets/js/162.3f15c754.js"><link rel="prefetch" href="/snote/assets/js/163.b29fc431.js"><link rel="prefetch" href="/snote/assets/js/164.9bcd2f56.js"><link rel="prefetch" href="/snote/assets/js/165.3b91ca92.js"><link rel="prefetch" href="/snote/assets/js/166.749c6ca6.js"><link rel="prefetch" href="/snote/assets/js/167.d48009c9.js"><link rel="prefetch" href="/snote/assets/js/168.c36d8d5d.js"><link rel="prefetch" href="/snote/assets/js/169.ae085a84.js"><link rel="prefetch" href="/snote/assets/js/17.4ffd4119.js"><link rel="prefetch" href="/snote/assets/js/170.fca3db2e.js"><link rel="prefetch" href="/snote/assets/js/171.7696e010.js"><link rel="prefetch" href="/snote/assets/js/172.1c40e807.js"><link rel="prefetch" href="/snote/assets/js/173.9b50a23b.js"><link rel="prefetch" href="/snote/assets/js/174.58befaba.js"><link rel="prefetch" href="/snote/assets/js/175.e1b9ba0f.js"><link rel="prefetch" href="/snote/assets/js/176.ec0983d0.js"><link rel="prefetch" href="/snote/assets/js/177.36734ab4.js"><link rel="prefetch" href="/snote/assets/js/178.fe90bfd6.js"><link rel="prefetch" href="/snote/assets/js/179.76053104.js"><link rel="prefetch" href="/snote/assets/js/18.f6fa6b40.js"><link rel="prefetch" href="/snote/assets/js/180.b015d622.js"><link rel="prefetch" href="/snote/assets/js/181.9b717ca0.js"><link rel="prefetch" href="/snote/assets/js/182.7f4cf041.js"><link rel="prefetch" href="/snote/assets/js/183.bb178fad.js"><link rel="prefetch" href="/snote/assets/js/184.7bcfa00d.js"><link rel="prefetch" href="/snote/assets/js/185.bca06eaf.js"><link rel="prefetch" href="/snote/assets/js/186.b5a2ae31.js"><link rel="prefetch" href="/snote/assets/js/187.54d67a16.js"><link rel="prefetch" href="/snote/assets/js/188.4c672878.js"><link rel="prefetch" href="/snote/assets/js/189.c4ff0da3.js"><link rel="prefetch" href="/snote/assets/js/190.c04cba39.js"><link rel="prefetch" href="/snote/assets/js/191.47277121.js"><link rel="prefetch" href="/snote/assets/js/192.2df35df1.js"><link rel="prefetch" href="/snote/assets/js/193.6522b845.js"><link rel="prefetch" href="/snote/assets/js/194.b0ab5764.js"><link rel="prefetch" href="/snote/assets/js/195.28c85e74.js"><link rel="prefetch" href="/snote/assets/js/196.6b6c7db3.js"><link rel="prefetch" href="/snote/assets/js/197.11fe146e.js"><link rel="prefetch" href="/snote/assets/js/198.d68ebf1f.js"><link rel="prefetch" href="/snote/assets/js/199.b813b835.js"><link rel="prefetch" href="/snote/assets/js/20.3b3c1d36.js"><link rel="prefetch" href="/snote/assets/js/200.b3956510.js"><link rel="prefetch" href="/snote/assets/js/201.9ae9098a.js"><link rel="prefetch" href="/snote/assets/js/202.a2a5abba.js"><link rel="prefetch" href="/snote/assets/js/203.6c78ac54.js"><link rel="prefetch" href="/snote/assets/js/204.07229555.js"><link rel="prefetch" href="/snote/assets/js/205.007d975e.js"><link rel="prefetch" href="/snote/assets/js/206.053c9ad1.js"><link rel="prefetch" href="/snote/assets/js/207.9dc2d2a1.js"><link rel="prefetch" href="/snote/assets/js/208.3ebf2372.js"><link rel="prefetch" href="/snote/assets/js/209.1bef9845.js"><link rel="prefetch" href="/snote/assets/js/21.54f98d7e.js"><link rel="prefetch" href="/snote/assets/js/210.d0a49b1e.js"><link rel="prefetch" href="/snote/assets/js/211.9867a469.js"><link rel="prefetch" href="/snote/assets/js/212.69fd5be2.js"><link rel="prefetch" href="/snote/assets/js/213.8f82a998.js"><link rel="prefetch" href="/snote/assets/js/214.823be3c5.js"><link rel="prefetch" href="/snote/assets/js/215.678426f8.js"><link rel="prefetch" href="/snote/assets/js/216.0564d748.js"><link rel="prefetch" href="/snote/assets/js/217.ea5120a3.js"><link rel="prefetch" href="/snote/assets/js/218.b259e9f5.js"><link rel="prefetch" href="/snote/assets/js/219.7103afc4.js"><link rel="prefetch" href="/snote/assets/js/22.2aac9b21.js"><link rel="prefetch" href="/snote/assets/js/220.294118e9.js"><link rel="prefetch" href="/snote/assets/js/221.fc705f9e.js"><link rel="prefetch" href="/snote/assets/js/222.82415480.js"><link rel="prefetch" href="/snote/assets/js/223.34d2d18a.js"><link rel="prefetch" href="/snote/assets/js/224.0dae4c03.js"><link rel="prefetch" href="/snote/assets/js/225.1200b289.js"><link rel="prefetch" href="/snote/assets/js/226.3f3df43d.js"><link rel="prefetch" href="/snote/assets/js/227.c7ecd98d.js"><link rel="prefetch" href="/snote/assets/js/228.1c820734.js"><link rel="prefetch" href="/snote/assets/js/229.42a94887.js"><link rel="prefetch" href="/snote/assets/js/23.4d176be4.js"><link rel="prefetch" href="/snote/assets/js/230.2fad6960.js"><link rel="prefetch" href="/snote/assets/js/231.ce9d1a71.js"><link rel="prefetch" href="/snote/assets/js/232.c63516ab.js"><link rel="prefetch" href="/snote/assets/js/233.49851721.js"><link rel="prefetch" href="/snote/assets/js/234.e8b507d2.js"><link rel="prefetch" href="/snote/assets/js/235.d33e513e.js"><link rel="prefetch" href="/snote/assets/js/236.87e4e820.js"><link rel="prefetch" href="/snote/assets/js/237.d58c3ffb.js"><link rel="prefetch" href="/snote/assets/js/238.5082bd37.js"><link rel="prefetch" href="/snote/assets/js/239.5802e4fa.js"><link rel="prefetch" href="/snote/assets/js/24.80d247cf.js"><link rel="prefetch" href="/snote/assets/js/240.bd7f4259.js"><link rel="prefetch" href="/snote/assets/js/241.d135df38.js"><link rel="prefetch" href="/snote/assets/js/242.67bd6281.js"><link rel="prefetch" href="/snote/assets/js/243.dda77da4.js"><link rel="prefetch" href="/snote/assets/js/244.5ced0265.js"><link rel="prefetch" href="/snote/assets/js/245.76aa7524.js"><link rel="prefetch" href="/snote/assets/js/246.690093e7.js"><link rel="prefetch" href="/snote/assets/js/247.3127d466.js"><link rel="prefetch" href="/snote/assets/js/248.dbe63ed3.js"><link rel="prefetch" href="/snote/assets/js/249.fe2ef438.js"><link rel="prefetch" href="/snote/assets/js/25.63eaaf87.js"><link rel="prefetch" href="/snote/assets/js/250.1549a447.js"><link rel="prefetch" href="/snote/assets/js/251.db65678e.js"><link rel="prefetch" href="/snote/assets/js/252.e6b08a3c.js"><link rel="prefetch" href="/snote/assets/js/253.c60596c3.js"><link rel="prefetch" href="/snote/assets/js/254.cc49031e.js"><link rel="prefetch" href="/snote/assets/js/255.815e4537.js"><link rel="prefetch" href="/snote/assets/js/256.497750f6.js"><link rel="prefetch" href="/snote/assets/js/257.fd4a510f.js"><link rel="prefetch" href="/snote/assets/js/258.e1d62930.js"><link rel="prefetch" href="/snote/assets/js/259.42dad2e9.js"><link rel="prefetch" href="/snote/assets/js/26.70fb8da2.js"><link rel="prefetch" href="/snote/assets/js/260.a826fe7a.js"><link rel="prefetch" href="/snote/assets/js/261.220b0562.js"><link rel="prefetch" href="/snote/assets/js/262.df8af257.js"><link rel="prefetch" href="/snote/assets/js/263.e8218053.js"><link rel="prefetch" href="/snote/assets/js/264.88e08802.js"><link rel="prefetch" href="/snote/assets/js/265.f936d179.js"><link rel="prefetch" href="/snote/assets/js/266.a05c3940.js"><link rel="prefetch" href="/snote/assets/js/267.a7a75213.js"><link rel="prefetch" href="/snote/assets/js/268.33bfc335.js"><link rel="prefetch" href="/snote/assets/js/269.6e869285.js"><link rel="prefetch" href="/snote/assets/js/27.1f5790a0.js"><link rel="prefetch" href="/snote/assets/js/270.6ffca78a.js"><link rel="prefetch" href="/snote/assets/js/271.ac1fb068.js"><link rel="prefetch" href="/snote/assets/js/272.13e569b2.js"><link rel="prefetch" href="/snote/assets/js/273.2ce712d9.js"><link rel="prefetch" href="/snote/assets/js/274.d66f80d4.js"><link rel="prefetch" href="/snote/assets/js/275.de571766.js"><link rel="prefetch" href="/snote/assets/js/276.f3b29147.js"><link rel="prefetch" href="/snote/assets/js/277.b76178a1.js"><link rel="prefetch" href="/snote/assets/js/278.56362141.js"><link rel="prefetch" href="/snote/assets/js/279.25b22240.js"><link rel="prefetch" href="/snote/assets/js/28.5ef486f6.js"><link rel="prefetch" href="/snote/assets/js/280.0028cb8e.js"><link rel="prefetch" href="/snote/assets/js/281.19110b74.js"><link rel="prefetch" href="/snote/assets/js/282.92106866.js"><link rel="prefetch" href="/snote/assets/js/283.986ffec9.js"><link rel="prefetch" href="/snote/assets/js/284.c24532a5.js"><link rel="prefetch" href="/snote/assets/js/285.f53857b8.js"><link rel="prefetch" href="/snote/assets/js/286.b1f41b19.js"><link rel="prefetch" href="/snote/assets/js/287.b8c0d28b.js"><link rel="prefetch" href="/snote/assets/js/288.77b2860b.js"><link rel="prefetch" href="/snote/assets/js/289.d0a5c87b.js"><link rel="prefetch" href="/snote/assets/js/29.c1aa7b05.js"><link rel="prefetch" href="/snote/assets/js/290.a2b5aa3a.js"><link rel="prefetch" href="/snote/assets/js/291.8d3fa552.js"><link rel="prefetch" href="/snote/assets/js/292.ec03d81e.js"><link rel="prefetch" href="/snote/assets/js/293.98696bcb.js"><link rel="prefetch" href="/snote/assets/js/294.fe6857c9.js"><link rel="prefetch" href="/snote/assets/js/295.618179f3.js"><link rel="prefetch" href="/snote/assets/js/296.9ef57bc6.js"><link rel="prefetch" href="/snote/assets/js/297.f252aac1.js"><link rel="prefetch" href="/snote/assets/js/298.5e1c84a5.js"><link rel="prefetch" href="/snote/assets/js/299.309fb772.js"><link rel="prefetch" href="/snote/assets/js/3.c1ff7317.js"><link rel="prefetch" href="/snote/assets/js/30.4bb90738.js"><link rel="prefetch" href="/snote/assets/js/300.4e4d323e.js"><link rel="prefetch" href="/snote/assets/js/301.3a31e029.js"><link rel="prefetch" href="/snote/assets/js/302.d5214ae9.js"><link rel="prefetch" href="/snote/assets/js/303.df064523.js"><link rel="prefetch" href="/snote/assets/js/304.f9eb1bf7.js"><link rel="prefetch" href="/snote/assets/js/305.4d6612e0.js"><link rel="prefetch" href="/snote/assets/js/306.8acfffc4.js"><link rel="prefetch" href="/snote/assets/js/307.ba54d579.js"><link rel="prefetch" href="/snote/assets/js/308.d4473266.js"><link rel="prefetch" href="/snote/assets/js/309.a76d6b29.js"><link rel="prefetch" href="/snote/assets/js/31.b1ee51e2.js"><link rel="prefetch" href="/snote/assets/js/310.291ca423.js"><link rel="prefetch" href="/snote/assets/js/311.39a60e61.js"><link rel="prefetch" href="/snote/assets/js/312.36aa70af.js"><link rel="prefetch" href="/snote/assets/js/313.68c1ba97.js"><link rel="prefetch" href="/snote/assets/js/314.65cd2f18.js"><link rel="prefetch" href="/snote/assets/js/315.36d2f5b8.js"><link rel="prefetch" href="/snote/assets/js/316.7fc1ad1f.js"><link rel="prefetch" href="/snote/assets/js/317.aef9d07a.js"><link rel="prefetch" href="/snote/assets/js/318.783cd3bc.js"><link rel="prefetch" href="/snote/assets/js/319.e7f7bb74.js"><link rel="prefetch" href="/snote/assets/js/32.415bb67d.js"><link rel="prefetch" href="/snote/assets/js/320.4858112b.js"><link rel="prefetch" href="/snote/assets/js/321.5c2d406d.js"><link rel="prefetch" href="/snote/assets/js/322.0ca7c95d.js"><link rel="prefetch" href="/snote/assets/js/323.2d6fbc1c.js"><link rel="prefetch" href="/snote/assets/js/324.982fef51.js"><link rel="prefetch" href="/snote/assets/js/325.c244b4d2.js"><link rel="prefetch" href="/snote/assets/js/326.dbf8ace0.js"><link rel="prefetch" href="/snote/assets/js/327.8f2c1ebe.js"><link rel="prefetch" href="/snote/assets/js/328.e8eb5fa6.js"><link rel="prefetch" href="/snote/assets/js/329.162c0bd5.js"><link rel="prefetch" href="/snote/assets/js/33.35a98693.js"><link rel="prefetch" href="/snote/assets/js/330.5c6cafc3.js"><link rel="prefetch" href="/snote/assets/js/331.27832ebd.js"><link rel="prefetch" href="/snote/assets/js/332.d924873c.js"><link rel="prefetch" href="/snote/assets/js/333.2a25fce8.js"><link rel="prefetch" href="/snote/assets/js/334.fc1972ba.js"><link rel="prefetch" href="/snote/assets/js/335.35bf5bc7.js"><link rel="prefetch" href="/snote/assets/js/336.14b855aa.js"><link rel="prefetch" href="/snote/assets/js/337.462cd198.js"><link rel="prefetch" href="/snote/assets/js/338.a4ada162.js"><link rel="prefetch" href="/snote/assets/js/339.cdccddf6.js"><link rel="prefetch" href="/snote/assets/js/34.a375d18a.js"><link rel="prefetch" href="/snote/assets/js/340.4ef3435a.js"><link rel="prefetch" href="/snote/assets/js/341.14e6591a.js"><link rel="prefetch" href="/snote/assets/js/342.d944b8a6.js"><link rel="prefetch" href="/snote/assets/js/343.5e6e1814.js"><link rel="prefetch" href="/snote/assets/js/344.60707e61.js"><link rel="prefetch" href="/snote/assets/js/345.25b2d6d9.js"><link rel="prefetch" href="/snote/assets/js/346.fe7a8f22.js"><link rel="prefetch" href="/snote/assets/js/347.8dc03771.js"><link rel="prefetch" href="/snote/assets/js/348.92e83ff5.js"><link rel="prefetch" href="/snote/assets/js/349.2f717ea8.js"><link rel="prefetch" href="/snote/assets/js/35.175c5eb9.js"><link rel="prefetch" href="/snote/assets/js/350.5d843d49.js"><link rel="prefetch" href="/snote/assets/js/351.07f15a6d.js"><link rel="prefetch" href="/snote/assets/js/352.a931cc83.js"><link rel="prefetch" href="/snote/assets/js/353.04a30c0b.js"><link rel="prefetch" href="/snote/assets/js/354.a7adb748.js"><link rel="prefetch" href="/snote/assets/js/355.ed562ee8.js"><link rel="prefetch" href="/snote/assets/js/356.c42cbb30.js"><link rel="prefetch" href="/snote/assets/js/357.30d3bca7.js"><link rel="prefetch" href="/snote/assets/js/358.8e4e9d5d.js"><link rel="prefetch" href="/snote/assets/js/359.b907912b.js"><link rel="prefetch" href="/snote/assets/js/36.a16c85c6.js"><link rel="prefetch" href="/snote/assets/js/360.5901ac19.js"><link rel="prefetch" href="/snote/assets/js/361.480746e5.js"><link rel="prefetch" href="/snote/assets/js/362.ae2e8c50.js"><link rel="prefetch" href="/snote/assets/js/363.f4fd2d93.js"><link rel="prefetch" href="/snote/assets/js/364.71efc99c.js"><link rel="prefetch" href="/snote/assets/js/365.01f1bbac.js"><link rel="prefetch" href="/snote/assets/js/366.ce846e06.js"><link rel="prefetch" href="/snote/assets/js/367.d4be3b41.js"><link rel="prefetch" href="/snote/assets/js/368.5dfde021.js"><link rel="prefetch" href="/snote/assets/js/369.4fc6a3c2.js"><link rel="prefetch" href="/snote/assets/js/37.9518c0e3.js"><link rel="prefetch" href="/snote/assets/js/370.0beee867.js"><link rel="prefetch" href="/snote/assets/js/371.93f76ea7.js"><link rel="prefetch" href="/snote/assets/js/372.3516675d.js"><link rel="prefetch" href="/snote/assets/js/373.77a2d6fe.js"><link rel="prefetch" href="/snote/assets/js/374.4df21af3.js"><link rel="prefetch" href="/snote/assets/js/375.2b0bfaf9.js"><link rel="prefetch" href="/snote/assets/js/376.1ede8405.js"><link rel="prefetch" href="/snote/assets/js/377.6ebc80ca.js"><link rel="prefetch" href="/snote/assets/js/378.10b8ed94.js"><link rel="prefetch" href="/snote/assets/js/379.bf89586c.js"><link rel="prefetch" href="/snote/assets/js/38.87f9adbc.js"><link rel="prefetch" href="/snote/assets/js/380.0858af5c.js"><link rel="prefetch" href="/snote/assets/js/381.f5f831bc.js"><link rel="prefetch" href="/snote/assets/js/382.6f2a95ff.js"><link rel="prefetch" href="/snote/assets/js/383.0f3a65fc.js"><link rel="prefetch" href="/snote/assets/js/384.a5c6d41a.js"><link rel="prefetch" href="/snote/assets/js/385.3a233d1e.js"><link rel="prefetch" href="/snote/assets/js/39.596a81f1.js"><link rel="prefetch" href="/snote/assets/js/4.19456bac.js"><link rel="prefetch" href="/snote/assets/js/40.0bebee27.js"><link rel="prefetch" href="/snote/assets/js/41.119caf45.js"><link rel="prefetch" href="/snote/assets/js/42.07dbe829.js"><link rel="prefetch" href="/snote/assets/js/43.534b6876.js"><link rel="prefetch" href="/snote/assets/js/44.109672d9.js"><link rel="prefetch" href="/snote/assets/js/45.3293f327.js"><link rel="prefetch" href="/snote/assets/js/46.71975505.js"><link rel="prefetch" href="/snote/assets/js/47.403a111f.js"><link rel="prefetch" href="/snote/assets/js/48.31adab5a.js"><link rel="prefetch" href="/snote/assets/js/49.d7cdd50e.js"><link rel="prefetch" href="/snote/assets/js/50.473b8594.js"><link rel="prefetch" href="/snote/assets/js/51.f397ad1e.js"><link rel="prefetch" href="/snote/assets/js/52.d5c73839.js"><link rel="prefetch" href="/snote/assets/js/53.7ff84687.js"><link rel="prefetch" href="/snote/assets/js/54.dfe7baf8.js"><link rel="prefetch" href="/snote/assets/js/55.45ce9dfe.js"><link rel="prefetch" href="/snote/assets/js/56.99f83db0.js"><link rel="prefetch" href="/snote/assets/js/57.041b34e7.js"><link rel="prefetch" href="/snote/assets/js/58.eb1dc55f.js"><link rel="prefetch" href="/snote/assets/js/59.07e58102.js"><link rel="prefetch" href="/snote/assets/js/6.f56a3b14.js"><link rel="prefetch" href="/snote/assets/js/60.401104f8.js"><link rel="prefetch" href="/snote/assets/js/61.1f344f74.js"><link rel="prefetch" href="/snote/assets/js/62.2458973b.js"><link rel="prefetch" href="/snote/assets/js/63.3935dddc.js"><link rel="prefetch" href="/snote/assets/js/64.7ba454e7.js"><link rel="prefetch" href="/snote/assets/js/65.78e00c42.js"><link rel="prefetch" href="/snote/assets/js/66.a5035491.js"><link rel="prefetch" href="/snote/assets/js/67.d4a88243.js"><link rel="prefetch" href="/snote/assets/js/68.e5ea69d1.js"><link rel="prefetch" href="/snote/assets/js/69.0d61549e.js"><link rel="prefetch" href="/snote/assets/js/7.fef180a0.js"><link rel="prefetch" href="/snote/assets/js/70.7ebe43d7.js"><link rel="prefetch" href="/snote/assets/js/71.e9b48c2a.js"><link rel="prefetch" href="/snote/assets/js/72.fea6f5d4.js"><link rel="prefetch" href="/snote/assets/js/73.2eb66693.js"><link rel="prefetch" href="/snote/assets/js/74.bb5a4f82.js"><link rel="prefetch" href="/snote/assets/js/75.f281d576.js"><link rel="prefetch" href="/snote/assets/js/76.8d8d7aee.js"><link rel="prefetch" href="/snote/assets/js/78.65f8cc94.js"><link rel="prefetch" href="/snote/assets/js/79.bcc870ee.js"><link rel="prefetch" href="/snote/assets/js/8.c4d1827a.js"><link rel="prefetch" href="/snote/assets/js/80.7f9e4555.js"><link rel="prefetch" href="/snote/assets/js/81.96ec0bed.js"><link rel="prefetch" href="/snote/assets/js/82.070dd41d.js"><link rel="prefetch" href="/snote/assets/js/83.ebe27694.js"><link rel="prefetch" href="/snote/assets/js/84.75491c26.js"><link rel="prefetch" href="/snote/assets/js/85.714e47e1.js"><link rel="prefetch" href="/snote/assets/js/86.9d78fc9e.js"><link rel="prefetch" href="/snote/assets/js/87.08bb0110.js"><link rel="prefetch" href="/snote/assets/js/88.c6532cef.js"><link rel="prefetch" href="/snote/assets/js/89.92eaf325.js"><link rel="prefetch" href="/snote/assets/js/9.05800a53.js"><link rel="prefetch" href="/snote/assets/js/90.77ebb53b.js"><link rel="prefetch" href="/snote/assets/js/91.6c2753e5.js"><link rel="prefetch" href="/snote/assets/js/92.8ffec3d5.js"><link rel="prefetch" href="/snote/assets/js/93.f2a2ebcd.js"><link rel="prefetch" href="/snote/assets/js/94.ce688d63.js"><link rel="prefetch" href="/snote/assets/js/95.6f20e8a9.js"><link rel="prefetch" href="/snote/assets/js/96.da6970c0.js"><link rel="prefetch" href="/snote/assets/js/97.0ee9c63a.js"><link rel="prefetch" href="/snote/assets/js/98.0cd42ce4.js"><link rel="prefetch" href="/snote/assets/js/99.748348db.js">
    <link rel="stylesheet" href="/snote/assets/css/0.styles.733b32e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>snote</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>study note</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/snote/" class="home-link router-link-active"><!----> <span class="site-name">snote</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/snote/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/snote/categories/maven/" class="nav-link"><i class="undefined"></i>
  maven
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/dev-tools/" class="nav-link"><i class="undefined"></i>
  dev-tools
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/idea/" class="nav-link"><i class="undefined"></i>
  idea
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/java-basic/" class="nav-link"><i class="undefined"></i>
  java-basic
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/java-concurrency/" class="nav-link"><i class="undefined"></i>
  java-concurrency
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/jvm/" class="nav-link"><i class="undefined"></i>
  jvm
</a></li></ul></div></div><div class="nav-item"><a href="/snote/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/snote/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><!----> <!----> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>138</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>6</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6><li class="social-item" data-v-828910c6><i class="iconfont reco-github" style="color:#f47e60;" data-v-828910c6></i></li></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/snote/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/snote/categories/maven/" class="nav-link"><i class="undefined"></i>
  maven
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/dev-tools/" class="nav-link"><i class="undefined"></i>
  dev-tools
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/idea/" class="nav-link"><i class="undefined"></i>
  idea
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/java-basic/" class="nav-link"><i class="undefined"></i>
  java-basic
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/java-concurrency/" class="nav-link"><i class="undefined"></i>
  java-concurrency
</a></li><li class="dropdown-item"><!----> <a href="/snote/categories/jvm/" class="nav-link"><i class="undefined"></i>
  jvm
</a></li></ul></div></div><div class="nav-item"><a href="/snote/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/snote/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Core</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/snote/cs/backend/spring/spring-core/spring_00_zi-yuan-tie.html" class="sidebar-link">/cs/backend/spring/spring-core/spring_00_zi-yuan-tie.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/spring_01_springzhong-huo-qu-shang-xia-wen.html" class="sidebar-link">/cs/backend/spring/spring-core/spring_01_springzhong-huo-qu-shang-xia-wen.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/spring_01_springzheng-ti-jia-gou.html" class="sidebar-link">/cs/backend/spring/spring-core/spring_01_springzheng-ti-jia-gou.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/spring_02_aop.html" class="sidebar-link">Spring Aop</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_00_zi-yuan-tie.html" class="sidebar-link">/cs/backend/spring/spring-core/springyuan-ma-fen-xi_00_zi-yuan-tie.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_01_yuan-ma-diao-shi-huan-jing-da-jian.html" class="sidebar-link">/cs/backend/spring/spring-core/springyuan-ma-fen-xi_01_yuan-ma-diao-shi-huan-jing-da-jian.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_springde-xiang-guan-chou-xiang.html" class="sidebar-link">Spring的相关抽象</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html" aria-current="page" class="active sidebar-link">Spring容器的基本实现</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_03_rong-qi-de-gong-neng-kuo-zhan.html" class="sidebar-link">/cs/backend/spring/spring-core/springyuan-ma-fen-xi_03_rong-qi-de-gong-neng-kuo-zhan.html</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_04_aop.html" class="sidebar-link">Spring 源码分析\04AOP</a></li><li><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_100_rong-qi-de-ji-ben-shi-xian---fu-ben.html" class="sidebar-link">/cs/backend/spring/spring-core/springyuan-ma-fen-xi_100_rong-qi-de-ji-ben-shi-xian---fu-ben.html</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Spring容器的基本实现</h1> <div data-v-1ff7123e><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="spring容器的基本实现"><a href="#spring容器的基本实现" class="header-anchor">#</a> Spring容器的基本实现</h1> <p>[toc]</p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <h3 id="推荐阅读"><a href="#推荐阅读" class="header-anchor">#</a> 推荐阅读</h3> <blockquote><ul><li><a href="https://blog.csdn.net/qq_34090008/article/details/78772189" target="_blank" rel="noopener noreferrer">Spring BeanFactory 类图详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/strivezxq/article/details/44560771" target="_blank" rel="noopener noreferrer">spring 主要涉及类类图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/ab1bf09f6501" target="_blank" rel="noopener noreferrer">Spring容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h2 id="一、基本概念"><a href="#一、基本概念" class="header-anchor">#</a> 一、基本概念</h2> <h3 id="_1-容器相关类图"><a href="#_1-容器相关类图" class="header-anchor">#</a> 1.容器相关类图</h3> <h4 id="_1-1-容器概览"><a href="#_1-1-容器概览" class="header-anchor">#</a> 1.1 容器概览</h4> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1039px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1803 1039" width="1803px" zoomAndPan="magnify" style="width:1803px;height:1039px;"><defs><filter height="300%" id="f1smzobyebq4t6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"></feOffset><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"></feBlend></filter></defs><g><rect fill="#FFA500" filter="url(#f1smzobyebq4t6)" height="48" id="ApplicationContext" width="135" x="1062" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1077" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1077.9531,344.6406 L1077.9531,351.2969 L1079.6719,351.2969 Q1080.2813,351.2969 1080.5469,351.5313 Q1080.8125,351.7656 1080.8125,352.1563 Q1080.8125,352.5313 1080.5469,352.7656 Q1080.2813,353 1079.6719,353 L1074.5313,353 Q1073.9219,353 1073.6563,352.7656 Q1073.3906,352.5313 1073.3906,352.1406 Q1073.3906,351.7656 1073.6563,351.5313 Q1073.9219,351.2969 1074.5313,351.2969 L1076.25,351.2969 L1076.25,344.6406 L1074.5313,344.6406 Q1073.9219,344.6406 1073.6563,344.4063 Q1073.3906,344.1719 1073.3906,343.7813 Q1073.3906,343.4063 1073.6563,343.1719 Q1073.9219,342.9375 1074.5313,342.9375 L1079.6719,342.9375 Q1080.2813,342.9375 1080.5469,343.1719 Q1080.8125,343.4063 1080.8125,343.7813 Q1080.8125,344.1719 1080.5469,344.4063 Q1080.2813,344.6406 1079.6719,344.6406 L1077.9531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="103" x="1091" y="352.9102">ApplicationContext</text><line x1="1063" x2="1196" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1063" x2="1196" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="EnvironmentCapable" width="150" x="1054.5" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1069.5" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1070.4531,236.6406 L1070.4531,243.2969 L1072.1719,243.2969 Q1072.7813,243.2969 1073.0469,243.5313 Q1073.3125,243.7656 1073.3125,244.1563 Q1073.3125,244.5313 1073.0469,244.7656 Q1072.7813,245 1072.1719,245 L1067.0313,245 Q1066.4219,245 1066.1563,244.7656 Q1065.8906,244.5313 1065.8906,244.1406 Q1065.8906,243.7656 1066.1563,243.5313 Q1066.4219,243.2969 1067.0313,243.2969 L1068.75,243.2969 L1068.75,236.6406 L1067.0313,236.6406 Q1066.4219,236.6406 1066.1563,236.4063 Q1065.8906,236.1719 1065.8906,235.7813 Q1065.8906,235.4063 1066.1563,235.1719 Q1066.4219,234.9375 1067.0313,234.9375 L1072.1719,234.9375 Q1072.7813,234.9375 1073.0469,235.1719 Q1073.3125,235.4063 1073.3125,235.7813 Q1073.3125,236.1719 1073.0469,236.4063 Q1072.7813,236.6406 1072.1719,236.6406 L1070.4531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="118" x="1083.5" y="244.9102">EnvironmentCapable</text><line x1="1055.5" x2="1203.5" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1055.5" x2="1203.5" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ListableBeanFactory" width="145" x="594" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="609" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M609.9531,236.6406 L609.9531,243.2969 L611.6719,243.2969 Q612.2813,243.2969 612.5469,243.5313 Q612.8125,243.7656 612.8125,244.1563 Q612.8125,244.5313 612.5469,244.7656 Q612.2813,245 611.6719,245 L606.5313,245 Q605.9219,245 605.6563,244.7656 Q605.3906,244.5313 605.3906,244.1406 Q605.3906,243.7656 605.6563,243.5313 Q605.9219,243.2969 606.5313,243.2969 L608.25,243.2969 L608.25,236.6406 L606.5313,236.6406 Q605.9219,236.6406 605.6563,236.4063 Q605.3906,236.1719 605.3906,235.7813 Q605.3906,235.4063 605.6563,235.1719 Q605.9219,234.9375 606.5313,234.9375 L611.6719,234.9375 Q612.2813,234.9375 612.5469,235.1719 Q612.8125,235.4063 612.8125,235.7813 Q612.8125,236.1719 612.5469,236.4063 Q612.2813,236.6406 611.6719,236.6406 L609.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="113" x="623" y="244.9102">ListableBeanFactory</text><line x1="595" x2="738" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="595" x2="738" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="HierarchicalBeanFactory" width="167" x="320" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="335" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M335.9531,236.6406 L335.9531,243.2969 L337.6719,243.2969 Q338.2813,243.2969 338.5469,243.5313 Q338.8125,243.7656 338.8125,244.1563 Q338.8125,244.5313 338.5469,244.7656 Q338.2813,245 337.6719,245 L332.5313,245 Q331.9219,245 331.6563,244.7656 Q331.3906,244.5313 331.3906,244.1406 Q331.3906,243.7656 331.6563,243.5313 Q331.9219,243.2969 332.5313,243.2969 L334.25,243.2969 L334.25,236.6406 L332.5313,236.6406 Q331.9219,236.6406 331.6563,236.4063 Q331.3906,236.1719 331.3906,235.7813 Q331.3906,235.4063 331.6563,235.1719 Q331.9219,234.9375 332.5313,234.9375 L337.6719,234.9375 Q338.2813,234.9375 338.5469,235.1719 Q338.8125,235.4063 338.8125,235.7813 Q338.8125,236.1719 338.5469,236.4063 Q338.2813,236.6406 337.6719,236.6406 L335.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="135" x="349" y="244.9102">HierarchicalBeanFactory</text><line x1="321" x2="486" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="321" x2="486" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="MessageSource" width="120" x="1239.5" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1254.5" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1255.4531,236.6406 L1255.4531,243.2969 L1257.1719,243.2969 Q1257.7813,243.2969 1258.0469,243.5313 Q1258.3125,243.7656 1258.3125,244.1563 Q1258.3125,244.5313 1258.0469,244.7656 Q1257.7813,245 1257.1719,245 L1252.0313,245 Q1251.4219,245 1251.1563,244.7656 Q1250.8906,244.5313 1250.8906,244.1406 Q1250.8906,243.7656 1251.1563,243.5313 Q1251.4219,243.2969 1252.0313,243.2969 L1253.75,243.2969 L1253.75,236.6406 L1252.0313,236.6406 Q1251.4219,236.6406 1251.1563,236.4063 Q1250.8906,236.1719 1250.8906,235.7813 Q1250.8906,235.4063 1251.1563,235.1719 Q1251.4219,234.9375 1252.0313,234.9375 L1257.1719,234.9375 Q1257.7813,234.9375 1258.0469,235.1719 Q1258.3125,235.4063 1258.3125,235.7813 Q1258.3125,236.1719 1258.0469,236.4063 Q1257.7813,236.6406 1257.1719,236.6406 L1255.4531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="88" x="1268.5" y="244.9102">MessageSource</text><line x1="1240.5" x2="1358.5" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1240.5" x2="1358.5" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ApplicationEventPublisher" width="177" x="1395" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1410" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1410.9531,236.6406 L1410.9531,243.2969 L1412.6719,243.2969 Q1413.2813,243.2969 1413.5469,243.5313 Q1413.8125,243.7656 1413.8125,244.1563 Q1413.8125,244.5313 1413.5469,244.7656 Q1413.2813,245 1412.6719,245 L1407.5313,245 Q1406.9219,245 1406.6563,244.7656 Q1406.3906,244.5313 1406.3906,244.1406 Q1406.3906,243.7656 1406.6563,243.5313 Q1406.9219,243.2969 1407.5313,243.2969 L1409.25,243.2969 L1409.25,236.6406 L1407.5313,236.6406 Q1406.9219,236.6406 1406.6563,236.4063 Q1406.3906,236.1719 1406.3906,235.7813 Q1406.3906,235.4063 1406.6563,235.1719 Q1406.9219,234.9375 1407.5313,234.9375 L1412.6719,234.9375 Q1413.2813,234.9375 1413.5469,235.1719 Q1413.8125,235.4063 1413.8125,235.7813 Q1413.8125,236.1719 1413.5469,236.4063 Q1413.2813,236.6406 1412.6719,236.6406 L1410.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="145" x="1424" y="244.9102">ApplicationEventPublisher</text><line x1="1396" x2="1571" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1396" x2="1571" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ResourcePatternResolver" width="173" x="846" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="861" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M861.9531,236.6406 L861.9531,243.2969 L863.6719,243.2969 Q864.2813,243.2969 864.5469,243.5313 Q864.8125,243.7656 864.8125,244.1563 Q864.8125,244.5313 864.5469,244.7656 Q864.2813,245 863.6719,245 L858.5313,245 Q857.9219,245 857.6563,244.7656 Q857.3906,244.5313 857.3906,244.1406 Q857.3906,243.7656 857.6563,243.5313 Q857.9219,243.2969 858.5313,243.2969 L860.25,243.2969 L860.25,236.6406 L858.5313,236.6406 Q857.9219,236.6406 857.6563,236.4063 Q857.3906,236.1719 857.3906,235.7813 Q857.3906,235.4063 857.6563,235.1719 Q857.9219,234.9375 858.5313,234.9375 L863.6719,234.9375 Q864.2813,234.9375 864.5469,235.1719 Q864.8125,235.4063 864.8125,235.7813 Q864.8125,236.1719 864.5469,236.4063 Q864.2813,236.6406 863.6719,236.6406 L861.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="141" x="875" y="244.9102">ResourcePatternResolver</text><line x1="847" x2="1018" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="847" x2="1018" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA500" filter="url(#f1smzobyebq4t6)" height="48" id="BeanFactory" width="101" x="490" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="505" cy="132" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M505.9531,128.6406 L505.9531,135.2969 L507.6719,135.2969 Q508.2813,135.2969 508.5469,135.5313 Q508.8125,135.7656 508.8125,136.1563 Q508.8125,136.5313 508.5469,136.7656 Q508.2813,137 507.6719,137 L502.5313,137 Q501.9219,137 501.6563,136.7656 Q501.3906,136.5313 501.3906,136.1406 Q501.3906,135.7656 501.6563,135.5313 Q501.9219,135.2969 502.5313,135.2969 L504.25,135.2969 L504.25,128.6406 L502.5313,128.6406 Q501.9219,128.6406 501.6563,128.4063 Q501.3906,128.1719 501.3906,127.7813 Q501.3906,127.4063 501.6563,127.1719 Q501.9219,126.9375 502.5313,126.9375 L507.6719,126.9375 Q508.2813,126.9375 508.5469,127.1719 Q508.8125,127.4063 508.8125,127.7813 Q508.8125,128.1719 508.5469,128.4063 Q508.2813,128.6406 507.6719,128.6406 L505.9531,128.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="519" y="136.9102">BeanFactory</text><line x1="491" x2="590" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="491" x2="590" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AutowireCapableBeanFactory" width="196" x="442.5" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="457.5" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M458.4531,344.6406 L458.4531,351.2969 L460.1719,351.2969 Q460.7813,351.2969 461.0469,351.5313 Q461.3125,351.7656 461.3125,352.1563 Q461.3125,352.5313 461.0469,352.7656 Q460.7813,353 460.1719,353 L455.0313,353 Q454.4219,353 454.1563,352.7656 Q453.8906,352.5313 453.8906,352.1406 Q453.8906,351.7656 454.1563,351.5313 Q454.4219,351.2969 455.0313,351.2969 L456.75,351.2969 L456.75,344.6406 L455.0313,344.6406 Q454.4219,344.6406 454.1563,344.4063 Q453.8906,344.1719 453.8906,343.7813 Q453.8906,343.4063 454.1563,343.1719 Q454.4219,342.9375 455.0313,342.9375 L460.1719,342.9375 Q460.7813,342.9375 461.0469,343.1719 Q461.3125,343.4063 461.3125,343.7813 Q461.3125,344.1719 461.0469,344.4063 Q460.7813,344.6406 460.1719,344.6406 L458.4531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="164" x="471.5" y="352.9102">AutowireCapableBeanFactory</text><line x1="443.5" x2="637.5" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="443.5" x2="637.5" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ConfigurableBeanFactory" width="173" x="234" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="249" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M249.9531,344.6406 L249.9531,351.2969 L251.6719,351.2969 Q252.2813,351.2969 252.5469,351.5313 Q252.8125,351.7656 252.8125,352.1563 Q252.8125,352.5313 252.5469,352.7656 Q252.2813,353 251.6719,353 L246.5313,353 Q245.9219,353 245.6563,352.7656 Q245.3906,352.5313 245.3906,352.1406 Q245.3906,351.7656 245.6563,351.5313 Q245.9219,351.2969 246.5313,351.2969 L248.25,351.2969 L248.25,344.6406 L246.5313,344.6406 Q245.9219,344.6406 245.6563,344.4063 Q245.3906,344.1719 245.3906,343.7813 Q245.3906,343.4063 245.6563,343.1719 Q245.9219,342.9375 246.5313,342.9375 L251.6719,342.9375 Q252.2813,342.9375 252.5469,343.1719 Q252.8125,343.4063 252.8125,343.7813 Q252.8125,344.1719 252.5469,344.4063 Q252.2813,344.6406 251.6719,344.6406 L249.9531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="141" x="263" y="352.9102">ConfigurableBeanFactory</text><line x1="235" x2="406" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="235" x2="406" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="SingletonBeanRegistry" width="158" x="199.5" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="214.5" cy="132" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M215.4531,128.6406 L215.4531,135.2969 L217.1719,135.2969 Q217.7813,135.2969 218.0469,135.5313 Q218.3125,135.7656 218.3125,136.1563 Q218.3125,136.5313 218.0469,136.7656 Q217.7813,137 217.1719,137 L212.0313,137 Q211.4219,137 211.1563,136.7656 Q210.8906,136.5313 210.8906,136.1406 Q210.8906,135.7656 211.1563,135.5313 Q211.4219,135.2969 212.0313,135.2969 L213.75,135.2969 L213.75,128.6406 L212.0313,128.6406 Q211.4219,128.6406 211.1563,128.4063 Q210.8906,128.1719 210.8906,127.7813 Q210.8906,127.4063 211.1563,127.1719 Q211.4219,126.9375 212.0313,126.9375 L217.1719,126.9375 Q217.7813,126.9375 218.0469,127.1719 Q218.3125,127.4063 218.3125,127.7813 Q218.3125,128.1719 218.0469,128.4063 Q217.7813,128.6406 217.1719,128.6406 L215.4531,128.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="228.5" y="136.9102">SingletonBeanRegistry</text><line x1="200.5" x2="356.5" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="200.5" x2="356.5" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AliasRegistry" width="104" x="390.5" y="8" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="405.5" cy="24" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M406.4531,20.6406 L406.4531,27.2969 L408.1719,27.2969 Q408.7813,27.2969 409.0469,27.5313 Q409.3125,27.7656 409.3125,28.1563 Q409.3125,28.5313 409.0469,28.7656 Q408.7813,29 408.1719,29 L403.0313,29 Q402.4219,29 402.1563,28.7656 Q401.8906,28.5313 401.8906,28.1406 Q401.8906,27.7656 402.1563,27.5313 Q402.4219,27.2969 403.0313,27.2969 L404.75,27.2969 L404.75,20.6406 L403.0313,20.6406 Q402.4219,20.6406 402.1563,20.4063 Q401.8906,20.1719 401.8906,19.7813 Q401.8906,19.4063 402.1563,19.1719 Q402.4219,18.9375 403.0313,18.9375 L408.1719,18.9375 Q408.7813,18.9375 409.0469,19.1719 Q409.3125,19.4063 409.3125,19.7813 Q409.3125,20.1719 409.0469,20.4063 Q408.7813,20.6406 408.1719,20.6406 L406.4531,20.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="72" x="419.5" y="28.9102">AliasRegistry</text><line x1="391.5" x2="493.5" y1="40" y2="40" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="391.5" x2="493.5" y1="48" y2="48" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="SimpleAliasRegistry" width="143" x="21" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="36" cy="132" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M38.7656,127.875 Q38.9219,127.6563 39.1094,127.5469 Q39.2969,127.4375 39.5156,127.4375 Q39.8906,127.4375 40.125,127.6953 Q40.3594,127.9531 40.3594,128.5625 L40.3594,130.0156 Q40.3594,130.625 40.125,130.8906 Q39.8906,131.1563 39.5156,131.1563 Q39.1719,131.1563 38.9688,130.9531 Q38.7656,130.7656 38.6563,130.25 Q38.6094,129.8906 38.4219,129.7031 Q38.0938,129.3281 37.4844,129.1094 Q36.875,128.8906 36.25,128.8906 Q35.4844,128.8906 34.8516,129.2188 Q34.2188,129.5469 33.7266,130.2969 Q33.2344,131.0469 33.2344,132.0781 L33.2344,133.1719 Q33.2344,134.4063 34.125,135.2266 Q35.0156,136.0469 36.6094,136.0469 Q37.5469,136.0469 38.2031,135.7969 Q38.5938,135.6406 39.0156,135.2031 Q39.2813,134.9375 39.4297,134.8594 Q39.5781,134.7813 39.7813,134.7813 Q40.1094,134.7813 40.3672,135.0391 Q40.625,135.2969 40.625,135.6406 Q40.625,135.9844 40.2813,136.3906 Q39.7813,136.9688 38.9844,137.2969 Q37.9063,137.75 36.6094,137.75 Q35.0938,137.75 33.8906,137.125 Q32.9063,136.625 32.2188,135.5547 Q31.5313,134.4844 31.5313,133.2031 L31.5313,132.0469 Q31.5313,130.7188 32.1484,129.5703 Q32.7656,128.4219 33.8594,127.8047 Q34.9531,127.1875 36.1875,127.1875 Q36.9219,127.1875 37.5703,127.3516 Q38.2188,127.5156 38.7656,127.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="50" y="136.9102">SimpleAliasRegistry</text><line x1="22" x2="163" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="22" x2="163" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="DefaultSingletonBeanRegistry" width="197" x="6" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="21" cy="240" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M23.7656,235.875 Q23.9219,235.6563 24.1094,235.5469 Q24.2969,235.4375 24.5156,235.4375 Q24.8906,235.4375 25.125,235.6953 Q25.3594,235.9531 25.3594,236.5625 L25.3594,238.0156 Q25.3594,238.625 25.125,238.8906 Q24.8906,239.1563 24.5156,239.1563 Q24.1719,239.1563 23.9688,238.9531 Q23.7656,238.7656 23.6563,238.25 Q23.6094,237.8906 23.4219,237.7031 Q23.0938,237.3281 22.4844,237.1094 Q21.875,236.8906 21.25,236.8906 Q20.4844,236.8906 19.8516,237.2188 Q19.2188,237.5469 18.7266,238.2969 Q18.2344,239.0469 18.2344,240.0781 L18.2344,241.1719 Q18.2344,242.4063 19.125,243.2266 Q20.0156,244.0469 21.6094,244.0469 Q22.5469,244.0469 23.2031,243.7969 Q23.5938,243.6406 24.0156,243.2031 Q24.2813,242.9375 24.4297,242.8594 Q24.5781,242.7813 24.7813,242.7813 Q25.1094,242.7813 25.3672,243.0391 Q25.625,243.2969 25.625,243.6406 Q25.625,243.9844 25.2813,244.3906 Q24.7813,244.9688 23.9844,245.2969 Q22.9063,245.75 21.6094,245.75 Q20.0938,245.75 18.8906,245.125 Q17.9063,244.625 17.2188,243.5547 Q16.5313,242.4844 16.5313,241.2031 L16.5313,240.0469 Q16.5313,238.7188 17.1484,237.5703 Q17.7656,236.4219 18.8594,235.8047 Q19.9531,235.1875 21.1875,235.1875 Q21.9219,235.1875 22.5703,235.3516 Q23.2188,235.5156 23.7656,235.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="35" y="244.9102">DefaultSingletonBeanRegistry</text><line x1="7" x2="202" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="7" x2="202" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="FactoryBeanRegistrySupport" width="189" x="10" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="25" cy="348" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M27.1875,349.7656 L23.0469,349.7656 L22.625,350.7969 L23.0469,350.7969 Q23.6563,350.7969 23.9219,351.0313 Q24.1875,351.2656 24.1875,351.6563 Q24.1875,352.0313 23.9219,352.2656 Q23.6563,352.5 23.0469,352.5 L20.75,352.5 Q20.1406,352.5 19.8828,352.2656 Q19.625,352.0313 19.625,351.6406 Q19.625,351.2656 19.8984,351.0234 Q20.1719,350.7813 20.7969,350.7969 L23.4688,344.1406 L22.3594,344.1406 Q21.75,344.1406 21.4844,343.9063 Q21.2188,343.6719 21.2188,343.2813 Q21.2188,342.9063 21.4844,342.6719 Q21.75,342.4375 22.3594,342.4375 L26.0313,342.4375 L29.4219,350.7969 Q30.0156,350.7969 30.2031,350.9375 Q30.5938,351.2031 30.5938,351.6563 Q30.5938,352.0313 30.3359,352.2656 Q30.0781,352.5 29.4688,352.5 L27.1719,352.5 Q26.5625,352.5 26.2969,352.2656 Q26.0313,352.0313 26.0313,351.6406 Q26.0313,351.2656 26.2969,351.0313 Q26.5625,350.7969 27.1719,350.7969 L27.5938,350.7969 L27.1875,349.7656 Z M26.4688,348.0625 L25.1094,344.6875 L23.7344,348.0625 L26.4688,348.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="157" x="39" y="352.9102">FactoryBeanRegistrySupport</text><line x1="11" x2="198" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="11" x2="198" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractBeanFactory" width="146" x="247.5" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="262.5" cy="456" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M264.6875,457.7656 L260.5469,457.7656 L260.125,458.7969 L260.5469,458.7969 Q261.1563,458.7969 261.4219,459.0313 Q261.6875,459.2656 261.6875,459.6563 Q261.6875,460.0313 261.4219,460.2656 Q261.1563,460.5 260.5469,460.5 L258.25,460.5 Q257.6406,460.5 257.3828,460.2656 Q257.125,460.0313 257.125,459.6406 Q257.125,459.2656 257.3984,459.0234 Q257.6719,458.7813 258.2969,458.7969 L260.9688,452.1406 L259.8594,452.1406 Q259.25,452.1406 258.9844,451.9063 Q258.7188,451.6719 258.7188,451.2813 Q258.7188,450.9063 258.9844,450.6719 Q259.25,450.4375 259.8594,450.4375 L263.5313,450.4375 L266.9219,458.7969 Q267.5156,458.7969 267.7031,458.9375 Q268.0938,459.2031 268.0938,459.6563 Q268.0938,460.0313 267.8359,460.2656 Q267.5781,460.5 266.9688,460.5 L264.6719,460.5 Q264.0625,460.5 263.7969,460.2656 Q263.5313,460.0313 263.5313,459.6406 Q263.5313,459.2656 263.7969,459.0313 Q264.0625,458.7969 264.6719,458.7969 L265.0938,458.7969 L264.6875,457.7656 Z M263.9688,456.0625 L262.6094,452.6875 L261.2344,456.0625 L263.9688,456.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="114" x="276.5" y="460.9102">AbstractBeanFactory</text><line x1="248.5" x2="392.5" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="248.5" x2="392.5" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractAutowireCapableBeanFactory" width="241" x="331" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="346" cy="564" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M348.1875,565.7656 L344.0469,565.7656 L343.625,566.7969 L344.0469,566.7969 Q344.6563,566.7969 344.9219,567.0313 Q345.1875,567.2656 345.1875,567.6563 Q345.1875,568.0313 344.9219,568.2656 Q344.6563,568.5 344.0469,568.5 L341.75,568.5 Q341.1406,568.5 340.8828,568.2656 Q340.625,568.0313 340.625,567.6406 Q340.625,567.2656 340.8984,567.0234 Q341.1719,566.7813 341.7969,566.7969 L344.4688,560.1406 L343.3594,560.1406 Q342.75,560.1406 342.4844,559.9063 Q342.2188,559.6719 342.2188,559.2813 Q342.2188,558.9063 342.4844,558.6719 Q342.75,558.4375 343.3594,558.4375 L347.0313,558.4375 L350.4219,566.7969 Q351.0156,566.7969 351.2031,566.9375 Q351.5938,567.2031 351.5938,567.6563 Q351.5938,568.0313 351.3359,568.2656 Q351.0781,568.5 350.4688,568.5 L348.1719,568.5 Q347.5625,568.5 347.2969,568.2656 Q347.0313,568.0313 347.0313,567.6406 Q347.0313,567.2656 347.2969,567.0313 Q347.5625,566.7969 348.1719,566.7969 L348.5938,566.7969 L348.1875,565.7656 Z M347.4688,564.0625 L346.1094,560.6875 L344.7344,564.0625 L347.4688,564.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="209" x="360" y="568.9102">AbstractAutowireCapableBeanFactory</text><line x1="332" x2="571" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="332" x2="571" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ConfigurableListableBeanFactory" width="217" x="514" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="529" cy="456" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M529.9531,452.6406 L529.9531,459.2969 L531.6719,459.2969 Q532.2813,459.2969 532.5469,459.5313 Q532.8125,459.7656 532.8125,460.1563 Q532.8125,460.5313 532.5469,460.7656 Q532.2813,461 531.6719,461 L526.5313,461 Q525.9219,461 525.6563,460.7656 Q525.3906,460.5313 525.3906,460.1406 Q525.3906,459.7656 525.6563,459.5313 Q525.9219,459.2969 526.5313,459.2969 L528.25,459.2969 L528.25,452.6406 L526.5313,452.6406 Q525.9219,452.6406 525.6563,452.4063 Q525.3906,452.1719 525.3906,451.7813 Q525.3906,451.4063 525.6563,451.1719 Q525.9219,450.9375 526.5313,450.9375 L531.6719,450.9375 Q532.2813,450.9375 532.5469,451.1719 Q532.8125,451.4063 532.8125,451.7813 Q532.8125,452.1719 532.5469,452.4063 Q532.2813,452.6406 531.6719,452.6406 L529.9531,452.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="185" x="543" y="460.9102">ConfigurableListableBeanFactory</text><line x1="515" x2="730" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="515" x2="730" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="DefaultListableBeanFactory" width="183" x="406" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="421" cy="672" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M423.7656,667.875 Q423.9219,667.6563 424.1094,667.5469 Q424.2969,667.4375 424.5156,667.4375 Q424.8906,667.4375 425.125,667.6953 Q425.3594,667.9531 425.3594,668.5625 L425.3594,670.0156 Q425.3594,670.625 425.125,670.8906 Q424.8906,671.1563 424.5156,671.1563 Q424.1719,671.1563 423.9688,670.9531 Q423.7656,670.7656 423.6563,670.25 Q423.6094,669.8906 423.4219,669.7031 Q423.0938,669.3281 422.4844,669.1094 Q421.875,668.8906 421.25,668.8906 Q420.4844,668.8906 419.8516,669.2188 Q419.2188,669.5469 418.7266,670.2969 Q418.2344,671.0469 418.2344,672.0781 L418.2344,673.1719 Q418.2344,674.4063 419.125,675.2266 Q420.0156,676.0469 421.6094,676.0469 Q422.5469,676.0469 423.2031,675.7969 Q423.5938,675.6406 424.0156,675.2031 Q424.2813,674.9375 424.4297,674.8594 Q424.5781,674.7813 424.7813,674.7813 Q425.1094,674.7813 425.3672,675.0391 Q425.625,675.2969 425.625,675.6406 Q425.625,675.9844 425.2813,676.3906 Q424.7813,676.9688 423.9844,677.2969 Q422.9063,677.75 421.6094,677.75 Q420.0938,677.75 418.8906,677.125 Q417.9063,676.625 417.2188,675.5547 Q416.5313,674.4844 416.5313,673.2031 L416.5313,672.0469 Q416.5313,670.7188 417.1484,669.5703 Q417.7656,668.4219 418.8594,667.8047 Q419.9531,667.1875 421.1875,667.1875 Q421.9219,667.1875 422.5703,667.3516 Q423.2188,667.5156 423.7656,667.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="435" y="676.9102">DefaultListableBeanFactory</text><line x1="407" x2="588" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="407" x2="588" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FF69B4" filter="url(#f1smzobyebq4t6)" height="48" id="BeanDefinitionRegistry" width="158" x="713.5" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="728.5" cy="564" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M729.4531,560.6406 L729.4531,567.2969 L731.1719,567.2969 Q731.7813,567.2969 732.0469,567.5313 Q732.3125,567.7656 732.3125,568.1563 Q732.3125,568.5313 732.0469,568.7656 Q731.7813,569 731.1719,569 L726.0313,569 Q725.4219,569 725.1563,568.7656 Q724.8906,568.5313 724.8906,568.1406 Q724.8906,567.7656 725.1563,567.5313 Q725.4219,567.2969 726.0313,567.2969 L727.75,567.2969 L727.75,560.6406 L726.0313,560.6406 Q725.4219,560.6406 725.1563,560.4063 Q724.8906,560.1719 724.8906,559.7813 Q724.8906,559.4063 725.1563,559.1719 Q725.4219,558.9375 726.0313,558.9375 L731.1719,558.9375 Q731.7813,558.9375 732.0469,559.1719 Q732.3125,559.4063 732.3125,559.7813 Q732.3125,560.1719 732.0469,560.4063 Q731.7813,560.6406 731.1719,560.6406 L729.4531,560.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="742.5" y="568.9102">BeanDefinitionRegistry</text><line x1="714.5" x2="870.5" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="714.5" x2="870.5" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="Serializable" width="99" x="197" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="212" cy="564" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M212.9531,560.6406 L212.9531,567.2969 L214.6719,567.2969 Q215.2813,567.2969 215.5469,567.5313 Q215.8125,567.7656 215.8125,568.1563 Q215.8125,568.5313 215.5469,568.7656 Q215.2813,569 214.6719,569 L209.5313,569 Q208.9219,569 208.6563,568.7656 Q208.3906,568.5313 208.3906,568.1406 Q208.3906,567.7656 208.6563,567.5313 Q208.9219,567.2969 209.5313,567.2969 L211.25,567.2969 L211.25,560.6406 L209.5313,560.6406 Q208.9219,560.6406 208.6563,560.4063 Q208.3906,560.1719 208.3906,559.7813 Q208.3906,559.4063 208.6563,559.1719 Q208.9219,558.9375 209.5313,558.9375 L214.6719,558.9375 Q215.2813,558.9375 215.5469,559.1719 Q215.8125,559.4063 215.8125,559.7813 Q215.8125,560.1719 215.5469,560.4063 Q215.2813,560.6406 214.6719,560.6406 L212.9531,560.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="226" y="568.9102">Serializable</text><line x1="198" x2="295" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="198" x2="295" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="XmlBeanFactory" width="121" x="437" y="764" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="452" cy="780" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M454.7656,775.875 Q454.9219,775.6563 455.1094,775.5469 Q455.2969,775.4375 455.5156,775.4375 Q455.8906,775.4375 456.125,775.6953 Q456.3594,775.9531 456.3594,776.5625 L456.3594,778.0156 Q456.3594,778.625 456.125,778.8906 Q455.8906,779.1563 455.5156,779.1563 Q455.1719,779.1563 454.9688,778.9531 Q454.7656,778.7656 454.6563,778.25 Q454.6094,777.8906 454.4219,777.7031 Q454.0938,777.3281 453.4844,777.1094 Q452.875,776.8906 452.25,776.8906 Q451.4844,776.8906 450.8516,777.2188 Q450.2188,777.5469 449.7266,778.2969 Q449.2344,779.0469 449.2344,780.0781 L449.2344,781.1719 Q449.2344,782.4063 450.125,783.2266 Q451.0156,784.0469 452.6094,784.0469 Q453.5469,784.0469 454.2031,783.7969 Q454.5938,783.6406 455.0156,783.2031 Q455.2813,782.9375 455.4297,782.8594 Q455.5781,782.7813 455.7813,782.7813 Q456.1094,782.7813 456.3672,783.0391 Q456.625,783.2969 456.625,783.6406 Q456.625,783.9844 456.2813,784.3906 Q455.7813,784.9688 454.9844,785.2969 Q453.9063,785.75 452.6094,785.75 Q451.0938,785.75 449.8906,785.125 Q448.9063,784.625 448.2188,783.5547 Q447.5313,782.4844 447.5313,781.2031 L447.5313,780.0469 Q447.5313,778.7188 448.1484,777.5703 Q448.7656,776.4219 449.8594,775.8047 Q450.9531,775.1875 452.1875,775.1875 Q452.9219,775.1875 453.5703,775.3516 Q454.2188,775.5156 454.7656,775.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="466" y="784.9102">XmlBeanFactory</text><line x1="438" x2="557" y1="796" y2="796" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="438" x2="557" y1="804" y2="804" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ResourceLoader" width="124" x="1291.5" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1306.5" cy="132" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1307.4531,128.6406 L1307.4531,135.2969 L1309.1719,135.2969 Q1309.7813,135.2969 1310.0469,135.5313 Q1310.3125,135.7656 1310.3125,136.1563 Q1310.3125,136.5313 1310.0469,136.7656 Q1309.7813,137 1309.1719,137 L1304.0313,137 Q1303.4219,137 1303.1563,136.7656 Q1302.8906,136.5313 1302.8906,136.1406 Q1302.8906,135.7656 1303.1563,135.5313 Q1303.4219,135.2969 1304.0313,135.2969 L1305.75,135.2969 L1305.75,128.6406 L1304.0313,128.6406 Q1303.4219,128.6406 1303.1563,128.4063 Q1302.8906,128.1719 1302.8906,127.7813 Q1302.8906,127.4063 1303.1563,127.1719 Q1303.4219,126.9375 1304.0313,126.9375 L1309.1719,126.9375 Q1309.7813,126.9375 1310.0469,127.1719 Q1310.3125,127.4063 1310.3125,127.7813 Q1310.3125,128.1719 1310.0469,128.4063 Q1309.7813,128.6406 1309.1719,128.6406 L1307.4531,128.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="92" x="1320.5" y="136.9102">ResourceLoader</text><line x1="1292.5" x2="1414.5" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1292.5" x2="1414.5" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="DefaultResourceLoader" width="164" x="1612.5" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1627.5" cy="456" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1630.2656,451.875 Q1630.4219,451.6563 1630.6094,451.5469 Q1630.7969,451.4375 1631.0156,451.4375 Q1631.3906,451.4375 1631.625,451.6953 Q1631.8594,451.9531 1631.8594,452.5625 L1631.8594,454.0156 Q1631.8594,454.625 1631.625,454.8906 Q1631.3906,455.1563 1631.0156,455.1563 Q1630.6719,455.1563 1630.4688,454.9531 Q1630.2656,454.7656 1630.1563,454.25 Q1630.1094,453.8906 1629.9219,453.7031 Q1629.5938,453.3281 1628.9844,453.1094 Q1628.375,452.8906 1627.75,452.8906 Q1626.9844,452.8906 1626.3516,453.2188 Q1625.7188,453.5469 1625.2266,454.2969 Q1624.7344,455.0469 1624.7344,456.0781 L1624.7344,457.1719 Q1624.7344,458.4063 1625.625,459.2266 Q1626.5156,460.0469 1628.1094,460.0469 Q1629.0469,460.0469 1629.7031,459.7969 Q1630.0938,459.6406 1630.5156,459.2031 Q1630.7813,458.9375 1630.9297,458.8594 Q1631.0781,458.7813 1631.2813,458.7813 Q1631.6094,458.7813 1631.8672,459.0391 Q1632.125,459.2969 1632.125,459.6406 Q1632.125,459.9844 1631.7813,460.3906 Q1631.2813,460.9688 1630.4844,461.2969 Q1629.4063,461.75 1628.1094,461.75 Q1626.5938,461.75 1625.3906,461.125 Q1624.4063,460.625 1623.7188,459.5547 Q1623.0313,458.4844 1623.0313,457.2031 L1623.0313,456.0469 Q1623.0313,454.7188 1623.6484,453.5703 Q1624.2656,452.4219 1625.3594,451.8047 Q1626.4531,451.1875 1627.6875,451.1875 Q1628.4219,451.1875 1629.0703,451.3516 Q1629.7188,451.5156 1630.2656,451.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="1641.5" y="460.9102">DefaultResourceLoader</text><line x1="1613.5" x2="1775.5" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1613.5" x2="1775.5" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ConfigurableApplicationContext" width="207" x="1279" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1294" cy="456" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1294.9531,452.6406 L1294.9531,459.2969 L1296.6719,459.2969 Q1297.2813,459.2969 1297.5469,459.5313 Q1297.8125,459.7656 1297.8125,460.1563 Q1297.8125,460.5313 1297.5469,460.7656 Q1297.2813,461 1296.6719,461 L1291.5313,461 Q1290.9219,461 1290.6563,460.7656 Q1290.3906,460.5313 1290.3906,460.1406 Q1290.3906,459.7656 1290.6563,459.5313 Q1290.9219,459.2969 1291.5313,459.2969 L1293.25,459.2969 L1293.25,452.6406 L1291.5313,452.6406 Q1290.9219,452.6406 1290.6563,452.4063 Q1290.3906,452.1719 1290.3906,451.7813 Q1290.3906,451.4063 1290.6563,451.1719 Q1290.9219,450.9375 1291.5313,450.9375 L1296.6719,450.9375 Q1297.2813,450.9375 1297.5469,451.1719 Q1297.8125,451.4063 1297.8125,451.7813 Q1297.8125,452.1719 1297.5469,452.4063 Q1297.2813,452.6406 1296.6719,452.6406 L1294.9531,452.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="175" x="1308" y="460.9102">ConfigurableApplicationContext</text><line x1="1280" x2="1485" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1280" x2="1485" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="Lifecycle" width="80" x="1462.5" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1477.5" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1478.4531,344.6406 L1478.4531,351.2969 L1480.1719,351.2969 Q1480.7813,351.2969 1481.0469,351.5313 Q1481.3125,351.7656 1481.3125,352.1563 Q1481.3125,352.5313 1481.0469,352.7656 Q1480.7813,353 1480.1719,353 L1475.0313,353 Q1474.4219,353 1474.1563,352.7656 Q1473.8906,352.5313 1473.8906,352.1406 Q1473.8906,351.7656 1474.1563,351.5313 Q1474.4219,351.2969 1475.0313,351.2969 L1476.75,351.2969 L1476.75,344.6406 L1475.0313,344.6406 Q1474.4219,344.6406 1474.1563,344.4063 Q1473.8906,344.1719 1473.8906,343.7813 Q1473.8906,343.4063 1474.1563,343.1719 Q1474.4219,342.9375 1475.0313,342.9375 L1480.1719,342.9375 Q1480.7813,342.9375 1481.0469,343.1719 Q1481.3125,343.4063 1481.3125,343.7813 Q1481.3125,344.1719 1481.0469,344.4063 Q1480.7813,344.6406 1480.1719,344.6406 L1478.4531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="48" x="1491.5" y="352.9102">Lifecycle</text><line x1="1463.5" x2="1541.5" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1463.5" x2="1541.5" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="Closeable" width="89" x="1338" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1353" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1353.9531,344.6406 L1353.9531,351.2969 L1355.6719,351.2969 Q1356.2813,351.2969 1356.5469,351.5313 Q1356.8125,351.7656 1356.8125,352.1563 Q1356.8125,352.5313 1356.5469,352.7656 Q1356.2813,353 1355.6719,353 L1350.5313,353 Q1349.9219,353 1349.6563,352.7656 Q1349.3906,352.5313 1349.3906,352.1406 Q1349.3906,351.7656 1349.6563,351.5313 Q1349.9219,351.2969 1350.5313,351.2969 L1352.25,351.2969 L1352.25,344.6406 L1350.5313,344.6406 Q1349.9219,344.6406 1349.6563,344.4063 Q1349.3906,344.1719 1349.3906,343.7813 Q1349.3906,343.4063 1349.6563,343.1719 Q1349.9219,342.9375 1350.5313,342.9375 L1355.6719,342.9375 Q1356.2813,342.9375 1356.5469,343.1719 Q1356.8125,343.4063 1356.8125,343.7813 Q1356.8125,344.1719 1356.5469,344.4063 Q1356.2813,344.6406 1355.6719,344.6406 L1353.9531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="57" x="1367" y="352.9102">Closeable</text><line x1="1339" x2="1426" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1339" x2="1426" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AutoCloseable" width="114" x="1607.5" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1622.5" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1623.4531,236.6406 L1623.4531,243.2969 L1625.1719,243.2969 Q1625.7813,243.2969 1626.0469,243.5313 Q1626.3125,243.7656 1626.3125,244.1563 Q1626.3125,244.5313 1626.0469,244.7656 Q1625.7813,245 1625.1719,245 L1620.0313,245 Q1619.4219,245 1619.1563,244.7656 Q1618.8906,244.5313 1618.8906,244.1406 Q1618.8906,243.7656 1619.1563,243.5313 Q1619.4219,243.2969 1620.0313,243.2969 L1621.75,243.2969 L1621.75,236.6406 L1620.0313,236.6406 Q1619.4219,236.6406 1619.1563,236.4063 Q1618.8906,236.1719 1618.8906,235.7813 Q1618.8906,235.4063 1619.1563,235.1719 Q1619.4219,234.9375 1620.0313,234.9375 L1625.1719,234.9375 Q1625.7813,234.9375 1626.0469,235.1719 Q1626.3125,235.4063 1626.3125,235.7813 Q1626.3125,236.1719 1626.0469,236.4063 Q1625.7813,236.6406 1625.1719,236.6406 L1623.4531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="82" x="1636.5" y="244.9102">AutoCloseable</text><line x1="1608.5" x2="1720.5" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1608.5" x2="1720.5" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractApplicationContext" width="180" x="1326.5" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1341.5" cy="564" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1343.6875,565.7656 L1339.5469,565.7656 L1339.125,566.7969 L1339.5469,566.7969 Q1340.1563,566.7969 1340.4219,567.0313 Q1340.6875,567.2656 1340.6875,567.6563 Q1340.6875,568.0313 1340.4219,568.2656 Q1340.1563,568.5 1339.5469,568.5 L1337.25,568.5 Q1336.6406,568.5 1336.3828,568.2656 Q1336.125,568.0313 1336.125,567.6406 Q1336.125,567.2656 1336.3984,567.0234 Q1336.6719,566.7813 1337.2969,566.7969 L1339.9688,560.1406 L1338.8594,560.1406 Q1338.25,560.1406 1337.9844,559.9063 Q1337.7188,559.6719 1337.7188,559.2813 Q1337.7188,558.9063 1337.9844,558.6719 Q1338.25,558.4375 1338.8594,558.4375 L1342.5313,558.4375 L1345.9219,566.7969 Q1346.5156,566.7969 1346.7031,566.9375 Q1347.0938,567.2031 1347.0938,567.6563 Q1347.0938,568.0313 1346.8359,568.2656 Q1346.5781,568.5 1345.9688,568.5 L1343.6719,568.5 Q1343.0625,568.5 1342.7969,568.2656 Q1342.5313,568.0313 1342.5313,567.6406 Q1342.5313,567.2656 1342.7969,567.0313 Q1343.0625,566.7969 1343.6719,566.7969 L1344.0938,566.7969 L1343.6875,565.7656 Z M1342.9688,564.0625 L1341.6094,560.6875 L1340.2344,564.0625 L1342.9688,564.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="148" x="1355.5" y="568.9102">AbstractApplicationContext</text><line x1="1327.5" x2="1505.5" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1327.5" x2="1505.5" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractRefreshableApplicationContext" width="248" x="1318.5" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1333.5" cy="672" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1335.6875,673.7656 L1331.5469,673.7656 L1331.125,674.7969 L1331.5469,674.7969 Q1332.1563,674.7969 1332.4219,675.0313 Q1332.6875,675.2656 1332.6875,675.6563 Q1332.6875,676.0313 1332.4219,676.2656 Q1332.1563,676.5 1331.5469,676.5 L1329.25,676.5 Q1328.6406,676.5 1328.3828,676.2656 Q1328.125,676.0313 1328.125,675.6406 Q1328.125,675.2656 1328.3984,675.0234 Q1328.6719,674.7813 1329.2969,674.7969 L1331.9688,668.1406 L1330.8594,668.1406 Q1330.25,668.1406 1329.9844,667.9063 Q1329.7188,667.6719 1329.7188,667.2813 Q1329.7188,666.9063 1329.9844,666.6719 Q1330.25,666.4375 1330.8594,666.4375 L1334.5313,666.4375 L1337.9219,674.7969 Q1338.5156,674.7969 1338.7031,674.9375 Q1339.0938,675.2031 1339.0938,675.6563 Q1339.0938,676.0313 1338.8359,676.2656 Q1338.5781,676.5 1337.9688,676.5 L1335.6719,676.5 Q1335.0625,676.5 1334.7969,676.2656 Q1334.5313,676.0313 1334.5313,675.6406 Q1334.5313,675.2656 1334.7969,675.0313 Q1335.0625,674.7969 1335.6719,674.7969 L1336.0938,674.7969 L1335.6875,673.7656 Z M1334.9688,672.0625 L1333.6094,668.6875 L1332.2344,672.0625 L1334.9688,672.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="216" x="1347.5" y="676.9102">AbstractRefreshableApplicationContext</text><line x1="1319.5" x2="1565.5" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1319.5" x2="1565.5" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractRefreshableConfigApplicationContext" width="284" x="1305.5" y="764" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1320.5" cy="780" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1322.6875,781.7656 L1318.5469,781.7656 L1318.125,782.7969 L1318.5469,782.7969 Q1319.1563,782.7969 1319.4219,783.0313 Q1319.6875,783.2656 1319.6875,783.6563 Q1319.6875,784.0313 1319.4219,784.2656 Q1319.1563,784.5 1318.5469,784.5 L1316.25,784.5 Q1315.6406,784.5 1315.3828,784.2656 Q1315.125,784.0313 1315.125,783.6406 Q1315.125,783.2656 1315.3984,783.0234 Q1315.6719,782.7813 1316.2969,782.7969 L1318.9688,776.1406 L1317.8594,776.1406 Q1317.25,776.1406 1316.9844,775.9063 Q1316.7188,775.6719 1316.7188,775.2813 Q1316.7188,774.9063 1316.9844,774.6719 Q1317.25,774.4375 1317.8594,774.4375 L1321.5313,774.4375 L1324.9219,782.7969 Q1325.5156,782.7969 1325.7031,782.9375 Q1326.0938,783.2031 1326.0938,783.6563 Q1326.0938,784.0313 1325.8359,784.2656 Q1325.5781,784.5 1324.9688,784.5 L1322.6719,784.5 Q1322.0625,784.5 1321.7969,784.2656 Q1321.5313,784.0313 1321.5313,783.6406 Q1321.5313,783.2656 1321.7969,783.0313 Q1322.0625,782.7969 1322.6719,782.7969 L1323.0938,782.7969 L1322.6875,781.7656 Z M1321.9688,780.0625 L1320.6094,776.6875 L1319.2344,780.0625 L1321.9688,780.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="252" x="1334.5" y="784.9102">AbstractRefreshableConfigApplicationContext</text><line x1="1306.5" x2="1588.5" y1="796" y2="796" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1306.5" x2="1588.5" y1="804" y2="804" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="BeanNameAware" width="129" x="1602" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1617" cy="672" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1617.9531,668.6406 L1617.9531,675.2969 L1619.6719,675.2969 Q1620.2813,675.2969 1620.5469,675.5313 Q1620.8125,675.7656 1620.8125,676.1563 Q1620.8125,676.5313 1620.5469,676.7656 Q1620.2813,677 1619.6719,677 L1614.5313,677 Q1613.9219,677 1613.6563,676.7656 Q1613.3906,676.5313 1613.3906,676.1406 Q1613.3906,675.7656 1613.6563,675.5313 Q1613.9219,675.2969 1614.5313,675.2969 L1616.25,675.2969 L1616.25,668.6406 L1614.5313,668.6406 Q1613.9219,668.6406 1613.6563,668.4063 Q1613.3906,668.1719 1613.3906,667.7813 Q1613.3906,667.4063 1613.6563,667.1719 Q1613.9219,666.9375 1614.5313,666.9375 L1619.6719,666.9375 Q1620.2813,666.9375 1620.5469,667.1719 Q1620.8125,667.4063 1620.8125,667.7813 Q1620.8125,668.1719 1620.5469,668.4063 Q1620.2813,668.6406 1619.6719,668.6406 L1617.9531,668.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="97" x="1631" y="676.9102">BeanNameAware</text><line x1="1603" x2="1730" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1603" x2="1730" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="InitializingBean" width="118" x="1165.5" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1180.5" cy="672" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1181.4531,668.6406 L1181.4531,675.2969 L1183.1719,675.2969 Q1183.7813,675.2969 1184.0469,675.5313 Q1184.3125,675.7656 1184.3125,676.1563 Q1184.3125,676.5313 1184.0469,676.7656 Q1183.7813,677 1183.1719,677 L1178.0313,677 Q1177.4219,677 1177.1563,676.7656 Q1176.8906,676.5313 1176.8906,676.1406 Q1176.8906,675.7656 1177.1563,675.5313 Q1177.4219,675.2969 1178.0313,675.2969 L1179.75,675.2969 L1179.75,668.6406 L1178.0313,668.6406 Q1177.4219,668.6406 1177.1563,668.4063 Q1176.8906,668.1719 1176.8906,667.7813 Q1176.8906,667.4063 1177.1563,667.1719 Q1177.4219,666.9375 1178.0313,666.9375 L1183.1719,666.9375 Q1183.7813,666.9375 1184.0469,667.1719 Q1184.3125,667.4063 1184.3125,667.7813 Q1184.3125,668.1719 1184.0469,668.4063 Q1183.7813,668.6406 1183.1719,668.6406 L1181.4531,668.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="86" x="1194.5" y="676.9102">InitializingBean</text><line x1="1166.5" x2="1282.5" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1166.5" x2="1282.5" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="Aware" width="66" x="1633.5" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1648.5" cy="564" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1649.4531,560.6406 L1649.4531,567.2969 L1651.1719,567.2969 Q1651.7813,567.2969 1652.0469,567.5313 Q1652.3125,567.7656 1652.3125,568.1563 Q1652.3125,568.5313 1652.0469,568.7656 Q1651.7813,569 1651.1719,569 L1646.0313,569 Q1645.4219,569 1645.1563,568.7656 Q1644.8906,568.5313 1644.8906,568.1406 Q1644.8906,567.7656 1645.1563,567.5313 Q1645.4219,567.2969 1646.0313,567.2969 L1647.75,567.2969 L1647.75,560.6406 L1646.0313,560.6406 Q1645.4219,560.6406 1645.1563,560.4063 Q1644.8906,560.1719 1644.8906,559.7813 Q1644.8906,559.4063 1645.1563,559.1719 Q1645.4219,558.9375 1646.0313,558.9375 L1651.1719,558.9375 Q1651.7813,558.9375 1652.0469,559.1719 Q1652.3125,559.4063 1652.3125,559.7813 Q1652.3125,560.1719 1652.0469,560.4063 Q1651.7813,560.6406 1651.1719,560.6406 L1649.4531,560.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="34" x="1662.5" y="568.9102">Aware</text><line x1="1634.5" x2="1698.5" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1634.5" x2="1698.5" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractXmlApplicationContext" width="202" x="1346.5" y="872" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1361.5" cy="888" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1363.6875,889.7656 L1359.5469,889.7656 L1359.125,890.7969 L1359.5469,890.7969 Q1360.1563,890.7969 1360.4219,891.0313 Q1360.6875,891.2656 1360.6875,891.6563 Q1360.6875,892.0313 1360.4219,892.2656 Q1360.1563,892.5 1359.5469,892.5 L1357.25,892.5 Q1356.6406,892.5 1356.3828,892.2656 Q1356.125,892.0313 1356.125,891.6406 Q1356.125,891.2656 1356.3984,891.0234 Q1356.6719,890.7813 1357.2969,890.7969 L1359.9688,884.1406 L1358.8594,884.1406 Q1358.25,884.1406 1357.9844,883.9063 Q1357.7188,883.6719 1357.7188,883.2813 Q1357.7188,882.9063 1357.9844,882.6719 Q1358.25,882.4375 1358.8594,882.4375 L1362.5313,882.4375 L1365.9219,890.7969 Q1366.5156,890.7969 1366.7031,890.9375 Q1367.0938,891.2031 1367.0938,891.6563 Q1367.0938,892.0313 1366.8359,892.2656 Q1366.5781,892.5 1365.9688,892.5 L1363.6719,892.5 Q1363.0625,892.5 1362.7969,892.2656 Q1362.5313,892.0313 1362.5313,891.6406 Q1362.5313,891.2656 1362.7969,891.0313 Q1363.0625,890.7969 1363.6719,890.7969 L1364.0938,890.7969 L1363.6875,889.7656 Z M1362.9688,888.0625 L1361.6094,884.6875 L1360.2344,888.0625 L1362.9688,888.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="170" x="1375.5" y="892.9102">AbstractXmlApplicationContext</text><line x1="1347.5" x2="1547.5" y1="904" y2="904" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1347.5" x2="1547.5" y1="912" y2="912" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="ClassPathXmlApplicationContext" width="212" x="1303.5" y="980" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1318.5" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1321.2656,991.875 Q1321.4219,991.6563 1321.6094,991.5469 Q1321.7969,991.4375 1322.0156,991.4375 Q1322.3906,991.4375 1322.625,991.6953 Q1322.8594,991.9531 1322.8594,992.5625 L1322.8594,994.0156 Q1322.8594,994.625 1322.625,994.8906 Q1322.3906,995.1563 1322.0156,995.1563 Q1321.6719,995.1563 1321.4688,994.9531 Q1321.2656,994.7656 1321.1563,994.25 Q1321.1094,993.8906 1320.9219,993.7031 Q1320.5938,993.3281 1319.9844,993.1094 Q1319.375,992.8906 1318.75,992.8906 Q1317.9844,992.8906 1317.3516,993.2188 Q1316.7188,993.5469 1316.2266,994.2969 Q1315.7344,995.0469 1315.7344,996.0781 L1315.7344,997.1719 Q1315.7344,998.4063 1316.625,999.2266 Q1317.5156,1000.0469 1319.1094,1000.0469 Q1320.0469,1000.0469 1320.7031,999.7969 Q1321.0938,999.6406 1321.5156,999.2031 Q1321.7813,998.9375 1321.9297,998.8594 Q1322.0781,998.7813 1322.2813,998.7813 Q1322.6094,998.7813 1322.8672,999.0391 Q1323.125,999.2969 1323.125,999.6406 Q1323.125,999.9844 1322.7813,1000.3906 Q1322.2813,1000.9688 1321.4844,1001.2969 Q1320.4063,1001.75 1319.1094,1001.75 Q1317.5938,1001.75 1316.3906,1001.125 Q1315.4063,1000.625 1314.7188,999.5547 Q1314.0313,998.4844 1314.0313,997.2031 L1314.0313,996.0469 Q1314.0313,994.7188 1314.6484,993.5703 Q1315.2656,992.4219 1316.3594,991.8047 Q1317.4531,991.1875 1318.6875,991.1875 Q1319.4219,991.1875 1320.0703,991.3516 Q1320.7188,991.5156 1321.2656,991.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="1332.5" y="1000.9102">ClassPathXmlApplicationContext</text><line x1="1304.5" x2="1514.5" y1="1012" y2="1012" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1304.5" x2="1514.5" y1="1020" y2="1020" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="FileSystemXmlApplicationContext" width="215" x="1551" y="980" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1566" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1568.7656,991.875 Q1568.9219,991.6563 1569.1094,991.5469 Q1569.2969,991.4375 1569.5156,991.4375 Q1569.8906,991.4375 1570.125,991.6953 Q1570.3594,991.9531 1570.3594,992.5625 L1570.3594,994.0156 Q1570.3594,994.625 1570.125,994.8906 Q1569.8906,995.1563 1569.5156,995.1563 Q1569.1719,995.1563 1568.9688,994.9531 Q1568.7656,994.7656 1568.6563,994.25 Q1568.6094,993.8906 1568.4219,993.7031 Q1568.0938,993.3281 1567.4844,993.1094 Q1566.875,992.8906 1566.25,992.8906 Q1565.4844,992.8906 1564.8516,993.2188 Q1564.2188,993.5469 1563.7266,994.2969 Q1563.2344,995.0469 1563.2344,996.0781 L1563.2344,997.1719 Q1563.2344,998.4063 1564.125,999.2266 Q1565.0156,1000.0469 1566.6094,1000.0469 Q1567.5469,1000.0469 1568.2031,999.7969 Q1568.5938,999.6406 1569.0156,999.2031 Q1569.2813,998.9375 1569.4297,998.8594 Q1569.5781,998.7813 1569.7813,998.7813 Q1570.1094,998.7813 1570.3672,999.0391 Q1570.625,999.2969 1570.625,999.6406 Q1570.625,999.9844 1570.2813,1000.3906 Q1569.7813,1000.9688 1568.9844,1001.2969 Q1567.9063,1001.75 1566.6094,1001.75 Q1565.0938,1001.75 1563.8906,1001.125 Q1562.9063,1000.625 1562.2188,999.5547 Q1561.5313,998.4844 1561.5313,997.2031 L1561.5313,996.0469 Q1561.5313,994.7188 1562.1484,993.5703 Q1562.7656,992.4219 1563.8594,991.8047 Q1564.9531,991.1875 1566.1875,991.1875 Q1566.9219,991.1875 1567.5703,991.3516 Q1568.2188,991.5156 1568.7656,991.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="183" x="1580" y="1000.9102">FileSystemXmlApplicationContext</text><line x1="1552" x2="1765" y1="1012" y2="1012" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1552" x2="1765" y1="1020" y2="1020" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="AbstractRefreshableWebApplicationContext" width="274" x="1003.5" y="872" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1018.5" cy="888" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1020.6875,889.7656 L1016.5469,889.7656 L1016.125,890.7969 L1016.5469,890.7969 Q1017.1563,890.7969 1017.4219,891.0313 Q1017.6875,891.2656 1017.6875,891.6563 Q1017.6875,892.0313 1017.4219,892.2656 Q1017.1563,892.5 1016.5469,892.5 L1014.25,892.5 Q1013.6406,892.5 1013.3828,892.2656 Q1013.125,892.0313 1013.125,891.6406 Q1013.125,891.2656 1013.3984,891.0234 Q1013.6719,890.7813 1014.2969,890.7969 L1016.9688,884.1406 L1015.8594,884.1406 Q1015.25,884.1406 1014.9844,883.9063 Q1014.7188,883.6719 1014.7188,883.2813 Q1014.7188,882.9063 1014.9844,882.6719 Q1015.25,882.4375 1015.8594,882.4375 L1019.5313,882.4375 L1022.9219,890.7969 Q1023.5156,890.7969 1023.7031,890.9375 Q1024.0938,891.2031 1024.0938,891.6563 Q1024.0938,892.0313 1023.8359,892.2656 Q1023.5781,892.5 1022.9688,892.5 L1020.6719,892.5 Q1020.0625,892.5 1019.7969,892.2656 Q1019.5313,892.0313 1019.5313,891.6406 Q1019.5313,891.2656 1019.7969,891.0313 Q1020.0625,890.7969 1020.6719,890.7969 L1021.0938,890.7969 L1020.6875,889.7656 Z M1019.9688,888.0625 L1018.6094,884.6875 L1017.2344,888.0625 L1019.9688,888.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="242" x="1032.5" y="892.9102">AbstractRefreshableWebApplicationContext</text><line x1="1004.5" x2="1276.5" y1="904" y2="904" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1004.5" x2="1276.5" y1="912" y2="912" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ConfigurableWebApplicationContext" width="233" x="1013" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1028" cy="564" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1028.9531,560.6406 L1028.9531,567.2969 L1030.6719,567.2969 Q1031.2813,567.2969 1031.5469,567.5313 Q1031.8125,567.7656 1031.8125,568.1563 Q1031.8125,568.5313 1031.5469,568.7656 Q1031.2813,569 1030.6719,569 L1025.5313,569 Q1024.9219,569 1024.6563,568.7656 Q1024.3906,568.5313 1024.3906,568.1406 Q1024.3906,567.7656 1024.6563,567.5313 Q1024.9219,567.2969 1025.5313,567.2969 L1027.25,567.2969 L1027.25,560.6406 L1025.5313,560.6406 Q1024.9219,560.6406 1024.6563,560.4063 Q1024.3906,560.1719 1024.3906,559.7813 Q1024.3906,559.4063 1024.6563,559.1719 Q1024.9219,558.9375 1025.5313,558.9375 L1030.6719,558.9375 Q1031.2813,558.9375 1031.5469,559.1719 Q1031.8125,559.4063 1031.8125,559.7813 Q1031.8125,560.1719 1031.5469,560.4063 Q1031.2813,560.6406 1030.6719,560.6406 L1028.9531,560.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="201" x="1042" y="568.9102">ConfigurableWebApplicationContext</text><line x1="1014" x2="1245" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1014" x2="1245" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="ThemeSource" width="110" x="1160.5" y="764" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1175.5" cy="780" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1176.4531,776.6406 L1176.4531,783.2969 L1178.1719,783.2969 Q1178.7813,783.2969 1179.0469,783.5313 Q1179.3125,783.7656 1179.3125,784.1563 Q1179.3125,784.5313 1179.0469,784.7656 Q1178.7813,785 1178.1719,785 L1173.0313,785 Q1172.4219,785 1172.1563,784.7656 Q1171.8906,784.5313 1171.8906,784.1406 Q1171.8906,783.7656 1172.1563,783.5313 Q1172.4219,783.2969 1173.0313,783.2969 L1174.75,783.2969 L1174.75,776.6406 L1173.0313,776.6406 Q1172.4219,776.6406 1172.1563,776.4063 Q1171.8906,776.1719 1171.8906,775.7813 Q1171.8906,775.4063 1172.1563,775.1719 Q1172.4219,774.9375 1173.0313,774.9375 L1178.1719,774.9375 Q1178.7813,774.9375 1179.0469,775.1719 Q1179.3125,775.4063 1179.3125,775.7813 Q1179.3125,776.1719 1179.0469,776.4063 Q1178.7813,776.6406 1178.1719,776.6406 L1176.4531,776.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="78" x="1189.5" y="784.9102">ThemeSource</text><line x1="1161.5" x2="1269.5" y1="796" y2="796" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1161.5" x2="1269.5" y1="804" y2="804" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="XmlWebApplicationContext" width="179" x="1051" y="980" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1066" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1068.7656,991.875 Q1068.9219,991.6563 1069.1094,991.5469 Q1069.2969,991.4375 1069.5156,991.4375 Q1069.8906,991.4375 1070.125,991.6953 Q1070.3594,991.9531 1070.3594,992.5625 L1070.3594,994.0156 Q1070.3594,994.625 1070.125,994.8906 Q1069.8906,995.1563 1069.5156,995.1563 Q1069.1719,995.1563 1068.9688,994.9531 Q1068.7656,994.7656 1068.6563,994.25 Q1068.6094,993.8906 1068.4219,993.7031 Q1068.0938,993.3281 1067.4844,993.1094 Q1066.875,992.8906 1066.25,992.8906 Q1065.4844,992.8906 1064.8516,993.2188 Q1064.2188,993.5469 1063.7266,994.2969 Q1063.2344,995.0469 1063.2344,996.0781 L1063.2344,997.1719 Q1063.2344,998.4063 1064.125,999.2266 Q1065.0156,1000.0469 1066.6094,1000.0469 Q1067.5469,1000.0469 1068.2031,999.7969 Q1068.5938,999.6406 1069.0156,999.2031 Q1069.2813,998.9375 1069.4297,998.8594 Q1069.5781,998.7813 1069.7813,998.7813 Q1070.1094,998.7813 1070.3672,999.0391 Q1070.625,999.2969 1070.625,999.6406 Q1070.625,999.9844 1070.2813,1000.3906 Q1069.7813,1000.9688 1068.9844,1001.2969 Q1067.9063,1001.75 1066.6094,1001.75 Q1065.0938,1001.75 1063.8906,1001.125 Q1062.9063,1000.625 1062.2188,999.5547 Q1061.5313,998.4844 1061.5313,997.2031 L1061.5313,996.0469 Q1061.5313,994.7188 1062.1484,993.5703 Q1062.7656,992.4219 1063.8594,991.8047 Q1064.9531,991.1875 1066.1875,991.1875 Q1066.9219,991.1875 1067.5703,991.3516 Q1068.2188,991.5156 1068.7656,991.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="1080" y="1000.9102">XmlWebApplicationContext</text><line x1="1052" x2="1229" y1="1012" y2="1012" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1052" x2="1229" y1="1020" y2="1020" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="WebApplicationContext" width="161" x="1049" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="1064" cy="456" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M1064.9531,452.6406 L1064.9531,459.2969 L1066.6719,459.2969 Q1067.2813,459.2969 1067.5469,459.5313 Q1067.8125,459.7656 1067.8125,460.1563 Q1067.8125,460.5313 1067.5469,460.7656 Q1067.2813,461 1066.6719,461 L1061.5313,461 Q1060.9219,461 1060.6563,460.7656 Q1060.3906,460.5313 1060.3906,460.1406 Q1060.3906,459.7656 1060.6563,459.5313 Q1060.9219,459.2969 1061.5313,459.2969 L1063.25,459.2969 L1063.25,452.6406 L1061.5313,452.6406 Q1060.9219,452.6406 1060.6563,452.4063 Q1060.3906,452.1719 1060.3906,451.7813 Q1060.3906,451.4063 1060.6563,451.1719 Q1060.9219,450.9375 1061.5313,450.9375 L1066.6719,450.9375 Q1067.2813,450.9375 1067.5469,451.1719 Q1067.8125,451.4063 1067.8125,451.7813 Q1067.8125,452.1719 1067.5469,452.4063 Q1067.2813,452.6406 1066.6719,452.6406 L1064.9531,452.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="129" x="1078" y="460.9102">WebApplicationContext</text><line x1="1050" x2="1209" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="1050" x2="1209" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1smzobyebq4t6)" height="48" id="GenericApplicationContext" width="176" x="878.5" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="893.5" cy="672" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M896.2656,667.875 Q896.4219,667.6563 896.6094,667.5469 Q896.7969,667.4375 897.0156,667.4375 Q897.3906,667.4375 897.625,667.6953 Q897.8594,667.9531 897.8594,668.5625 L897.8594,670.0156 Q897.8594,670.625 897.625,670.8906 Q897.3906,671.1563 897.0156,671.1563 Q896.6719,671.1563 896.4688,670.9531 Q896.2656,670.7656 896.1563,670.25 Q896.1094,669.8906 895.9219,669.7031 Q895.5938,669.3281 894.9844,669.1094 Q894.375,668.8906 893.75,668.8906 Q892.9844,668.8906 892.3516,669.2188 Q891.7188,669.5469 891.2266,670.2969 Q890.7344,671.0469 890.7344,672.0781 L890.7344,673.1719 Q890.7344,674.4063 891.625,675.2266 Q892.5156,676.0469 894.1094,676.0469 Q895.0469,676.0469 895.7031,675.7969 Q896.0938,675.6406 896.5156,675.2031 Q896.7813,674.9375 896.9297,674.8594 Q897.0781,674.7813 897.2813,674.7813 Q897.6094,674.7813 897.8672,675.0391 Q898.125,675.2969 898.125,675.6406 Q898.125,675.9844 897.7813,676.3906 Q897.2813,676.9688 896.4844,677.2969 Q895.4063,677.75 894.1094,677.75 Q892.5938,677.75 891.3906,677.125 Q890.4063,676.625 889.7188,675.5547 Q889.0313,674.4844 889.0313,673.2031 L889.0313,672.0469 Q889.0313,670.7188 889.6484,669.5703 Q890.2656,668.4219 891.3594,667.8047 Q892.4531,667.1875 893.6875,667.1875 Q894.4219,667.1875 895.0703,667.3516 Q895.7188,667.5156 896.2656,667.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="144" x="907.5" y="676.9102">GenericApplicationContext</text><line x1="879.5" x2="1053.5" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="879.5" x2="1053.5" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="AnnotationConfigApplicationContext" width="227" x="823" y="764" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="838" cy="780" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M840.7656,775.875 Q840.9219,775.6563 841.1094,775.5469 Q841.2969,775.4375 841.5156,775.4375 Q841.8906,775.4375 842.125,775.6953 Q842.3594,775.9531 842.3594,776.5625 L842.3594,778.0156 Q842.3594,778.625 842.125,778.8906 Q841.8906,779.1563 841.5156,779.1563 Q841.1719,779.1563 840.9688,778.9531 Q840.7656,778.7656 840.6563,778.25 Q840.6094,777.8906 840.4219,777.7031 Q840.0938,777.3281 839.4844,777.1094 Q838.875,776.8906 838.25,776.8906 Q837.4844,776.8906 836.8516,777.2188 Q836.2188,777.5469 835.7266,778.2969 Q835.2344,779.0469 835.2344,780.0781 L835.2344,781.1719 Q835.2344,782.4063 836.125,783.2266 Q837.0156,784.0469 838.6094,784.0469 Q839.5469,784.0469 840.2031,783.7969 Q840.5938,783.6406 841.0156,783.2031 Q841.2813,782.9375 841.4297,782.8594 Q841.5781,782.7813 841.7813,782.7813 Q842.1094,782.7813 842.3672,783.0391 Q842.625,783.2969 842.625,783.6406 Q842.625,783.9844 842.2813,784.3906 Q841.7813,784.9688 840.9844,785.2969 Q839.9063,785.75 838.6094,785.75 Q837.0938,785.75 835.8906,785.125 Q834.9063,784.625 834.2188,783.5547 Q833.5313,782.4844 833.5313,781.2031 L833.5313,780.0469 Q833.5313,778.7188 834.1484,777.5703 Q834.7656,776.4219 835.8594,775.8047 Q836.9531,775.1875 838.1875,775.1875 Q838.9219,775.1875 839.5703,775.3516 Q840.2188,775.5156 840.7656,775.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="195" x="852" y="784.9102">AnnotationConfigApplicationContext</text><line x1="824" x2="1049" y1="796" y2="796" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="824" x2="1049" y1="804" y2="804" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1smzobyebq4t6)" height="48" id="AnnotationConfigRegistry" width="172" x="671.5" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="686.5" cy="672" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M687.4531,668.6406 L687.4531,675.2969 L689.1719,675.2969 Q689.7813,675.2969 690.0469,675.5313 Q690.3125,675.7656 690.3125,676.1563 Q690.3125,676.5313 690.0469,676.7656 Q689.7813,677 689.1719,677 L684.0313,677 Q683.4219,677 683.1563,676.7656 Q682.8906,676.5313 682.8906,676.1406 Q682.8906,675.7656 683.1563,675.5313 Q683.4219,675.2969 684.0313,675.2969 L685.75,675.2969 L685.75,668.6406 L684.0313,668.6406 Q683.4219,668.6406 683.1563,668.4063 Q682.8906,668.1719 682.8906,667.7813 Q682.8906,667.4063 683.1563,667.1719 Q683.4219,666.9375 684.0313,666.9375 L689.1719,666.9375 Q689.7813,666.9375 690.0469,667.1719 Q690.3125,667.4063 690.3125,667.7813 Q690.3125,668.1719 690.0469,668.4063 Q689.7813,668.6406 689.1719,668.6406 L687.4531,668.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="140" x="700.5" y="676.9102">AnnotationConfigRegistry</text><line x1="672.5" x2="842.5" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="672.5" x2="842.5" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#00FFFF" filter="url(#f1smzobyebq4t6)" height="48" id="AnnotationConfigWebApplicationContext" width="252" x="699.5" y="980" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="714.5" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M717.2656,991.875 Q717.4219,991.6563 717.6094,991.5469 Q717.7969,991.4375 718.0156,991.4375 Q718.3906,991.4375 718.625,991.6953 Q718.8594,991.9531 718.8594,992.5625 L718.8594,994.0156 Q718.8594,994.625 718.625,994.8906 Q718.3906,995.1563 718.0156,995.1563 Q717.6719,995.1563 717.4688,994.9531 Q717.2656,994.7656 717.1563,994.25 Q717.1094,993.8906 716.9219,993.7031 Q716.5938,993.3281 715.9844,993.1094 Q715.375,992.8906 714.75,992.8906 Q713.9844,992.8906 713.3516,993.2188 Q712.7188,993.5469 712.2266,994.2969 Q711.7344,995.0469 711.7344,996.0781 L711.7344,997.1719 Q711.7344,998.4063 712.625,999.2266 Q713.5156,1000.0469 715.1094,1000.0469 Q716.0469,1000.0469 716.7031,999.7969 Q717.0938,999.6406 717.5156,999.2031 Q717.7813,998.9375 717.9297,998.8594 Q718.0781,998.7813 718.2813,998.7813 Q718.6094,998.7813 718.8672,999.0391 Q719.125,999.2969 719.125,999.6406 Q719.125,999.9844 718.7813,1000.3906 Q718.2813,1000.9688 717.4844,1001.2969 Q716.4063,1001.75 715.1094,1001.75 Q713.5938,1001.75 712.3906,1001.125 Q711.4063,1000.625 710.7188,999.5547 Q710.0313,998.4844 710.0313,997.2031 L710.0313,996.0469 Q710.0313,994.7188 710.6484,993.5703 Q711.2656,992.4219 712.3594,991.8047 Q713.4531,991.1875 714.6875,991.1875 Q715.4219,991.1875 716.0703,991.3516 Q716.7188,991.5156 717.2656,991.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="220" x="728.5" y="1000.9102">AnnotationConfigWebApplicationContext</text><line x1="700.5" x2="950.5" y1="1012" y2="1012" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="700.5" x2="950.5" y1="1020" y2="1020" style="stroke:#A80036;stroke-width:1.5;"></line><path d="M1129.5,292.024 C1129.5,305.579 1129.5,320.038 1129.5,331.678 " fill="none" id="EnvironmentCapable&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1122.5,292,1129.5,272,1136.5,292,1122.5,292" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M758.598,270.085 C848.074,290.57 981.82,321.19 1061.88,339.52 " fill="none" id="ListableBeanFactory&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="757.032,276.908,739.098,265.621,760.156,263.261,757.032,276.908" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M507.142,264.132 C658.184,286.185 934.618,326.546 1061.98,345.141 " fill="none" id="HierarchicalBeanFactory&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="505.915,271.027,487.136,261.211,507.937,257.174,505.915,271.027" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1245.64,282.583 C1219.9,298.632 1189.74,317.437 1166.61,331.862 " fill="none" id="MessageSource&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1241.94,276.643,1262.61,272,1249.35,288.522,1241.94,276.643" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1387.35,277.792 C1327.16,295.815 1251.08,318.595 1197.2,334.728 " fill="none" id="ApplicationEventPublisher&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1385.52,271.032,1406.69,272,1389.54,284.443,1385.52,271.032" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M993.199,281.66 C1023.39,297.907 1059.17,317.16 1086.5,331.862 " fill="none" id="ResourcePatternResolver&lt;-ApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="989.542,287.641,975.246,272,996.175,275.313,989.542,287.641" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M540.5,184.341 C540.5,228.848 540.5,296.442 540.5,331.72 " fill="none" id="BeanFactory&lt;-AutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="533.5,184.309,540.5,164.309,547.5,184.309,533.5,184.309" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M583.416,177.104 C601.721,192.503 622.553,210.029 638.778,223.678 " fill="none" id="BeanFactory&lt;-ListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="578.638,182.232,567.84,164,587.651,171.519,578.638,182.232" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M494.745,176.402 C474.625,191.969 451.552,209.821 433.642,223.678 " fill="none" id="BeanFactory&lt;-HierarchicalBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="490.671,170.703,510.773,164,499.239,181.776,490.671,170.703" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M372.823,288.178 C361.374,302.8 348.744,318.929 338.761,331.678 " fill="none" id="HierarchicalBeanFactory&lt;-ConfigurableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="367.649,283.432,385.49,272,378.671,292.063,367.649,283.432" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M286.037,184.115 C290.599,209.697 296.649,242.743 302.5,272 C306.548,292.242 311.552,315.167 315.255,331.787 " fill="none" id="SingletonBeanRegistry&lt;-ConfigurableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="279.111,185.147,282.522,164.234,292.897,182.71,279.111,185.147" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M371.071,54.633 C310.719,72.911 224.697,98.963 164.254,117.269 " fill="none" id="AliasRegistry&lt;-SimpleAliasRegistry" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="369.309,47.853,390.479,48.755,373.367,61.251,369.309,47.853" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M97.3706,184.024 C98.9052,197.579 100.542,212.038 101.8598,223.678 " fill="none" id="SimpleAliasRegistry&lt;-DefaultSingletonBeanRegistry" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="90.3981,184.661,95.1038,164,104.3093,183.086,90.3981,184.661" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M223.373,174.583 C197.029,190.632 166.16,209.437 142.482,223.862 " fill="none" id="SingletonBeanRegistry&lt;-DefaultSingletonBeanRegistry" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="220.023,168.428,240.745,164,227.306,180.384,220.023,168.428" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M104.5,292.024 C104.5,305.579 104.5,320.038 104.5,331.678 " fill="none" id="DefaultSingletonBeanRegistry&lt;-FactoryBeanRegistrySupport" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="97.5001,292,104.5,272,111.5,292,97.5001,292" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M169.651,388.972 C203.047,405.361 242.967,424.952 273.35,439.862 " fill="none" id="FactoryBeanRegistrySupport&lt;-AbstractBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="166.239,395.096,151.369,380,172.407,382.527,166.239,395.096" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M320.5,400.024 C320.5,413.579 320.5,428.038 320.5,439.678 " fill="none" id="ConfigurableBeanFactory&lt;-AbstractBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="313.5,400,320.5,380,327.5,400,313.5,400" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M364.54,500.635 C383.71,516.147 405.638,533.89 422.678,547.678 " fill="none" id="AbstractBeanFactory&lt;-AbstractAutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="360.07,506.023,348.925,488,368.876,495.139,360.07,506.023" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M517.129,398.007 C510.054,411.202 502.56,426.026 496.5,440 C480.523,476.844 466.241,521.366 458.242,547.869 " fill="none" id="AutowireCapableBeanFactory&lt;-AbstractAutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="511.197,394.268,526.981,380.131,523.459,401.025,511.197,394.268" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M666.063,292.085 C665.019,317.883 662.286,351.16 655.5,380 C650.563,400.982 641.258,423.648 633.785,439.984 " fill="none" id="ListableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="659.067,291.843,666.601,272.038,673.062,292.219,659.067,291.843" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M570.808,396.178 C582.119,410.8 594.596,426.929 604.459,439.678 " fill="none" id="AutowireCapableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="564.994,400.103,558.293,380,576.067,391.536,564.994,400.103" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M405.171,386.719 C453.185,403.571 512.364,424.343 556.838,439.953 " fill="none" id="ConfigurableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="402.583,393.229,386.03,380,407.219,380.019,402.583,393.229" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M469.542,614.575 C475.603,628.543 482.147,643.622 487.379,655.678 " fill="none" id="AbstractAutowireCapableBeanFactory&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="463.022,617.134,461.481,596,475.865,611.561,463.022,617.134" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M618.076,508.342 C613.825,535.118 605.548,569.336 589.5,596 C575.079,619.96 551.58,640.989 531.942,655.886 " fill="none" id="ConfigurableListableBeanFactory&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="611.161,507.241,620.738,488.339,625.039,509.088,611.161,507.241" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M709.478,602.832 C662.634,619.664 604.987,640.378 561.64,655.953 " fill="none" id="BeanDefinitionRegistry&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="707.3,596.176,728.489,596,712.035,609.351,707.3,596.176" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M314.651,601.781 C354.889,618.774 405.148,639.999 442.785,655.893 " fill="none" id="Serializable&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="311.791,608.172,296.09,593.942,317.237,595.275,311.791,608.172" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M497.5,724.024 C497.5,737.579 497.5,752.038 497.5,763.678 " fill="none" id="DefaultListableBeanFactory&lt;-XmlBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="490.5,724,497.5,704,504.5,724,490.5,724" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1271.81,161.567 C1199.12,179.87 1093.13,206.557 1019.01,225.219 " fill="none" id="ResourceLoader&lt;-ResourcePatternResolver" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1270.28,154.736,1291.38,156.641,1273.69,168.312,1270.28,154.736" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1435.8,146.848 C1537.59,155.993 1702.07,177.67 1739.5,224 C1791.24,288.046 1738.05,393.193 1709.76,439.666 " fill="none" id="ResourceLoader&lt;-DefaultResourceLoader" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1435.04,153.81,1415.71,145.133,1436.23,139.86,1435.04,153.81" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1203.1,387.834 C1242.75,404.447 1290.86,424.605 1327.27,439.862 " fill="none" id="ApplicationContext&lt;-ConfigurableApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1200.14,394.185,1184.4,380,1205.55,381.273,1200.14,394.185" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1461.36,393.338 C1443.99,408.681 1424.28,426.098 1408.9,439.678 " fill="none" id="Lifecycle&lt;-ConfigurableApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1456.84,387.995,1476.46,380,1466.11,398.487,1456.84,387.995" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1382.5,400.024 C1382.5,413.579 1382.5,428.038 1382.5,439.678 " fill="none" id="Closeable&lt;-ConfigurableApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1375.5,400,1382.5,380,1389.5,400,1375.5,400" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1588.5,277.567 C1537.01,296.923 1470.7,321.845 1427.43,338.112 " fill="none" id="AutoCloseable&lt;-Closeable" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1586.25,270.935,1607.43,270.451,1591.17,284.04,1586.25,270.935" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1615.41,495.157 C1571.51,511.897 1517.74,532.397 1477.18,547.862 " fill="none" id="DefaultResourceLoader&lt;-AbstractApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1613,488.585,1634.18,488,1617.98,501.667,1613,488.585" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1395.99,507.057 C1400.43,520.889 1405.2,535.761 1409.02,547.678 " fill="none" id="ConfigurableApplicationContext&lt;-AbstractApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1389.32,509.183,1389.88,488,1402.65,504.907,1389.32,509.183" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1426.93,615.54 C1430.29,629.235 1433.89,643.9 1436.78,655.678 " fill="none" id="AbstractApplicationContext&lt;-AbstractRefreshableApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1420.11,617.092,1422.14,596,1433.7,613.757,1420.11,617.092" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1444.53,724.024 C1445.17,737.579 1445.85,752.038 1446.4,763.678 " fill="none" id="AbstractRefreshableApplicationContext&lt;-AbstractRefreshableConfigApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1437.54,724.308,1443.58,704,1451.52,723.648,1437.54,724.308" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1600.92,712.744 C1566.96,729.179 1526.25,748.882 1495.3,763.862 " fill="none" id="BeanNameAware&lt;-AbstractRefreshableConfigApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1597.93,706.413,1618.98,704,1604.03,719.015,1597.93,706.413" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1291.28,712.744 C1325.86,729.179 1367.31,748.882 1398.82,763.862 " fill="none" id="InitializingBean&lt;-AbstractRefreshableConfigApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1287.95,718.909,1272.89,704,1293.96,706.264,1287.95,718.909" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1666.5,616.024 C1666.5,629.579 1666.5,644.038 1666.5,655.678 " fill="none" id="Aware&lt;-BeanNameAware" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1659.5,616,1666.5,596,1673.5,616,1659.5,616" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1447.5,832.024 C1447.5,845.579 1447.5,860.038 1447.5,871.678 " fill="none" id="AbstractRefreshableConfigApplicationContext&lt;-AbstractXmlApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1440.5,832,1447.5,812,1454.5,832,1440.5,832" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1432.42,939.0569 C1427.46,952.8891 1422.13,967.7609 1417.86,979.6784 " fill="none" id="AbstractXmlApplicationContext&lt;-ClassPathXmlApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1425.92,936.465,1439.25,920,1439.09,941.1895,1425.92,936.465" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1511.6,929.2013 C1544.13,945.5433 1582.9,965.021 1612.44,979.8617 " fill="none" id="AbstractXmlApplicationContext&lt;-FileSystemXmlApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1508.01,935.2337,1493.28,920,1514.3,922.724,1508.01,935.2337" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1361.75,818.607 C1312.89,835.479 1252.56,856.308 1207.25,871.953 " fill="none" id="AbstractRefreshableConfigApplicationContext&lt;-AbstractRefreshableWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1359.7,811.911,1380.89,812,1364.27,825.145,1359.7,811.911" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1130.99,616.576 C1133.35,685.675 1137.87,818.037 1139.7,871.62 " fill="none" id="ConfigurableWebApplicationContext&lt;-AbstractRefreshableWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1123.98,616.385,1130.29,596.157,1137.97,615.907,1123.98,616.385" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1187.44,828.656 C1177.19,843.15 1165.92,859.068 1157,871.678 " fill="none" id="ThemeSource&lt;-AbstractRefreshableWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="1181.96,824.284,1199.23,812,1193.39,832.37,1181.96,824.284" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1140.5,940.0236 C1140.5,953.5792 1140.5,968.0381 1140.5,979.6784 " fill="none" id="AbstractRefreshableWebApplicationContext&lt;-XmlWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1133.5,940.0005,1140.5,920,1147.5,940.0004,1133.5,940.0005" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1129.5,508.024 C1129.5,521.579 1129.5,536.038 1129.5,547.678 " fill="none" id="WebApplicationContext&lt;-ConfigurableWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1122.5,508,1129.5,488,1136.5,508,1122.5,508" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1308.9,495.834 C1269.25,512.447 1221.14,532.605 1184.73,547.862 " fill="none" id="ConfigurableApplicationContext&lt;-ConfigurableWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1306.45,489.273,1327.6,488,1311.86,502.185,1306.45,489.273" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1129.5,400.024 C1129.5,413.579 1129.5,428.038 1129.5,439.678 " fill="none" id="ApplicationContext&lt;-WebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1122.5,400,1129.5,380,1136.5,400,1122.5,400" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1306.62,598.882 C1229.17,617.126 1126.81,641.238 1054.69,658.227 " fill="none" id="AbstractApplicationContext&lt;-GenericApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1305.18,592.032,1326.25,594.26,1308.39,605.659,1305.18,592.032" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M847.627,606.583 C873.971,622.632 904.84,641.437 928.518,655.862 " fill="none" id="BeanDefinitionRegistry&lt;-GenericApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="843.694,612.384,830.255,596,850.977,600.428,843.694,612.384" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M514.255,43.996 C616.664,64.222 792.5,117.767 792.5,247 C792.5,247 792.5,247 792.5,357 C792.5,426.476 792.5,508.639 792.5,547.883 " fill="none" id="AliasRegistry&lt;-BeanDefinitionRegistry" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="512.905,50.865,494.521,40.329,515.463,37.1,512.905,50.865" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M954.46,723.54 C950.585,737.235 946.434,751.9 943.1,763.678 " fill="none" id="GenericApplicationContext&lt;-AnnotationConfigApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="947.808,721.338,959.99,704,961.279,725.151,947.808,721.338" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M813.82,714.352 C841.007,730.451 872.951,749.368 897.427,763.862 " fill="none" id="AnnotationConfigRegistry&lt;-AnnotationConfigApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="809.983,720.214,796.34,704,817.116,708.168,809.983,720.214" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M1053.18,926.383 C1002.928,943.2942 940.686,964.2388 893.988,979.9531 " fill="none" id="AbstractRefreshableWebApplicationContext&lt;-AnnotationConfigWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="1050.96,919.745,1072.15,920,1055.43,933.0136,1050.96,919.745" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M766.608,724.127 C781.173,793.1 809.222,925.921 820.563,979.6197 " fill="none" id="AnnotationConfigRegistry&lt;-AnnotationConfigWebApplicationContext" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="759.674,725.172,762.39,704.157,773.372,722.279,759.674,725.172" style="stroke:#A80036;stroke-width:1.0;"></polygon></g></svg><p>BeanFactory 相关</p> <blockquote><ul><li><em>AliasRegistry</em> : 定义对 alias 的简单增删改查</li> <li>SimpleAliasRegistry ：实现了<em>AliasRegistry</em> ，使用map作为 alias 的缓存</li> <li><em>SingletonBeanRegistry</em>： 定义对单例的注册及获取</li> <li>DefaultSingletonBeanRegistry：对接口<em>SingletonBeanRegistry</em>各方法的实现</li> <li><em>FactoryBeanRegistrySupport</em>：在DefaultSingletonBeanRegistry基础上增加了对FactoryBean的特殊处理功能</li> <li>BeanFactory：定义获取Bean及Bean的各种属性</li> <li><em>HierarchicalBeanFactory</em>：在 BeanFactory 定义的功能的基础上增加了对 parentFactory 的支持</li> <li><em>ListableBeanFactory</em>：在 BeanFactory 定义的功能的基础上增加了枚举所有Bean实例的能力，预加载所有bean定义(如基于xml的工厂)的BeanFactory实现可能实现了此接口。</li> <li><em>ConfigurableBeanFactory</em>：提供配置 BeanFactory 的各种方法</li> <li><em>AutowireCapableBeanFactory</em>：提供创建Bean、自动注入、初始化以及应用Bean的后置处理器</li> <li><em>ConfigurableListableBeanFactory</em>：大部分的 ListableBeanFactory 都需要实现此接口，在<em>ConfigurableBeanFactory</em>之上提供了分析和修改Bean定义（忽略依赖类型和接口等）、以及预初始化单例Bean的能力</li> <li><em>AbstractBeanFactory</em>：综合 <em>FactoryBeanRegistrySupport</em>、<em>ConfigurableBeanFactory</em></li> <li><em>AbstractAutowireCapableBeanFactory</em>： 综合 <em>AbstractBeanFactory</em> 并对<em>AutowireCapableBeanFactory</em>接口进行实现</li> <li><em>BeanDefinitionRegistry</em>：定义对BeanDefinition的各种操作</li> <li>DefaultListableBeanFactory：综合上面所有功能，主要是对Bean注册之后的处理</li></ul></blockquote> <p>ApplicationContext</p> <blockquote><ul><li><em>ResourceLoader</em>：策略模式接口，提供获取类加载器，以及获取<code>classpath:</code>这种URL前缀资源的能力</li> <li><em>ResourcePatternResolver</em>：提供了从类路径下获取<code>classpath*:</code>这种伪URL前缀的资源，与<em>ResourceLoader</em>的 <code>classpath:</code>不同的是，它能获取所有匹配的资源，包括jar包中的资源</li> <li><em>EnvironmentCapable</em>：提供获取 Environment 能力</li> <li><em>MessageSource</em>：策略模式接口，提供消息的参数化和国际化的能力</li> <li><em>ApplicationContext</em>：具有获取应用程序组件、继承父容器、通用的资源处理等能力</li> <li><em>WebApplicationContext</em>： 提供获取web应用 ServletContext 的能力，与一般的ApplicationContext不同的是，它是具有层次的，每个应用都有一个根上下文，同时每个Servlet有都有其子上下文</li> <li><em>ConfigurableApplicationContext</em>：让ApplicationContext具备可配置能力，同时提供加载和刷新配置信息的持久化表示的能力</li> <li>ConfigurableWebApplicationContext：让 <em>WebApplicationContext</em> 具备可配置能力</li> <li><em>AbstractApplicationContext</em>:  模板方法模式，实现了很多ApplicationContext的接口，与普通的BeanFactory不同的是，ApplicationContext 自动注册一些BeanFactory内部定义的Bean，例如，BeanFactoryPostProcessors， BeanPostProcessors， ApplicationListeners</li> <li><em>AbstractRefreshableApplicationContext</em>：支持多次调用 ConfigurableApplicationContext 的 refresh 方法，每次调用都将创建一个新的BeanFactory，默认创建的是 DefaultListableBeanFactory 类型的</li> <li></li></ul></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-2-defaultlistablebeanfactory"><a href="#_1-2-defaultlistablebeanfactory" class="header-anchor">#</a> 1.2 DefaultListableBeanFactory</h4> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="823px" preserveAspectRatio="none" version="1.1" viewBox="0 0 836 823" width="836px" zoomAndPan="magnify" style="width:836px;height:823px;"><defs><filter height="300%" id="f1h8acv7cgdxu6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"></feOffset><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"></feBlend></filter></defs><g><rect fill="#FFA500" filter="url(#f1h8acv7cgdxu6)" height="48" id="BeanFactory" width="101" x="166" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="181" cy="132" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M181.9531,128.6406 L181.9531,135.2969 L183.6719,135.2969 Q184.2813,135.2969 184.5469,135.5313 Q184.8125,135.7656 184.8125,136.1563 Q184.8125,136.5313 184.5469,136.7656 Q184.2813,137 183.6719,137 L178.5313,137 Q177.9219,137 177.6563,136.7656 Q177.3906,136.5313 177.3906,136.1406 Q177.3906,135.7656 177.6563,135.5313 Q177.9219,135.2969 178.5313,135.2969 L180.25,135.2969 L180.25,128.6406 L178.5313,128.6406 Q177.9219,128.6406 177.6563,128.4063 Q177.3906,128.1719 177.3906,127.7813 Q177.3906,127.4063 177.6563,127.1719 Q177.9219,126.9375 178.5313,126.9375 L183.6719,126.9375 Q184.2813,126.9375 184.5469,127.1719 Q184.8125,127.4063 184.8125,127.7813 Q184.8125,128.1719 184.5469,128.4063 Q184.2813,128.6406 183.6719,128.6406 L181.9531,128.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="195" y="136.9102">BeanFactory</text><line x1="167" x2="266" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="167" x2="266" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="AutowireCapableBeanFactory" width="196" x="119.5" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="134.5" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M135.4531,344.6406 L135.4531,351.2969 L137.1719,351.2969 Q137.7813,351.2969 138.0469,351.5313 Q138.3125,351.7656 138.3125,352.1563 Q138.3125,352.5313 138.0469,352.7656 Q137.7813,353 137.1719,353 L132.0313,353 Q131.4219,353 131.1563,352.7656 Q130.8906,352.5313 130.8906,352.1406 Q130.8906,351.7656 131.1563,351.5313 Q131.4219,351.2969 132.0313,351.2969 L133.75,351.2969 L133.75,344.6406 L132.0313,344.6406 Q131.4219,344.6406 131.1563,344.4063 Q130.8906,344.1719 130.8906,343.7813 Q130.8906,343.4063 131.1563,343.1719 Q131.4219,342.9375 132.0313,342.9375 L137.1719,342.9375 Q137.7813,342.9375 138.0469,343.1719 Q138.3125,343.4063 138.3125,343.7813 Q138.3125,344.1719 138.0469,344.4063 Q137.7813,344.6406 137.1719,344.6406 L135.4531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="164" x="148.5" y="352.9102">AutowireCapableBeanFactory</text><line x1="120.5" x2="314.5" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="120.5" x2="314.5" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="HierarchicalBeanFactory" width="167" x="270" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="285" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M285.9531,236.6406 L285.9531,243.2969 L287.6719,243.2969 Q288.2813,243.2969 288.5469,243.5313 Q288.8125,243.7656 288.8125,244.1563 Q288.8125,244.5313 288.5469,244.7656 Q288.2813,245 287.6719,245 L282.5313,245 Q281.9219,245 281.6563,244.7656 Q281.3906,244.5313 281.3906,244.1406 Q281.3906,243.7656 281.6563,243.5313 Q281.9219,243.2969 282.5313,243.2969 L284.25,243.2969 L284.25,236.6406 L282.5313,236.6406 Q281.9219,236.6406 281.6563,236.4063 Q281.3906,236.1719 281.3906,235.7813 Q281.3906,235.4063 281.6563,235.1719 Q281.9219,234.9375 282.5313,234.9375 L287.6719,234.9375 Q288.2813,234.9375 288.5469,235.1719 Q288.8125,235.4063 288.8125,235.7813 Q288.8125,236.1719 288.5469,236.4063 Q288.2813,236.6406 287.6719,236.6406 L285.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="135" x="299" y="244.9102">HierarchicalBeanFactory</text><line x1="271" x2="436" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="271" x2="436" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="ListableBeanFactory" width="145" x="6" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="21" cy="240" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M21.9531,236.6406 L21.9531,243.2969 L23.6719,243.2969 Q24.2813,243.2969 24.5469,243.5313 Q24.8125,243.7656 24.8125,244.1563 Q24.8125,244.5313 24.5469,244.7656 Q24.2813,245 23.6719,245 L18.5313,245 Q17.9219,245 17.6563,244.7656 Q17.3906,244.5313 17.3906,244.1406 Q17.3906,243.7656 17.6563,243.5313 Q17.9219,243.2969 18.5313,243.2969 L20.25,243.2969 L20.25,236.6406 L18.5313,236.6406 Q17.9219,236.6406 17.6563,236.4063 Q17.3906,236.1719 17.3906,235.7813 Q17.3906,235.4063 17.6563,235.1719 Q17.9219,234.9375 18.5313,234.9375 L23.6719,234.9375 Q24.2813,234.9375 24.5469,235.1719 Q24.8125,235.4063 24.8125,235.7813 Q24.8125,236.1719 24.5469,236.4063 Q24.2813,236.6406 23.6719,236.6406 L21.9531,236.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="113" x="35" y="244.9102">ListableBeanFactory</text><line x1="7" x2="150" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="7" x2="150" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="ConfigurableBeanFactory" width="173" x="351" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="366" cy="348" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M366.9531,344.6406 L366.9531,351.2969 L368.6719,351.2969 Q369.2813,351.2969 369.5469,351.5313 Q369.8125,351.7656 369.8125,352.1563 Q369.8125,352.5313 369.5469,352.7656 Q369.2813,353 368.6719,353 L363.5313,353 Q362.9219,353 362.6563,352.7656 Q362.3906,352.5313 362.3906,352.1406 Q362.3906,351.7656 362.6563,351.5313 Q362.9219,351.2969 363.5313,351.2969 L365.25,351.2969 L365.25,344.6406 L363.5313,344.6406 Q362.9219,344.6406 362.6563,344.4063 Q362.3906,344.1719 362.3906,343.7813 Q362.3906,343.4063 362.6563,343.1719 Q362.9219,342.9375 363.5313,342.9375 L368.6719,342.9375 Q369.2813,342.9375 369.5469,343.1719 Q369.8125,343.4063 369.8125,343.7813 Q369.8125,344.1719 369.5469,344.4063 Q369.2813,344.6406 368.6719,344.6406 L366.9531,344.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="141" x="380" y="352.9102">ConfigurableBeanFactory</text><line x1="352" x2="523" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="352" x2="523" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="SingletonBeanRegistry" width="158" x="411.5" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="426.5" cy="132" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M427.4531,128.6406 L427.4531,135.2969 L429.1719,135.2969 Q429.7813,135.2969 430.0469,135.5313 Q430.3125,135.7656 430.3125,136.1563 Q430.3125,136.5313 430.0469,136.7656 Q429.7813,137 429.1719,137 L424.0313,137 Q423.4219,137 423.1563,136.7656 Q422.8906,136.5313 422.8906,136.1406 Q422.8906,135.7656 423.1563,135.5313 Q423.4219,135.2969 424.0313,135.2969 L425.75,135.2969 L425.75,128.6406 L424.0313,128.6406 Q423.4219,128.6406 423.1563,128.4063 Q422.8906,128.1719 422.8906,127.7813 Q422.8906,127.4063 423.1563,127.1719 Q423.4219,126.9375 424.0313,126.9375 L429.1719,126.9375 Q429.7813,126.9375 430.0469,127.1719 Q430.3125,127.4063 430.3125,127.7813 Q430.3125,128.1719 430.0469,128.4063 Q429.7813,128.6406 429.1719,128.6406 L427.4531,128.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="440.5" y="136.9102">SingletonBeanRegistry</text><line x1="412.5" x2="568.5" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="412.5" x2="568.5" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="AliasRegistry" width="104" x="686.5" y="8" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="701.5" cy="24" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M702.4531,20.6406 L702.4531,27.2969 L704.1719,27.2969 Q704.7813,27.2969 705.0469,27.5313 Q705.3125,27.7656 705.3125,28.1563 Q705.3125,28.5313 705.0469,28.7656 Q704.7813,29 704.1719,29 L699.0313,29 Q698.4219,29 698.1563,28.7656 Q697.8906,28.5313 697.8906,28.1406 Q697.8906,27.7656 698.1563,27.5313 Q698.4219,27.2969 699.0313,27.2969 L700.75,27.2969 L700.75,20.6406 L699.0313,20.6406 Q698.4219,20.6406 698.1563,20.4063 Q697.8906,20.1719 697.8906,19.7813 Q697.8906,19.4063 698.1563,19.1719 Q698.4219,18.9375 699.0313,18.9375 L704.1719,18.9375 Q704.7813,18.9375 705.0469,19.1719 Q705.3125,19.4063 705.3125,19.7813 Q705.3125,20.1719 705.0469,20.4063 Q704.7813,20.6406 704.1719,20.6406 L702.4531,20.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="72" x="715.5" y="28.9102">AliasRegistry</text><line x1="687.5" x2="789.5" y1="40" y2="40" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="687.5" x2="789.5" y1="48" y2="48" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="SimpleAliasRegistry" width="143" x="605" y="116" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="620" cy="132" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M622.7656,127.875 Q622.9219,127.6563 623.1094,127.5469 Q623.2969,127.4375 623.5156,127.4375 Q623.8906,127.4375 624.125,127.6953 Q624.3594,127.9531 624.3594,128.5625 L624.3594,130.0156 Q624.3594,130.625 624.125,130.8906 Q623.8906,131.1563 623.5156,131.1563 Q623.1719,131.1563 622.9688,130.9531 Q622.7656,130.7656 622.6563,130.25 Q622.6094,129.8906 622.4219,129.7031 Q622.0938,129.3281 621.4844,129.1094 Q620.875,128.8906 620.25,128.8906 Q619.4844,128.8906 618.8516,129.2188 Q618.2188,129.5469 617.7266,130.2969 Q617.2344,131.0469 617.2344,132.0781 L617.2344,133.1719 Q617.2344,134.4063 618.125,135.2266 Q619.0156,136.0469 620.6094,136.0469 Q621.5469,136.0469 622.2031,135.7969 Q622.5938,135.6406 623.0156,135.2031 Q623.2813,134.9375 623.4297,134.8594 Q623.5781,134.7813 623.7813,134.7813 Q624.1094,134.7813 624.3672,135.0391 Q624.625,135.2969 624.625,135.6406 Q624.625,135.9844 624.2813,136.3906 Q623.7813,136.9688 622.9844,137.2969 Q621.9063,137.75 620.6094,137.75 Q619.0938,137.75 617.8906,137.125 Q616.9063,136.625 616.2188,135.5547 Q615.5313,134.4844 615.5313,133.2031 L615.5313,132.0469 Q615.5313,130.7188 616.1484,129.5703 Q616.7656,128.4219 617.8594,127.8047 Q618.9531,127.1875 620.1875,127.1875 Q620.9219,127.1875 621.5703,127.3516 Q622.2188,127.5156 622.7656,127.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="634" y="136.9102">SimpleAliasRegistry</text><line x1="606" x2="747" y1="148" y2="148" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="606" x2="747" y1="156" y2="156" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1h8acv7cgdxu6)" height="48" id="DefaultSingletonBeanRegistry" width="197" x="551" y="224" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="566" cy="240" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M568.7656,235.875 Q568.9219,235.6563 569.1094,235.5469 Q569.2969,235.4375 569.5156,235.4375 Q569.8906,235.4375 570.125,235.6953 Q570.3594,235.9531 570.3594,236.5625 L570.3594,238.0156 Q570.3594,238.625 570.125,238.8906 Q569.8906,239.1563 569.5156,239.1563 Q569.1719,239.1563 568.9688,238.9531 Q568.7656,238.7656 568.6563,238.25 Q568.6094,237.8906 568.4219,237.7031 Q568.0938,237.3281 567.4844,237.1094 Q566.875,236.8906 566.25,236.8906 Q565.4844,236.8906 564.8516,237.2188 Q564.2188,237.5469 563.7266,238.2969 Q563.2344,239.0469 563.2344,240.0781 L563.2344,241.1719 Q563.2344,242.4063 564.125,243.2266 Q565.0156,244.0469 566.6094,244.0469 Q567.5469,244.0469 568.2031,243.7969 Q568.5938,243.6406 569.0156,243.2031 Q569.2813,242.9375 569.4297,242.8594 Q569.5781,242.7813 569.7813,242.7813 Q570.1094,242.7813 570.3672,243.0391 Q570.625,243.2969 570.625,243.6406 Q570.625,243.9844 570.2813,244.3906 Q569.7813,244.9688 568.9844,245.2969 Q567.9063,245.75 566.6094,245.75 Q565.0938,245.75 563.8906,245.125 Q562.9063,244.625 562.2188,243.5547 Q561.5313,242.4844 561.5313,241.2031 L561.5313,240.0469 Q561.5313,238.7188 562.1484,237.5703 Q562.7656,236.4219 563.8594,235.8047 Q564.9531,235.1875 566.1875,235.1875 Q566.9219,235.1875 567.5703,235.3516 Q568.2188,235.5156 568.7656,235.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="580" y="244.9102">DefaultSingletonBeanRegistry</text><line x1="552" x2="747" y1="256" y2="256" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="552" x2="747" y1="264" y2="264" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1h8acv7cgdxu6)" height="48" id="FactoryBeanRegistrySupport" width="189" x="559" y="332" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="574" cy="348" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M576.1875,349.7656 L572.0469,349.7656 L571.625,350.7969 L572.0469,350.7969 Q572.6563,350.7969 572.9219,351.0313 Q573.1875,351.2656 573.1875,351.6563 Q573.1875,352.0313 572.9219,352.2656 Q572.6563,352.5 572.0469,352.5 L569.75,352.5 Q569.1406,352.5 568.8828,352.2656 Q568.625,352.0313 568.625,351.6406 Q568.625,351.2656 568.8984,351.0234 Q569.1719,350.7813 569.7969,350.7969 L572.4688,344.1406 L571.3594,344.1406 Q570.75,344.1406 570.4844,343.9063 Q570.2188,343.6719 570.2188,343.2813 Q570.2188,342.9063 570.4844,342.6719 Q570.75,342.4375 571.3594,342.4375 L575.0313,342.4375 L578.4219,350.7969 Q579.0156,350.7969 579.2031,350.9375 Q579.5938,351.2031 579.5938,351.6563 Q579.5938,352.0313 579.3359,352.2656 Q579.0781,352.5 578.4688,352.5 L576.1719,352.5 Q575.5625,352.5 575.2969,352.2656 Q575.0313,352.0313 575.0313,351.6406 Q575.0313,351.2656 575.2969,351.0313 Q575.5625,350.7969 576.1719,350.7969 L576.5938,350.7969 L576.1875,349.7656 Z M575.4688,348.0625 L574.1094,344.6875 L572.7344,348.0625 L575.4688,348.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="157" x="588" y="352.9102">FactoryBeanRegistrySupport</text><line x1="560" x2="747" y1="364" y2="364" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="560" x2="747" y1="372" y2="372" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="AbstractBeanFactory" width="146" x="432.5" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="447.5" cy="456" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M449.6875,457.7656 L445.5469,457.7656 L445.125,458.7969 L445.5469,458.7969 Q446.1563,458.7969 446.4219,459.0313 Q446.6875,459.2656 446.6875,459.6563 Q446.6875,460.0313 446.4219,460.2656 Q446.1563,460.5 445.5469,460.5 L443.25,460.5 Q442.6406,460.5 442.3828,460.2656 Q442.125,460.0313 442.125,459.6406 Q442.125,459.2656 442.3984,459.0234 Q442.6719,458.7813 443.2969,458.7969 L445.9688,452.1406 L444.8594,452.1406 Q444.25,452.1406 443.9844,451.9063 Q443.7188,451.6719 443.7188,451.2813 Q443.7188,450.9063 443.9844,450.6719 Q444.25,450.4375 444.8594,450.4375 L448.5313,450.4375 L451.9219,458.7969 Q452.5156,458.7969 452.7031,458.9375 Q453.0938,459.2031 453.0938,459.6563 Q453.0938,460.0313 452.8359,460.2656 Q452.5781,460.5 451.9688,460.5 L449.6719,460.5 Q449.0625,460.5 448.7969,460.2656 Q448.5313,460.0313 448.5313,459.6406 Q448.5313,459.2656 448.7969,459.0313 Q449.0625,458.7969 449.6719,458.7969 L450.0938,458.7969 L449.6875,457.7656 Z M448.9688,456.0625 L447.6094,452.6875 L446.2344,456.0625 L448.9688,456.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="114" x="461.5" y="460.9102">AbstractBeanFactory</text><line x1="433.5" x2="577.5" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="433.5" x2="577.5" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="AbstractAutowireCapableBeanFactory" width="241" x="356" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="371" cy="564" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M373.1875,565.7656 L369.0469,565.7656 L368.625,566.7969 L369.0469,566.7969 Q369.6563,566.7969 369.9219,567.0313 Q370.1875,567.2656 370.1875,567.6563 Q370.1875,568.0313 369.9219,568.2656 Q369.6563,568.5 369.0469,568.5 L366.75,568.5 Q366.1406,568.5 365.8828,568.2656 Q365.625,568.0313 365.625,567.6406 Q365.625,567.2656 365.8984,567.0234 Q366.1719,566.7813 366.7969,566.7969 L369.4688,560.1406 L368.3594,560.1406 Q367.75,560.1406 367.4844,559.9063 Q367.2188,559.6719 367.2188,559.2813 Q367.2188,558.9063 367.4844,558.6719 Q367.75,558.4375 368.3594,558.4375 L372.0313,558.4375 L375.4219,566.7969 Q376.0156,566.7969 376.2031,566.9375 Q376.5938,567.2031 376.5938,567.6563 Q376.5938,568.0313 376.3359,568.2656 Q376.0781,568.5 375.4688,568.5 L373.1719,568.5 Q372.5625,568.5 372.2969,568.2656 Q372.0313,568.0313 372.0313,567.6406 Q372.0313,567.2656 372.2969,567.0313 Q372.5625,566.7969 373.1719,566.7969 L373.5938,566.7969 L373.1875,565.7656 Z M372.4688,564.0625 L371.1094,560.6875 L369.7344,564.0625 L372.4688,564.0625 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="209" x="385" y="568.9102">AbstractAutowireCapableBeanFactory</text><line x1="357" x2="596" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="357" x2="596" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="ConfigurableListableBeanFactory" width="217" x="109" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="124" cy="456" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M124.9531,452.6406 L124.9531,459.2969 L126.6719,459.2969 Q127.2813,459.2969 127.5469,459.5313 Q127.8125,459.7656 127.8125,460.1563 Q127.8125,460.5313 127.5469,460.7656 Q127.2813,461 126.6719,461 L121.5313,461 Q120.9219,461 120.6563,460.7656 Q120.3906,460.5313 120.3906,460.1406 Q120.3906,459.7656 120.6563,459.5313 Q120.9219,459.2969 121.5313,459.2969 L123.25,459.2969 L123.25,452.6406 L121.5313,452.6406 Q120.9219,452.6406 120.6563,452.4063 Q120.3906,452.1719 120.3906,451.7813 Q120.3906,451.4063 120.6563,451.1719 Q120.9219,450.9375 121.5313,450.9375 L126.6719,450.9375 Q127.2813,450.9375 127.5469,451.1719 Q127.8125,451.4063 127.8125,451.7813 Q127.8125,452.1719 127.5469,452.4063 Q127.2813,452.6406 126.6719,452.6406 L124.9531,452.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="185" x="138" y="460.9102">ConfigurableListableBeanFactory</text><line x1="110" x2="325" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="110" x2="325" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FFA07A" filter="url(#f1h8acv7cgdxu6)" height="48" id="DefaultListableBeanFactory" width="183" x="472" y="656" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="487" cy="672" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M489.7656,667.875 Q489.9219,667.6563 490.1094,667.5469 Q490.2969,667.4375 490.5156,667.4375 Q490.8906,667.4375 491.125,667.6953 Q491.3594,667.9531 491.3594,668.5625 L491.3594,670.0156 Q491.3594,670.625 491.125,670.8906 Q490.8906,671.1563 490.5156,671.1563 Q490.1719,671.1563 489.9688,670.9531 Q489.7656,670.7656 489.6563,670.25 Q489.6094,669.8906 489.4219,669.7031 Q489.0938,669.3281 488.4844,669.1094 Q487.875,668.8906 487.25,668.8906 Q486.4844,668.8906 485.8516,669.2188 Q485.2188,669.5469 484.7266,670.2969 Q484.2344,671.0469 484.2344,672.0781 L484.2344,673.1719 Q484.2344,674.4063 485.125,675.2266 Q486.0156,676.0469 487.6094,676.0469 Q488.5469,676.0469 489.2031,675.7969 Q489.5938,675.6406 490.0156,675.2031 Q490.2813,674.9375 490.4297,674.8594 Q490.5781,674.7813 490.7813,674.7813 Q491.1094,674.7813 491.3672,675.0391 Q491.625,675.2969 491.625,675.6406 Q491.625,675.9844 491.2813,676.3906 Q490.7813,676.9688 489.9844,677.2969 Q488.9063,677.75 487.6094,677.75 Q486.0938,677.75 484.8906,677.125 Q483.9063,676.625 483.2188,675.5547 Q482.5313,674.4844 482.5313,673.2031 L482.5313,672.0469 Q482.5313,670.7188 483.1484,669.5703 Q483.7656,668.4219 484.8594,667.8047 Q485.9531,667.1875 487.1875,667.1875 Q487.9219,667.1875 488.5703,667.3516 Q489.2188,667.5156 489.7656,667.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="501" y="676.9102">DefaultListableBeanFactory</text><line x1="473" x2="654" y1="688" y2="688" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="473" x2="654" y1="696" y2="696" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="BeanDefinitionRegistry" width="158" x="667.5" y="440" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="682.5" cy="456" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M683.4531,452.6406 L683.4531,459.2969 L685.1719,459.2969 Q685.7813,459.2969 686.0469,459.5313 Q686.3125,459.7656 686.3125,460.1563 Q686.3125,460.5313 686.0469,460.7656 Q685.7813,461 685.1719,461 L680.0313,461 Q679.4219,461 679.1563,460.7656 Q678.8906,460.5313 678.8906,460.1406 Q678.8906,459.7656 679.1563,459.5313 Q679.4219,459.2969 680.0313,459.2969 L681.75,459.2969 L681.75,452.6406 L680.0313,452.6406 Q679.4219,452.6406 679.1563,452.4063 Q678.8906,452.1719 678.8906,451.7813 Q678.8906,451.4063 679.1563,451.1719 Q679.4219,450.9375 680.0313,450.9375 L685.1719,450.9375 Q685.7813,450.9375 686.0469,451.1719 Q686.3125,451.4063 686.3125,451.7813 Q686.3125,452.1719 686.0469,452.4063 Q685.7813,452.6406 685.1719,452.6406 L683.4531,452.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="696.5" y="460.9102">BeanDefinitionRegistry</text><line x1="668.5" x2="824.5" y1="472" y2="472" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="668.5" x2="824.5" y1="480" y2="480" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="Serializable" width="99" x="704" y="548" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="719" cy="564" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M719.9531,560.6406 L719.9531,567.2969 L721.6719,567.2969 Q722.2813,567.2969 722.5469,567.5313 Q722.8125,567.7656 722.8125,568.1563 Q722.8125,568.5313 722.5469,568.7656 Q722.2813,569 721.6719,569 L716.5313,569 Q715.9219,569 715.6563,568.7656 Q715.3906,568.5313 715.3906,568.1406 Q715.3906,567.7656 715.6563,567.5313 Q715.9219,567.2969 716.5313,567.2969 L718.25,567.2969 L718.25,560.6406 L716.5313,560.6406 Q715.9219,560.6406 715.6563,560.4063 Q715.3906,560.1719 715.3906,559.7813 Q715.3906,559.4063 715.6563,559.1719 Q715.9219,558.9375 716.5313,558.9375 L721.6719,558.9375 Q722.2813,558.9375 722.5469,559.1719 Q722.8125,559.4063 722.8125,559.7813 Q722.8125,560.1719 722.5469,560.4063 Q722.2813,560.6406 721.6719,560.6406 L719.9531,560.6406 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="733" y="568.9102">Serializable</text><line x1="705" x2="802" y1="580" y2="580" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="705" x2="802" y1="588" y2="588" style="stroke:#A80036;stroke-width:1.5;"></line><rect fill="#FEFECE" filter="url(#f1h8acv7cgdxu6)" height="48" id="XmlBeanFactory" width="121" x="503" y="764" style="stroke:#A80036;stroke-width:1.5;"></rect><ellipse cx="518" cy="780" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"></ellipse><path d="M520.7656,775.875 Q520.9219,775.6563 521.1094,775.5469 Q521.2969,775.4375 521.5156,775.4375 Q521.8906,775.4375 522.125,775.6953 Q522.3594,775.9531 522.3594,776.5625 L522.3594,778.0156 Q522.3594,778.625 522.125,778.8906 Q521.8906,779.1563 521.5156,779.1563 Q521.1719,779.1563 520.9688,778.9531 Q520.7656,778.7656 520.6563,778.25 Q520.6094,777.8906 520.4219,777.7031 Q520.0938,777.3281 519.4844,777.1094 Q518.875,776.8906 518.25,776.8906 Q517.4844,776.8906 516.8516,777.2188 Q516.2188,777.5469 515.7266,778.2969 Q515.2344,779.0469 515.2344,780.0781 L515.2344,781.1719 Q515.2344,782.4063 516.125,783.2266 Q517.0156,784.0469 518.6094,784.0469 Q519.5469,784.0469 520.2031,783.7969 Q520.5938,783.6406 521.0156,783.2031 Q521.2813,782.9375 521.4297,782.8594 Q521.5781,782.7813 521.7813,782.7813 Q522.1094,782.7813 522.3672,783.0391 Q522.625,783.2969 522.625,783.6406 Q522.625,783.9844 522.2813,784.3906 Q521.7813,784.9688 520.9844,785.2969 Q519.9063,785.75 518.6094,785.75 Q517.0938,785.75 515.8906,785.125 Q514.9063,784.625 514.2188,783.5547 Q513.5313,782.4844 513.5313,781.2031 L513.5313,780.0469 Q513.5313,778.7188 514.1484,777.5703 Q514.7656,776.4219 515.8594,775.8047 Q516.9531,775.1875 518.1875,775.1875 Q518.9219,775.1875 519.5703,775.3516 Q520.2188,775.5156 520.7656,775.875 Z "></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="532" y="784.9102">XmlBeanFactory</text><line x1="504" x2="623" y1="796" y2="796" style="stroke:#A80036;stroke-width:1.5;"></line><line x1="504" x2="623" y1="804" y2="804" style="stroke:#A80036;stroke-width:1.5;"></line><path d="M216.703,184.341 C216.911,228.848 217.226,296.442 217.391,331.72 " fill="none" id="BeanFactory&lt;-AutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="209.703,184.342,216.609,164.309,223.702,184.276,209.703,184.342" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M262.255,176.402 C282.375,191.969 305.448,209.821 323.358,223.678 " fill="none" id="BeanFactory&lt;-HierarchicalBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="257.761,181.776,246.227,164,266.329,170.703,257.761,181.776" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M170.411,176.402 C150.144,191.969 126.903,209.821 108.862,223.678 " fill="none" id="BeanFactory&lt;-ListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="166.431,170.632,186.556,164,174.959,181.735,166.431,170.632" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M384.17,287.702 C395.855,302.448 408.806,318.791 419.019,331.678 " fill="none" id="HierarchicalBeanFactory&lt;-ConfigurableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="378.662,292.023,371.727,272,389.635,283.328,378.662,292.023" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M479.916,183.735 C468.896,228.231 452.043,296.281 443.266,331.72 " fill="none" id="SingletonBeanRegistry&lt;-ConfigurableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="473.124,182.04,484.727,164.309,486.714,185.405,473.124,182.04" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M714.745,73.613 C706.419,87.848 697.355,103.345 690.141,115.678 " fill="none" id="AliasRegistry&lt;-SimpleAliasRegistry" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="708.907,69.73,725.047,56,720.992,76.798,708.907,69.73" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M665.664,183.54 C662.176,197.235 658.441,211.9 655.44,223.678 " fill="none" id="SimpleAliasRegistry&lt;-DefaultSingletonBeanRegistry" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="658.921,181.654,670.641,164,672.488,185.109,658.921,181.654" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M541.919,175.279 C565.76,191.173 593.468,209.645 614.793,223.862 " fill="none" id="SingletonBeanRegistry&lt;-DefaultSingletonBeanRegistry" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="537.759,180.919,525.001,164,545.525,169.27,537.759,180.919" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M651.124,292.024 C651.635,305.579 652.181,320.038 652.62,331.678 " fill="none" id="DefaultSingletonBeanRegistry&lt;-FactoryBeanRegistrySupport" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="644.127,292.25,650.368,272,658.117,291.722,644.127,292.25" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M604.988,391.745 C582.944,407.533 557.462,425.784 537.806,439.862 " fill="none" id="FactoryBeanRegistrySupport&lt;-AbstractBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="601.05,385.955,621.386,380,609.202,397.337,601.05,385.955" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M463.246,397.134 C472.462,411.499 482.538,427.207 490.539,439.678 " fill="none" id="ConfigurableBeanFactory&lt;-AbstractBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="457.162,400.614,452.255,380,468.946,393.055,457.162,400.614" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M493.862,507.54 C490.115,521.235 486.103,535.9 482.88,547.678 " fill="none" id="AbstractBeanFactory&lt;-AbstractAutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="487.178,505.444,499.207,488,500.681,509.139,487.178,505.444" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M273.77,390.74 C296.161,405.007 321.725,422.386 343.5,440 C386.085,474.447 430.406,520.504 455.613,547.83 " fill="none" id="AutowireCapableBeanFactory&lt;-AbstractAutowireCapableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="269.873,396.559,256.627,380.019,277.296,384.688,269.873,396.559" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M77.9802,292.374 C79.5321,319.419 85.0822,353.916 101.5,380 C117.725,405.778 145.137,425.945 169.241,439.943 " fill="none" id="ListableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="70.9772,292.344,77.4636,272.171,84.9726,291.986,70.9772,292.344" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M217.5,400.024 C217.5,413.579 217.5,428.038 217.5,439.678 " fill="none" id="AutowireCapableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="210.5,400,217.5,380,224.5,400,210.5,400" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M371.616,388.744 C337.506,405.179 296.612,424.882 265.523,439.862 " fill="none" id="ConfigurableBeanFactory&lt;-ConfigurableListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="368.707,382.376,389.763,380,374.784,394.988,368.707,382.376" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M508.265,611.702 C520.368,626.448 533.781,642.791 544.359,655.678 " fill="none" id="AbstractAutowireCapableBeanFactory&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="502.655,615.901,495.378,596,513.477,607.019,502.655,615.901" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M245.848,504.592 C268.2,533.346 301.665,571.378 338.5,596 C378.826,622.956 429.046,642.566 471.803,655.935 " fill="none" id="ConfigurableListableBeanFactory&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="240.169,508.687,233.734,488.498,251.354,500.267,240.169,508.687" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M713.517,503.57 C675.628,547.877 614.675,619.156 583.408,655.72 " fill="none" id="BeanDefinitionRegistry&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="708.249,498.96,726.567,488.309,718.889,508.059,708.249,498.96" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M694.546,605.89 C665.511,622.089 631.203,641.229 604.974,655.862 " fill="none" id="Serializable&lt;-DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"></path><polygon fill="none" points="691.397,599.632,712.273,596,698.217,611.858,691.397,599.632" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M755.122,75.39 C759.381,88.231 763.361,102.511 765.5,116 C783.875,231.886 778.674,263.409 765.5,380 C763.176,400.565 757.712,423.46 753.237,439.986 " fill="none" id="AliasRegistry&lt;-BeanDefinitionRegistry" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="748.376,77.317,748.197,56.128,761.551,72.58,748.376,77.317" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M563.5,724.0236 C563.5,737.5792 563.5,752.0381 563.5,763.6784 " fill="none" id="DefaultListableBeanFactory&lt;-XmlBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="none" points="556.5,724.0005,563.5,704,570.5,724.0004,556.5,724.0005" style="stroke:#A80036;stroke-width:1.0;"></polygon></g></svg><h4 id="_1-3"><a href="#_1-3" class="header-anchor">#</a> 1.3</h4> <h2 id="二、容器的创建过程"><a href="#二、容器的创建过程" class="header-anchor">#</a> 二、容器的创建过程</h2> <p>以 <code>ClassPathXmlApplicationContext</code> 的创建过程为例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextTest</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">ClassPathXmlApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;beanFactoryTest.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">MyTestBean</span> bean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MyTestBean</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;myTestBean&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;testStr&quot;</span><span class="token punctuation">,</span> bean<span class="token punctuation">.</span><span class="token function">getTestStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_1-流程图"><a href="#_1-流程图" class="header-anchor">#</a> 1.流程图</h3> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="550px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1180 550" width="1180px" zoomAndPan="magnify" style="width:1180px;height:550px;"><defs><filter height="300%" id="f1ec8c0cpq3h2t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"></feOffset><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"></feBlend></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1ec8c0cpq3h2t)" height="330" width="570" x="33" y="209" style="stroke:#000000;stroke-width:1.5;"></rect><path d="M73,210 L73,219.6094 L63,229.6094 L33,229.6094 " fill="none" style="stroke:#000000;stroke-width:1.5;"></path><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="36" y="224.5332">容器</text><rect fill="#FFFFFF" filter="url(#f1ec8c0cpq3h2t)" height="106" width="394" x="76" y="261" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="193" x="176.5" y="277.5332">DefaultListableBeanFactory</text><rect fill="#FFFFFF" filter="url(#f1ec8c0cpq3h2t)" height="90" width="522" x="57" y="425" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="212.5" y="441.5332">DefaultSingletonBeanRegistry</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="138" x="308" y="305" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="318" y="329.5332">beanDefinitionMap</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="154" x="119" y="305" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="129" y="329.5332">beanDefinitionNames</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="125" x="73.5" y="461" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="83.5" y="485.5332">singletonObjects</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="158" x="234" y="461" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="244" y="485.5332">earlySingletonObjects</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="136" x="427" y="461" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="437" y="485.5332">singletonFactories</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="88" x="40" y="8" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="50" y="32.5332">1.项目启动</text><polygon fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" points="6,107,6,144.6094,162,144.6094,162,117,152,107,6,107" style="stroke:#000000;stroke-width:1.5;"></polygon><path d="M152,107 L152,117 L162,117 " fill="#FEFECE" style="stroke:#000000;stroke-width:1.5;"></path><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="136" x="16" y="131.5332">config.xml/JavaConfig</text><rect fill="#FEFECE" filter="url(#f1ec8c0cpq3h2t)" height="37.6094" width="85" x="706.5" y="305" style="stroke:#000000;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="716.5" y="329.5332">2.getBean</text><path d="M84,46.245 C84,61.961 84,84.735 84,101.754 " fill="none" id="startProject-&gt;configFile" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="84,106.837,88,97.837,84,101.837,80,97.837,84,106.837" style="stroke:#A80036;stroke-width:1.0;"></polygon><path d="M84,145.088 C84,168.9695 84,212.4415 84,250.4344 C84,252.8089 84,255.1621 84,257.4877 C84,258.6505 84,259.8065 84,260.9547 " fill="none" id="configFile-&gt;DefaultListableBeanFactory" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="84,260.9547,88,251.9547,84,255.9547,80,251.9547,84,260.9547" style="stroke:#A80036;stroke-width:1.0;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="85" y="189.4951">1.1将配置信息持久化为BeanDefinition</text><path d="M76.5544,367.3632 C76.5372,367.6409 76.5207,367.9192 76.505,368.1981 C76.2523,372.6592 76.1747,377.2547 76.3477,381.8743 C76.6938,391.1136 78.0427,400.4495 81,409 C87.3179,427.267 100.589,444.392 112.512,457.1317 " fill="none" id="DefaultListableBeanFactory-&gt;singletonObjects" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="116.16,460.9409,112.8227,451.6747,112.7012,457.3302,107.0457,457.2087,116.16,460.9409" style="stroke:#A80036;stroke-width:1.0;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="82" y="405.4951">1.2遍历beanDefinitionNames，并根据BeanDefinition生成单例非懒加载bean</text><path d="M706.236,336.78 C665.729,348.529 603.593,368.094 552,391 C537.086,397.621 535.729,404.658 520,409 C487.429,417.992 247.823,405.642 216,417 C192.963,425.222 171.325,442.834 156.376,457.1938 " fill="none" id="getBean-&gt;singletonObjects" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="152.723,460.7667,161.9542,457.3339,156.2977,457.2708,156.3608,451.6143,152.723,460.7667" style="stroke:#A80036;stroke-width:1.0;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="553" y="405.4951">2.1先看单例池中是否存在</text><path d="M746.273,343.052 C742.199,363.001 732.44,394.255 710,409 C696.02,418.186 424.981,412.056 409,417 C382.392,425.231 356.098,443.079 337.775,457.5211 " fill="none" id="getBean-&gt;earlySingletonObjects" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="333.757,460.7338,343.284,458.2367,337.6619,457.611,338.2876,451.9889,333.757,460.7338" style="stroke:#A80036;stroke-width:1.0;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="728" y="405.4951">2.2再看earlySingletonObjects 是否存在</text><path d="M791.504,326.376 C871.823,330.436 1033.19,346.41 979,409 C926.791,469.303 690.487,478.7947 568.453,479.5771 " fill="none" id="getBean-&gt;singletonFactories" style="stroke:#A80036;stroke-width:1.0;"></path><polygon fill="#A80036" points="563.445,479.6047,572.4666,483.5558,568.4449,479.5776,572.4232,475.5559,563.445,479.6047" style="stroke:#A80036;stroke-width:1.0;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="988" y="405.4951">2.3singletonFactories 是否存在</text></g></svg><hr> <hr> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="799px" preserveAspectRatio="none" version="1.1" viewBox="0 0 726 799" width="726px" zoomAndPan="magnify" style="width:726px;height:799px;"><defs><filter height="300%" id="f1u954qkmphrju" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"></feOffset><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"></feBlend></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1u954qkmphrju)" height="132.7969" width="283" x="221" y="10" style="stroke:#000000;stroke-width:2.0;"></rect><path d="M287,11 L287,20.6094 L277,30.6094 L221,30.6094 " fill="none" style="stroke:#000000;stroke-width:2.0;"></path><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="224" y="25.5332">准备阶段</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="263" x="231" y="40.6094" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="243" x="241" y="63.0664">设置 PathMatchingResourcePatternResolver</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="152" x="286.5" y="95.7031" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="296.5" y="118.1602">解析并设置配置文件路径</text><rect fill="#FFFFFF" filter="url(#f1u954qkmphrju)" height="635.6406" width="705" x="10" y="152.7969" style="stroke:#000000;stroke-width:2.0;"></rect><path d="M76,153.7969 L76,163.4063 L66,173.4063 L10,173.4063 " fill="none" style="stroke:#000000;stroke-width:2.0;"></path><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="13" y="168.3301">刷新容器</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="227" x="249" y="190.4063" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="207" x="259" y="212.8633">prepareRefresh：主要是验证必需属性</text><rect fill="#FFD700" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="685" x="20" y="245.5" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="665" x="30" y="267.957">obtainFreshBeanFactory：持久化配置信息，构建DefaultListableBeanFactory的beanDefinitionMap、beanDefinitionNames</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="330" x="197.5" y="300.5938" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="310" x="207.5" y="323.0508">prepareBeanFactory：配置beanFactory的标准上下文特征</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="206" x="259.5" y="355.6875" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="186" x="269.5" y="378.1445">postProcessBeanFactory：空实现</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="434" x="145.5" y="410.7813" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="414" x="155.5" y="433.2383">invokeBeanFactoryPostProcessors：调用所有的BeanFactoryPostProcessor</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="513" x="106" y="465.875" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="493" x="116" y="488.332">registerBeanPostProcessors: 根据类型获取到所有的BeanPostProcessor然后初始化并注册</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="126" x="299.5" y="520.9688" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="106" x="309.5" y="543.4258">initMessageSource</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="185" x="270" y="576.0625" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="280" y="598.5195">initApplicationEventMulticaster</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="120" x="302.5" y="631.1563" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="100" x="312.5" y="653.6133">onRefresh: 空实现</text><rect fill="#FEFECE" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="114" x="305.5" y="686.25" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="94" x="315.5" y="708.707">registerListeners</text><rect fill="#FFD700" filter="url(#f1u954qkmphrju)" height="35.0938" rx="12.5" ry="12.5" width="324" x="200.5" y="741.3438" style="stroke:#A80036;stroke-width:1.5;"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="304" x="210.5" y="763.8008">finishBeanFactoryInitialization: 实例化单例非懒加载bean</text><line x1="362.5" x2="362.5" y1="75.7031" y2="95.7031" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,85.7031,362.5,95.7031,366.5,85.7031,362.5,89.7031" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="225.5" y2="245.5" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,235.5,362.5,245.5,366.5,235.5,362.5,239.5" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="280.5938" y2="300.5938" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,290.5938,362.5,300.5938,366.5,290.5938,362.5,294.5938" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="335.6875" y2="355.6875" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,345.6875,362.5,355.6875,366.5,345.6875,362.5,349.6875" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="390.7813" y2="410.7813" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,400.7813,362.5,410.7813,366.5,400.7813,362.5,404.7813" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="445.875" y2="465.875" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,455.875,362.5,465.875,366.5,455.875,362.5,459.875" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="500.9688" y2="520.9688" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,510.9688,362.5,520.9688,366.5,510.9688,362.5,514.9688" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="556.0625" y2="576.0625" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,566.0625,362.5,576.0625,366.5,566.0625,362.5,570.0625" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="611.1563" y2="631.1563" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,621.1563,362.5,631.1563,366.5,621.1563,362.5,625.1563" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="666.25" y2="686.25" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,676.25,362.5,686.25,366.5,676.25,362.5,680.25" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="721.3438" y2="741.3438" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,731.3438,362.5,741.3438,366.5,731.3438,362.5,735.3438" style="stroke:#A80036;stroke-width:1.0;"></polygon><line x1="362.5" x2="362.5" y1="130.7969" y2="190.4063" style="stroke:#A80036;stroke-width:1.5;"></line><polygon fill="#A80036" points="358.5,180.4063,362.5,190.4063,366.5,180.4063,362.5,184.4063" style="stroke:#A80036;stroke-width:1.0;"></polygon></g></svg><h3 id="_2-时序图"><a href="#_2-时序图" class="header-anchor">#</a> 2.时序图</h3> <h3 id="_3-具体流程分析"><a href="#_3-具体流程分析" class="header-anchor">#</a> 3.具体流程分析</h3> <p>ClassPathXmlApplicationContext的构造器如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations<span class="token punctuation">,</span> <span class="token keyword">boolean</span> refresh<span class="token punctuation">,</span> <span class="token class-name">ApplicationContext</span> 	         parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//设置 PathMatchingResourcePatternResolver</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setConfigLocations</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//默认true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>refresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_3-1-设置-pathmatchingresourcepatternresolver"><a href="#_3-1-设置-pathmatchingresourcepatternresolver" class="header-anchor">#</a> 3.1 设置 PathMatchingResourcePatternResolver</h4> <p>（1）首先看父类构造器，沿着继承体系一直向上调用，直到AbstractApplicationContext:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setParent</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver <span class="token operator">=</span> <span class="token function">getResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>getResourcePatternResolver:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ResourcePatternResolver</span> <span class="token function">getResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>PathMatchingResourcePatternResolver支持Ant风格的路径解析。</p> <p>由于parent 为null，因此此处是将parent置空</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ApplicationContext</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置 parent ApplicationContext</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 合并父子容器的 Environment</span>
			<span class="token class-name">Environment</span> parentEnvironment <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parentEnvironment <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableEnvironment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span><span class="token punctuation">)</span> parentEnvironment<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-设置配置文件路径"><a href="#_3-2-设置配置文件路径" class="header-anchor">#</a> 3.2 设置配置文件路径</h4> <p>即AbstractRefreshableConfigApplicationContext.setConfigLocations:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigLocations</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> locations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>locations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">noNullElements</span><span class="token punctuation">(</span>locations<span class="token punctuation">,</span> <span class="token string">&quot;Config locations must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>locations<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> locations<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>configLocations<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span>locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>resolvePath:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveRequiredPlaceholders</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此方法的目的在于将占位符(placeholder)解析成实际的地址。比如可以这么写: <code>new ClassPathXmlApplicationContext(&quot;classpath:config.xml&quot;);</code>那么classpath:就是需要被解析的。</p> <p>getEnvironment方法来自于ConfigurableApplicationContext接口，源码很简单，如果为空就调用createEnvironment创建一个。AbstractApplicationContext.createEnvironment:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token function">createEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StandardEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>AbstractEnvironment.resolveRequiredPlaceholders</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>	@Override
	public String resolveRequiredPlaceholders(String text) throws IllegalArgumentException {
		return this.propertyResolver.resolveRequiredPlaceholders(text);
	}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>AbstractPropertyResolver.resolveRequiredPlaceholders</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resolveRequiredPlaceholders</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>strictHelper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>strictHelper <span class="token operator">=</span> <span class="token function">createPlaceholderHelper</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token function">doResolvePlaceholders</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strictHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token class-name">PropertyPlaceholderHelper</span> <span class="token function">createPlaceholderHelper</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> ignoreUnresolvablePlaceholders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// this.placeholderPrefix :  ${</span>
        <span class="token comment">// this.placeholderSuffix :  }</span>
        <span class="token comment">// this.valueSeparator    :  :</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PropertyPlaceholderHelper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>placeholderPrefix<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>placeholderSuffix<span class="token punctuation">,</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>valueSeparator<span class="token punctuation">,</span> ignoreUnresolvablePlaceholders<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">doResolvePlaceholders</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token class-name">PropertyPlaceholderHelper</span> helper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> helper<span class="token punctuation">.</span><span class="token function">replacePlaceholders</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">getPropertyAsRawString</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这里是解析配置文件路径中包含的占位符</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;spring&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;${spring}:config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SimpleBean</span> bean <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">SimpleBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样就能成功设置配置文件路径了</p> <h2 id="三、refresh"><a href="#三、refresh" class="header-anchor">#</a> 三、refresh</h2> <p>Spring bean解析就在此方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Prepare this context for refreshing.</span>
			<span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Tell the subclass to refresh the internal bean factory.</span>
			<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Prepare the bean factory for use in this context.</span>
			<span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token comment">// Allows post-processing of the bean factory in context subclasses.</span>
				<span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Invoke factory processors registered as beans in the context.</span>
				<span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Register bean processors that intercept bean creation.</span>
				<span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Initialize message source for this context.</span>
				<span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Initialize event multicaster for this context.</span>
				<span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Initialize other special beans in specific context subclasses.</span>
				<span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Check for listener beans and register them.</span>
				<span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Instantiate all remaining (non-lazy-init) singletons.</span>
				<span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Last step: publish corresponding event.</span>
				<span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Exception encountered during context initialization - &quot;</span> <span class="token operator">+</span>
							<span class="token string">&quot;cancelling refresh attempt: &quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// Destroy already created singletons to avoid dangling resources.</span>
				<span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Reset 'active' flag.</span>
				<span class="token function">cancelRefresh</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// Propagate exception to caller.</span>
				<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">finally</span> <span class="token punctuation">{</span>
				<span class="token comment">// Reset common introspection caches in Spring's core, since we</span>
				<span class="token comment">// might not ever need metadata for singleton beans anymore...</span>
				<span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h3 id="_1-preparerefresh"><a href="#_1-preparerefresh" class="header-anchor">#</a> 1.prepareRefresh</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Switch to active.</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>startupDate <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>closed<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Refreshing &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Refreshing &quot;</span> <span class="token operator">+</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Initialize any placeholder property sources in the context environment.</span>
        <span class="token comment">// 空实现</span>
		<span class="token function">initPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Validate that all properties marked as required are resolvable:</span>
		<span class="token comment">// see ConfigurablePropertyResolver#setRequiredProperties</span>
		<span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validateRequiredProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Store pre-refresh ApplicationListeners...</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationListeners <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationListeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationListeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Reset local application listeners to pre-refresh state.</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>applicationListeners<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>applicationListeners<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationListeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Allow for the collection of early ApplicationEvents,</span>
		<span class="token comment">// to be published once the multicaster is available...</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationEvents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="_1-1-属性校验"><a href="#_1-1-属性校验" class="header-anchor">#</a> 1.1 属性校验</h4> <p>AbstractEnvironment.validateRequiredProperties:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validateRequiredProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MissingRequiredPropertiesException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>propertyResolver<span class="token punctuation">.</span><span class="token function">validateRequiredProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>AbstractPropertyResolver.validateRequiredProperties:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validateRequiredProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MissingRequiredPropertiesException</span> ex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MissingRequiredPropertiesException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requiredProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">addMissingRequiredProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ex<span class="token punctuation">.</span><span class="token function">getMissingRequiredProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>requiredProperties是通过setRequiredProperties方法设置的，保存在一个list里面，默认是空的，也就是不需要校验任何属性。</p> <h3 id="_2-obtainfreshbeanfactory"><a href="#_2-obtainfreshbeanfactory" class="header-anchor">#</a> 2.obtainFreshBeanFactory</h3> <p>创建 BeanFactory</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>调用AbstractRefreshableApplicationContext.refreshBeanFactory:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
	 * This implementation performs an actual refresh of this context's underlying
	 * bean factory, shutting down the previous bean factory (if any) and
	 * initializing a fresh bean factory for the next phase of the context's lifecycle.
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//如果已经存在，那么销毁之前的</span>
			<span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">closeBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">//创建了一个DefaultListableBeanFactory对象</span>
			<span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">createBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			beanFactory<span class="token punctuation">.</span><span class="token function">setSerializationId</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//定制 BeanFactory</span>
			<span class="token function">customizeBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//加载Bean</span>
			<span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextException</span><span class="token punctuation">(</span><span class="token string">&quot;I/O error parsing bean definition source for &quot;</span> <span class="token operator">+</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_2-1-定制-beanfactory"><a href="#_2-1-定制-beanfactory" class="header-anchor">#</a> 2.1 定制 BeanFactory</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">customizeBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowBeanDefinitionOverriding <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//默认true, 允许覆盖</span>
			beanFactory<span class="token punctuation">.</span><span class="token function">setAllowBeanDefinitionOverriding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowBeanDefinitionOverriding<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowCircularReferences <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//默认true, 允许循环引用</span>
			beanFactory<span class="token punctuation">.</span><span class="token function">setAllowCircularReferences</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowCircularReferences<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-2-加载bean"><a href="#_2-2-加载bean" class="header-anchor">#</a> 2.2 加载Bean</h4> <p>AbstractXmlApplicationContext.loadBeanDefinitions，这个便是核心的bean加载了:</p> <p>先初始化一个 BeanDefinitionReader</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">// Create a new XmlBeanDefinitionReader for the given BeanFactory.</span>
		<span class="token class-name">XmlBeanDefinitionReader</span> beanDefinitionReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Configure the bean definition reader with this context's</span>
		<span class="token comment">// resource loading environment.</span>
		beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Allow a subclass to provide custom initialization of the reader,</span>
		<span class="token comment">// then proceed with actually loading the bean definitions.</span>
		<span class="token function">initBeanDefinitionReader</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_2-3-1-路径解析"><a href="#_2-3-1-路径解析" class="header-anchor">#</a> 2.3.1 路径解析</h5> <p>先获取配置文件</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">XmlBeanDefinitionReader</span> reader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configResources <span class="token operator">=</span> <span class="token function">getConfigResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>configResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configResources<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations <span class="token operator">=</span> <span class="token function">getConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>configLocations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//here</span>
			reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>然后挨个加载配置文件</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> locations<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>locations<span class="token punctuation">,</span> <span class="token string">&quot;Location array must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> location <span class="token operator">:</span> locations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 挨个加载配置文件 </span>
			count <span class="token operator">+=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> count<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token comment">//第二个参数为空</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> actualResources<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
        <span class="token comment">//参见ResourceLoader类图，ClassPathXmlApplicationContext实现了此接口</span>
		<span class="token class-name">ResourceLoader</span> resourceLoader <span class="token operator">=</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
					<span class="token string">&quot;Cannot load bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]: no ResourceLoader available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token keyword">instanceof</span> <span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Resource pattern matching available.</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> resourceLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>actualResources<span class="token punctuation">,</span> resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> count<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
						<span class="token string">&quot;Could not resolve bean definition resource pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Can only load single resources by absolute URL.</span>
			<span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> count<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>getResource的实现在AbstractApplicationContext：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//构造器中初始化，PathMatchingResourcePatternResolver对象</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>PathMatchingResourcePatternResolver是ResourceLoader继承体系的一部分。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">,</span> <span class="token string">&quot;Location pattern must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//classpath:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>CLASSPATH_ALL_URL_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a class path resource (multiple resources for same name possible)</span>
        <span class="token comment">//matcher是一个AntPathMatcher对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPattern</span><span class="token punctuation">(</span>locationPattern
            <span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>CLASSPATH_ALL_URL_PREFIX<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// a class path resource pattern</span>
            <span class="token keyword">return</span> <span class="token function">findPathMatchingResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// all class path resources with the given name</span>
            <span class="token keyword">return</span> <span class="token function">findAllClassPathResources</span><span class="token punctuation">(</span>locationPattern
                <span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>CLASSPATH_ALL_URL_PREFIX<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Only look for a pattern after a prefix here</span>
        <span class="token comment">// (to not get fooled by a pattern symbol in a strange prefix).</span>
        <span class="token keyword">int</span> prefixEnd <span class="token operator">=</span> locationPattern<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPattern</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>prefixEnd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// a file pattern</span>
            <span class="token keyword">return</span> <span class="token function">findPathMatchingResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// a single resource with the given name</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>isPattern:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPattern</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以看出配置文件路径是支持ant风格的，也就是可以这么写:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;con*.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>具体怎么解析ant风格的就不写了。</p> <h5 id="_2-3-2-配置文件加载"><a href="#_2-3-2-配置文件加载" class="header-anchor">#</a> 2.3.2 配置文件加载</h5> <p>入口方法在AbstractBeanDefinitionReader的217行:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//加载</span>
<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> resourceLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//解析</span>
<span class="token keyword">int</span> loadCount <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>最终逐个调用XmlBeanDefinitionReader的loadBeanDefinitions方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EncodedResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Resource是代表一种资源的接口</p> <p>EncodedResource扮演的其实是一个装饰器的模式，为InputStreamSource添加了字符编码(虽然默认为null)。这样为我们自定义xml配置文件的编码方式提供了机会。</p> <p>之后关键的源码只有两行:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> encodedResource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">InputSource</span> inputSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>InputSource是org.xml.sax的类。</p> <p>doLoadBeanDefinitions：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>doLoadDocument:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Document</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>documentLoader<span class="token punctuation">.</span><span class="token function">loadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> <span class="token function">getEntityResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>errorHandler<span class="token punctuation">,</span>
        <span class="token function">getValidationModeForResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">isNamespaceAware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>documentLoader是一个DefaultDocumentLoader对象，此类是DocumentLoader接口的唯一实现。getEntityResolver方法返回ResourceEntityResolver，上面说过了。errorHandler是一个SimpleSaxErrorHandler对象。</p> <p>校验模型其实就是确定xml文件使用xsd方式还是dtd方式来校验，忘了的话左转度娘。Spring会通过读取xml文件的方式判断应该采用哪种。</p> <p>NamespaceAware默认false，因为默认配置了校验为true。</p> <p>documentLoader是一个DefaultDocumentLoader对象，此类是DocumentLoader接口的唯一实现。getEntityResolver方法返回ResourceEntityResolver，上面说过了。errorHandler是一个SimpleSaxErrorHandler对象。</p> <p>校验模型其实就是确定xml文件使用xsd方式还是dtd方式来校验，忘了的话左转度娘。Spring会通过读取xml文件的方式判断应该采用哪种。</p> <p>NamespaceAware默认false，因为默认配置了校验为true。</p> <p>DefaultDocumentLoader.loadDocument:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Document</span> <span class="token function">loadDocument</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">EntityResolver</span> entityResolver<span class="token punctuation">,</span>
    <span class="token class-name">ErrorHandler</span> errorHandler<span class="token punctuation">,</span> <span class="token keyword">int</span> validationMode<span class="token punctuation">,</span> <span class="token keyword">boolean</span> namespaceAware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//这里就是老套路了，可以看出，Spring还是使用了dom的方式解析，即一次全部load到内存</span>
    <span class="token class-name">DocumentBuilderFactory</span> factory <span class="token operator">=</span> <span class="token function">createDocumentBuilderFactory</span><span class="token punctuation">(</span>validationMode<span class="token punctuation">,</span> namespaceAware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DocumentBuilder</span> builder <span class="token operator">=</span> <span class="token function">createDocumentBuilder</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> entityResolver<span class="token punctuation">,</span> errorHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>createDocumentBuilderFactory比较有意思:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">DocumentBuilderFactory</span> <span class="token function">createDocumentBuilderFactory</span><span class="token punctuation">(</span><span class="token keyword">int</span> validationMode<span class="token punctuation">,</span> <span class="token keyword">boolean</span> namespaceAware<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">DocumentBuilderFactory</span> factory <span class="token operator">=</span> <span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setNamespaceAware</span><span class="token punctuation">(</span>namespaceAware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>validationMode <span class="token operator">!=</span> <span class="token class-name">XmlValidationModeDetector</span><span class="token punctuation">.</span>VALIDATION_NONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//此方法设为true仅对dtd有效，xsd(schema)无效</span>
        factory<span class="token punctuation">.</span><span class="token function">setValidating</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>validationMode <span class="token operator">==</span> <span class="token class-name">XmlValidationModeDetector</span><span class="token punctuation">.</span>VALIDATION_XSD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Enforce namespace aware for XSD...</span>
             <span class="token comment">//开启xsd(schema)支持</span>
            factory<span class="token punctuation">.</span><span class="token function">setNamespaceAware</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//这个也是Java支持Schema的套路，可以问度娘</span>
            factory<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>SCHEMA_LANGUAGE_ATTRIBUTE<span class="token punctuation">,</span> XSD_SCHEMA_LANGUAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_2-3-3-bean解析"><a href="#_2-3-3-bean解析" class="header-anchor">#</a> 2.3.3 Bean解析</h5> <p>XmlBeanDefinitionReader.registerBeanDefinitions:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanDefinitionDocumentReader</span> documentReader <span class="token operator">=</span> <span class="token function">createBeanDefinitionDocumentReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> countBefore <span class="token operator">=</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    documentReader<span class="token punctuation">.</span><span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token function">createReaderContext</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> countBefore<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>createBeanDefinitionDocumentReader:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">BeanDefinitionDocumentReader</span> <span class="token function">createBeanDefinitionDocumentReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BeanDefinitionDocumentReader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span>cast
      <span class="token comment">//反射</span>
      <span class="token punctuation">(</span><span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>documentReaderClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>documentReaderClass默认是DefaultBeanDefinitionDocumentReader，这其实也是策略模式，通过setter方法可以更换其实现。</p> <p>注意cast方法，代替了强转。</p> <p>createReaderContext：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">XmlReaderContext</span> <span class="token function">createReaderContext</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XmlReaderContext</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>problemReporter<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventListener<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sourceExtractor<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>problemReporter是一个FailFastProblemReporter对象。</p> <p>eventListener是EmptyReaderEventListener对象，此类里的方法都是空实现。</p> <p>sourceExtractor是NullSourceExtractor对象，直接返回空，也是空实现。</p> <p>getNamespaceHandlerResolver默认返回DefaultNamespaceHandlerResolver对象，用来获取xsd对应的处理器。</p> <p>XmlReaderContext的作用感觉就是这一堆参数的容器，糅合到一起传给DocumentReader，并美其名为Context。可以看出，Spring中到处都是策略模式，大量操作被抽象成接口。</p> <p>DefaultBeanDefinitionDocumentReader.registerBeanDefinitions:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">XmlReaderContext</span> readerContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext <span class="token operator">=</span> readerContext<span class="token punctuation">;</span>
    <span class="token class-name">Element</span> root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>doRegisterBeanDefinitions:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanDefinitionParserDelegate</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token function">createDelegate</span><span class="token punctuation">(</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> root<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//默认的命名空间即</span>
    <span class="token comment">//http://www.springframework.org/schema/beans</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//检查profile属性</span>
        <span class="token class-name">String</span> profileSpec <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>PROFILE_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>profileSpec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//profile属性可以以,分割</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> specifiedProfiles <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>
                    profileSpec<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span><span class="token punctuation">.</span>MULTI_VALUE_ATTRIBUTE_DELIMITERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acceptsProfiles</span><span class="token punctuation">(</span>specifiedProfiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">preProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>delegate的作用在于处理beans标签的嵌套，其实Spring配置文件是可以写成这样的:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Object<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>xml(schema)的命名空间其实类似于java的报名，命名空间采用URL，比如Spring的是这样:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>xmlns属性就是xml规范定义的用来设置命名空间的。这样设置了之后其实里面的bean元素全名就相当于http://www.springframework.org/schema/beans:bean，可以有效的防止命名冲突。命名空间可以通过规范定义的org.w3c.dom.Node.getNamespaceURI方法获得。</p> <p>注意一下profile的检查, AbstractEnvironment.acceptsProfiles:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>profiles<span class="token punctuation">,</span> <span class="token string">&quot;Must specify at least one profile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> profile <span class="token operator">:</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> profile<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isProfileActive</span><span class="token punctuation">(</span>profile<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isProfileActive</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>原理很简单，注意从源码可以看出，<strong>profile属性支持!取反</strong>。</p> <p>preProcessXml方法是个空实现，供子类去覆盖，<strong>目的在于给子类一个把我们自定义的标签转为Spring标准标签的机会</strong>, 想的真周到。</p> <p>DefaultBeanDefinitionDocumentReader.parseBeanDefinitions：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NodeList</span> nl <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nl<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span> node <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Element</span> ele <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可见，对于非默认命名空间的元素交由delegate处理。</p> <h4 id="_2-3默认命名空间解析"><a href="#_2-3默认命名空间解析" class="header-anchor">#</a> 2.3默认命名空间解析</h4> <p>即import, alias, bean, 嵌套的beans四种元素。parseDefaultElement:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&quot;import&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> IMPORT_ELEMENT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">importBeanDefinitionResource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> ALIAS_ELEMENT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">processAliasRegistration</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> BEAN_ELEMENT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> NESTED_BEANS_ELEMENT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// recurse</span>
        <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="import"><a href="#import" class="header-anchor">#</a> import</h5> <p>写法示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CTIContext.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customerContext.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>importBeanDefinitionResource套路和之前的配置文件加载完全一样，不过注意被import进来的文件是先于当前文件 被解析的。</p> <h5 id="alias"><a href="#alias" class="header-anchor">#</a> alias</h5> <p>加入有一个bean名为componentA-dataSource，但是另一个组件想以componentB-dataSource的名字使用，就可以这样定义:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alias</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>componentA-dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>componentB-dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>processAliasRegistration核心源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processAliasRegistration</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>NAME_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> alias <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>ALIAS_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireAliasRegistered</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> <span class="token function">extractSource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>从前面的源码可以发现，registry其实就是DefaultListableBeanFactory，它实现了BeanDefinitionRegistry接口。registerAlias方法的实现在SimpleAliasRegistry:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> alias<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;'name' must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> <span class="token string">&quot;'alias' must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//名字和别名一样</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>alias<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ConcurrentHashMap</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>aliasMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> registeredName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aliasMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>registeredName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>registeredName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// An existing alias - no need to re-register</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">allowAliasOverriding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span>
                    <span class="token punctuation">(</span><span class="token string">&quot;Cannot register alias '&quot;</span> <span class="token operator">+</span> alias <span class="token operator">+</span> <span class="token string">&quot;' for name '&quot;</span> <span class="token operator">+</span>
                    name <span class="token operator">+</span> <span class="token string">&quot;': It is already registered for name '&quot;</span> <span class="token operator">+</span> registeredName <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">checkForAliasCircle</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>aliasMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>所以别名关系的保存使用Map完成，key为别名，value为本来的名字。</p> <h5 id="bean"><a href="#bean" class="header-anchor">#</a> bean</h5> <p>bean节点是Spring最最常见的节点了。</p> <p>DefaultBeanDefinitionDocumentReader.processBeanDefinition:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanDefinitionHolder</span> bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bdHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">decorateBeanDefinitionIfRequired</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bdHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Register the final decorated instance.</span>
            <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span>registerBeanDefinition
                <span class="token punctuation">(</span>bdHolder<span class="token punctuation">,</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register bean definition with name '&quot;</span> <span class="token operator">+</span>
                    bdHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Send registration event.</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireComponentRegistered</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h6 id="id-name处理"><a href="#id-name处理" class="header-anchor">#</a> id &amp; name处理</h6> <p>最终调用BeanDefinitionParserDelegate.parseBeanDefinitionElement(Element ele, BeanDefinition containingBean)，源码较长，分部分说明。</p> <p>首先获取到id和name属性，<strong>name属性支持配置多个，以逗号分隔，如果没有指定id，那么将以第一个name属性值代替。id必须是唯一的，name属性其实是alias的角色，可以和其它的bean重复，如果name也没有配置，那么其实什么也没做</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> id <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>ID_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nameAttr <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>NAME_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> aliases <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//按,分隔</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameArr <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span>tokenizeToStringArray
        <span class="token punctuation">(</span>nameAttr<span class="token punctuation">,</span> MULTI_VALUE_ATTRIBUTE_DELIMITERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    aliases<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>nameArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">String</span> beanName <span class="token operator">=</span> id<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>aliases<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//name的第一个值作为id</span>
    beanName <span class="token operator">=</span> aliases<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//默认null</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//校验id是否已重复，如果重复直接抛异常</span>
    <span class="token comment">//校验是通过内部一个HashSet完成的，出现过的id都会保存进此Set</span>
    <span class="token function">checkNameUniqueness</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h6 id="beanname生成"><a href="#beanname生成" class="header-anchor">#</a> beanName生成</h6> <p>如果name和id属性都没有指定，那么Spring会自己生成一个, BeanDefinitionParserDelegate.parseBeanDefinitionElement:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> beanClassName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
aliases<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可见，Spring同时会把类名作为其别名。</p> <p>最终调用的是BeanDefinitionReaderUtils.generateBeanName:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateBeanName</span><span class="token punctuation">(</span>
        <span class="token class-name">BeanDefinition</span> definition<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isInnerBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> generatedBeanName <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>generatedBeanName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>definition<span class="token punctuation">.</span><span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            generatedBeanName <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;$child&quot;</span><span class="token punctuation">;</span>
             <span class="token comment">//工厂方法产生的bean</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>definition<span class="token punctuation">.</span><span class="token function">getFactoryBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            generatedBeanName <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">getFactoryBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;$created&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> generatedBeanName<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isInnerBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Inner bean: generate identity hashcode suffix.</span>
        id <span class="token operator">=</span> generatedBeanName <span class="token operator">+</span> GENERATED_BEAN_NAME_SEPARATOR <span class="token operator">+</span> 
            <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">getIdentityHexString</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Top-level bean: use plain class name.</span>
        <span class="token comment">// Increase counter until the id is unique.</span>
        <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token comment">//用类名#自增的数字命名</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>counter <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            counter<span class="token operator">++</span><span class="token punctuation">;</span>
            id <span class="token operator">=</span> generatedBeanName <span class="token operator">+</span> GENERATED_BEAN_NAME_SEPARATOR <span class="token operator">+</span> counter<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h6 id="bean解析"><a href="#bean解析" class="header-anchor">#</a> bean解析</h6> <p>还是分部分说明(parseBeanDefinitionElement)。</p> <p>首先获取到bean的class属性和parent属性，配置了parent之后，当前bean会继承父bean的属性。之后根据class和parent创建BeanDefinition对象。</p> <h6 id="bean解析-2"><a href="#bean解析-2" class="header-anchor">#</a> bean解析</h6> <p>还是分部分说明(parseBeanDefinitionElement)。</p> <p>首先获取到bean的class属性和parent属性，配置了parent之后，当前bean会继承父bean的属性。之后根据class和parent创建BeanDefinition对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span>CLASS_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    className <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>CLASS_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">String</span> parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span>PARENT_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>PARENT_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">AbstractBeanDefinition</span> bd <span class="token operator">=</span> <span class="token function">createBeanDefinition</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>BeanDefinition的创建在BeanDefinitionReaderUtils.createBeanDefinition:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">AbstractBeanDefinition</span> <span class="token function">createBeanDefinition</span><span class="token punctuation">(</span>
        <span class="token class-name">String</span> parentName<span class="token punctuation">,</span> <span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GenericBeanDefinition</span> bd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bd<span class="token punctuation">.</span><span class="token function">setParentName</span><span class="token punctuation">(</span>parentName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>className <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bd<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            bd<span class="token punctuation">.</span><span class="token function">setBeanClassName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>之后是解析bean的其它属性，其实就是读取其配置，调用相应的setter方法保存在BeanDefinition中:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">parseBeanDefinitionAttributes</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后解析bean的decription子元素:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>one, two<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>SimpleBean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>就仅仅是个描述。</p> <p>然后是meta子元素的解析，meta元素在xml配置文件里是这样的:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>one, two<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skywalker<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注释上说，这样可以将任意的元数据附到对应的bean definition上。解析过程源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">parseMetaElements</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanMetadataAttributeAccessor</span> attributeAccessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">NodeList</span> nl <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nl<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span> node <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCandidateElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> META_ELEMENT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Element</span> metaElement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> metaElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>KEY_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> metaElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>VALUE_ATTRIBUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//就是一个key, value的载体，无他</span>
            <span class="token class-name">BeanMetadataAttribute</span> attribute <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanMetadataAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//sourceExtractor默认是NullSourceExtractor，返回的是空</span>
            attribute<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span><span class="token function">extractSource</span><span class="token punctuation">(</span>metaElement<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            attributeAccessor<span class="token punctuation">.</span><span class="token function">addMetadataAttribute</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>AbstractBeanDefinition继承自BeanMetadataAttributeAccessor类，底层使用了一个LinkedHashMap保存metadata。这个metadata具体是做什么暂时还不知道。</p> <p>lookup-method解析：</p> <p>此标签的作用在于当一个bean的某个方法被设置为lookup-method后，<strong>每次调用此方法时，都会返回一个新的指定bean的对象</strong>。用法示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.com.willchen.test.di.Apple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prototype<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!--水果盘--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fruitPlate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.com.willchen.test.di.FruitPlate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lookup-method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getFruit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>数据保存在Set中，对应的类是MethodOverrides。可以参考:</p> <p><a href="http://www.cnblogs.com/ViviChan/p/4981619.html" target="_blank" rel="noopener noreferrer">Spring - lookup-method方式实现依赖注入<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>replace-mothod解析:</p> <p>此标签用于替换bean里面的特定的方法实现，替换者必须实现Spring的MethodReplacer接口，有点像aop的意思。</p> <p>配置文件示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>replacer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>springroad.deomo.chap4.MethodReplace<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>springroad.deomo.chap4.LookupMethodBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>replaced-method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">replacer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>replacer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg-type</span> <span class="token attr-name">match</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>replaced-method</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>arg-type的作用是指定替换方法的参数类型，因为接口的定义参数都是Object的。参考: <a href="http://blog.csdn.net/lee576/article/details/8725548" target="_blank" rel="noopener noreferrer">SPRING.NET 1.3.2 学习20--方法注入之替换方法注入<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>解析之后将数据放在ReplaceOverride对象中，里面有一个LinkedList<String>专门用于保存arg-type。</String></p> <p>构造参数(constructor-arg)解析:</p> <p>作用一目了然，使用示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Cat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>type一般不需要指定，除了泛型集合那种。除此之外，constructor-arg还支持name, index, ref等属性，可以具体的指定参数的位置等。构造参数解析后保存在BeanDefinition内部一个ConstructorArgumentValues对象中。如果设置了index属性，那么以Map&lt;Integer, ValueHolder&gt;的形式保存，反之，以List<ValueHolder>的形式保存。</ValueHolder></p> <p>property解析:</p> <p>非常常用的标签，用以为bean的属性赋值，支持value和ref两种形式，示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skywalker<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>value和ref属性不能同时出现，如果是ref，那么将其值保存在不可变的RuntimeBeanReference对象中，其实现了BeanReference接口，此接口只有一个getBeanName方法。如果是value，那么将其值保存在TypedStringValue对象中。最终将对象保存在BeanDefinition内部一个MutablePropertyValues对象中(内部以ArrayList实现)。</p> <p>qualifier解析:</p> <p>配置示例:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.Student<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skywalker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qualifier</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.beans.factory.annotation.Qualifier<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>student<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>	
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.Student<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>seaswalker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>15<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qualifier</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>student_2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>qualifier</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBean<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>SimpleBean部分源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Student</span> student<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此标签和@Qualifier, @Autowired两个注解一起使用才有作用。@Autowired注解采用按类型查找的方式进行注入，如果找到多个需要类型的bean便会报错，有了@Qualifier标签就可以再按照此注解指定的名称查找。两者结合相当于实现了按类型+名称注入。type属性可以不指定，因为默认就是那个。qualifier标签可以有attribute子元素，比如:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qualifier</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.beans.factory.annotation.Qualifier<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>student<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>qualifier</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>貌似是用来在qualifier也区分不开的时候使用。attribute键值对保存在BeanMetadataAttribute对象中。整个qualifier保存在AutowireCandidateQualifier对象中。</p> <h6 id="bean装饰"><a href="#bean装饰" class="header-anchor">#</a> Bean装饰</h6> <p>这部分是针对其它schema的属性以及子节点，比如:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.Student<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-override</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>没见过这种用法，留个坑。</p> <h6 id="bean注册"><a href="#bean注册" class="header-anchor">#</a> Bean注册</h6> <p>BeanDefinitionReaderUtils.registerBeanDefinition:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>
    <span class="token class-name">BeanDefinitionHolder</span> definitionHolder<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Register bean definition under primary name.</span>
    <span class="token class-name">String</span> beanName <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Register aliases for bean name, if any.</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliases <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aliases <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> alias <span class="token operator">:</span> aliases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            registry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>registry其实就是DefaultListableBeanFactory对象，registerBeanDefinition方法主要就干了这么两件事:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>一个是Map，另一个是List，一目了然。registerAlias方法的实现在其父类SimpleAliasRegistry，就是把键值对放在了一个ConcurrentHashMap里。</p> <p>ComponentRegistered事件触发:</p> <p>默认是个空实现，前面说过了。</p> <h6 id="beandefiniton数据结构"><a href="#beandefiniton数据结构" class="header-anchor">#</a> BeanDefiniton数据结构</h6> <p>BeanDefiniton数据结构如下图:</p> <p><img src="/snote/assets/img/BeanDefinition.23a7f1ee.jpg" alt="BeanDefinition数据结构"></p> <h5 id="beans"><a href="#beans" class="header-anchor">#</a> beans</h5> <p>beans元素的嵌套直接递归调用DefaultBeanDefinitionDocumentReader.parseBeanDefinitions。</p> <h4 id="其它命名空间解析"><a href="#其它命名空间解析" class="header-anchor">#</a> 其它命名空间解析</h4> <p>入口在DefaultBeanDefinitionDocumentReader.parseBeanDefinitions-&gt;BeanDefinitionParserDelegate.parseCustomElement(第二个参数为空):</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parseCustomElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> containingBd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> namespaceUri <span class="token operator">=</span> <span class="token function">getNamespaceURI</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">NamespaceHandler</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ParserContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> containingBd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>NamespaceHandlerResolver由XmlBeanDefinitionReader初始化，是一个DefaultNamespaceHandlerResolver对象，也是NamespaceHandlerResolver接口的唯一实现。</p> <p>其resolve方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">NamespaceHandler</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> namespaceUri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> handlerMappings <span class="token operator">=</span> <span class="token function">getHandlerMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> handlerOrClassName <span class="token operator">=</span> handlerMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerOrClassName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerOrClassName <span class="token keyword">instanceof</span> <span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> handlerOrClassName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> handlerOrClassName<span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> handlerClass <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NamespaceHandler</span> namespaceHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>handlerClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        namespaceHandler<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        handlerMappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">,</span> namespaceHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> namespaceHandler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>容易看出，Spring其实使用了一个Map了保存其映射关系，key就是命名空间的uri，value是<strong>NamespaceHandler对象或是Class完整名，如果发现是类名，那么用反射的方法进行初始化，如果是NamespaceHandler对象，那么直接返回</strong>。</p> <p>NamespaceHandler映射关系来自于各个Spring jar包下的META-INF/spring.handlers文件，以spring-context包为例:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler
http\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler
http\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler
http\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler
http\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="namespacehandler继承体系"><a href="#namespacehandler继承体系" class="header-anchor">#</a> NamespaceHandler继承体系</h5> <p><img src="/snote/assets/img/NamespaceHandler.2e0e5e31.jpg" alt="NamespaceHandler继承体系"></p> <h5 id="init"><a href="#init" class="header-anchor">#</a> init</h5> <p>resolve中调用了其init方法，此方法用以向NamespaceHandler对象注册BeanDefinitionParser对象。<strong>此接口用以解析顶层(beans下)的非默认命名空间元素，比如<code>&lt;context:annotation-config /&gt;</code></strong>。</p> <p>所以这样逻辑就很容易理解了: <strong>每种子标签的解析仍是策略模式的体现，init负责向父类NamespaceHandlerSupport注册不同的策略，由父类的NamespaceHandlerSupport.parse方法根据具体的子标签调用相应的策略完成解析的过程</strong>。</p> <p>此部分较为重要，所以重新开始大纲。</p> <h5 id="beanfactory数据结构"><a href="#beanfactory数据结构" class="header-anchor">#</a> BeanFactory数据结构</h5> <p>BeanDefinition在BeanFactory中的主要数据结构如下图:</p> <p><img src="/snote/assets/img/Beanfactory_structure.9f12af04.jpg" alt="Beanfactory数据结构"></p> <h3 id="preparebeanfactory"><a href="#preparebeanfactory" class="header-anchor">#</a> prepareBeanFactory</h3> <p>此方法负责对BeanFactory进行一些特征的设置工作，&quot;特征&quot;包含这么几个方面:</p> <h4 id="beanexpressionresolver"><a href="#beanexpressionresolver" class="header-anchor">#</a> BeanExpressionResolver</h4> <p>此接口只有一个实现: StandardBeanExpressionResolver。接口只含有一个方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">BeanExpressionContext</span> evalContext<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>prepareBeanFactory将一个此对象放入BeanFactory:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanFactory<span class="token punctuation">.</span><span class="token function">setBeanExpressionResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> 						 			<span class="token class-name">StandardBeanExpressionResolver</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>StandardBeanExpressionResolver对象内部有一个关键的成员: SpelExpressionParser,其整个类图:</p> <p><img src="/snote/assets/img/ExpressionParser.2d29901e.jpg" alt="ExpressionParser继承体系"></p> <p>这便是Spring3.0开始出现的Spel表达式的解释器。</p> <h4 id="propertyeditorregistrar"><a href="#propertyeditorregistrar" class="header-anchor">#</a> PropertyEditorRegistrar</h4> <p>此接口用于向Spring注册java.beans.PropertyEditor，只有一个方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">registerCustomEditors</span><span class="token punctuation">(</span><span class="token class-name">PropertyEditorRegistry</span> registry<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>实现也只有一个: ResourceEditorRegistrar。</p> <p>在编写xml配置时，我们设置的值都是字符串形式，所以在使用时肯定需要转为我们需要的类型，PropertyEditor接口正是定义了这么个东西。</p> <p>prepareBeanFactory:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanFactory<span class="token punctuation">.</span><span class="token function">addPropertyEditorRegistrar</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEditorRegistrar</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>BeanFactory也暴露了registerCustomEditors方法用以添加自定义的转换器，所以这个地方是组合模式的体现。</p> <p>我们有两种方式可以添加自定义PropertyEditor:</p> <ul><li><p>通过<code>context.getBeanFactory().registerCustomEditor</code></p></li> <li><p>通过Spring配置文件:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.beans.factory.config.CustomEditorConfigurer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customEditors<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.Cat<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.CatEditor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p>参考: <a href="http://blog.csdn.net/zhoudaxia/article/details/36247883" target="_blank" rel="noopener noreferrer">深入理解JavaBean(2)：属性编辑器PropertyEditor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="环境注入"><a href="#环境注入" class="header-anchor">#</a> 环境注入</h4> <p>在Spring中我们自己的bean可以通过实现EnvironmentAware等一系列Aware接口获取到Spring内部的一些对象。prepareBeanFactory:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ApplicationContextAwareProcessor核心的invokeAwareInterfaces方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeAwareInterfaces</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">Aware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">EnvironmentAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EnvironmentAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">EmbeddedValueResolverAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedValueResolverAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embeddedValueResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//....</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="依赖解析忽略"><a href="#依赖解析忽略" class="header-anchor">#</a> 依赖解析忽略</h4> <p>此部分设置哪些接口在进行依赖注入的时候应该被忽略:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoaderAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisherAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">MessageSourceAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">EnvironmentAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="bean伪装"><a href="#bean伪装" class="header-anchor">#</a> bean伪装</h4> <p>有些对象并不在BeanFactory中，但是我们依然想让它们可以被装配，这就需要伪装一下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisher</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>伪装关系保存在一个Map&lt;Class&lt;?&gt;, Object&gt;里。</p> <h4 id="loadtimeweaver"><a href="#loadtimeweaver" class="header-anchor">#</a> LoadTimeWeaver</h4> <p>如果配置了此bean，那么：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span>LOAD_TIME_WEAVER_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoadTimeWeaverAwareProcessor</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set a temporary ClassLoader for type matching.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">setTempClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextTypeMatchClassLoader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个东西具体是干什么的在后面context:load-time-weaver中说明。</p> <h4 id="注册环境"><a href="#注册环境" class="header-anchor">#</a> 注册环境</h4> <p>源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span>ENVIRONMENT_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span>ENVIRONMENT_BEAN_NAME<span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span>SYSTEM_PROPERTIES_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span>SYSTEM_PROPERTIES_BEAN_NAME<span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSystemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span>SYSTEM_ENVIRONMENT_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span>SYSTEM_ENVIRONMENT_BEAN_NAME<span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">getSystemEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>containsLocalBean特殊之处在于不会去父BeanFactory寻找。</p> <h3 id="postprocessbeanfactory"><a href="#postprocessbeanfactory" class="header-anchor">#</a> postProcessBeanFactory</h3> <p>此方法允许子类在所有的bean尚未初始化之前注册BeanPostProcessor。空实现且没有子类覆盖。</p> <h3 id="invokebeanfactorypostprocessors"><a href="#invokebeanfactorypostprocessors" class="header-anchor">#</a> invokeBeanFactoryPostProcessors</h3> <p>BeanFactoryPostProcessor接口允许我们在bean正是初始化之前改变其值。此接口只有一个方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有两种方式可以向Spring添加此对象:</p> <ul><li><p>通过代码的方式:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>context<span class="token punctuation">.</span>addBeanFactoryPostProcessor
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>通过xml配置的方式:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.SimpleBeanFactoryPostProcessor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>注意此时尚未进行bean的初始化工作，初始化是在后面的finishBeanFactoryInitialization进行的，所以在BeanFactoryPostProcessor对象中获取bean会导致提前初始化。</p> <p>此方法的关键源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">PostProcessorRegistrationDelegate</span><span class="token punctuation">.</span><span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">,</span>
        <span class="token function">getBeanFactoryPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>getBeanFactoryPostProcessors获取的就是AbstractApplicationContext的成员beanFactoryPostProcessors(ArrayList)，但是很有意思，<strong>只有通过context.addBeanFactoryPostProcessor这种方式添加的才会出现在这个List里，所以对于xml配置方式，此List其实没有任何元素。玄机就在PostProcessorRegistrationDelegate里</strong>。</p> <p>核心思想就是使用BeanFactory的getBeanNamesForType方法获取相应的BeanDefinition的name数组，之后逐一调用getBean方法获取到bean(初始化)，getBean方法后面再说。</p> <p>注意此处有一个优先级的概念，如果你的BeanFactoryPostProcessor同时实现了Ordered或者是PriorityOrdered接口，那么会被首先执行。</p> <h3 id="beanpostprocessor注册"><a href="#beanpostprocessor注册" class="header-anchor">#</a> BeanPostProcessor注册</h3> <p>此部分实质上是在BeanDefinitions中寻找BeanPostProcessor，之后调用BeanFactory.addBeanPostProcessor方法保存在一个List中，注意添加时仍然有优先级的概念，优先级高的在前面。</p> <h3 id="messagesource"><a href="#messagesource" class="header-anchor">#</a> MessageSource</h3> <p>此接口用以支持Spring国际化。继承体系如下:</p> <p><img src="/snote/assets/img/MessageSource.40e91f90.jpg" alt="MessageSource继承体系"></p> <p>AbstractApplicationContext的initMessageSource()方法就是在BeanFactory中查找MessageSource的bean，如果配置了此bean，那么调用getBean方法完成其初始化并将其保存在AbstractApplicationContext内部messageSource成员变量中，用以处理ApplicationContext的getMessage调用，因为从继承体系上来看，ApplicationContext是MessageSource的子类，此处是委托模式的体现。如果没有配置此bean，那么初始化一个DelegatingMessageSource对象，此类是一个空实现，同样用以处理getMessage调用请求。</p> <p>参考: <a href="http://stamen.iteye.com/blog/1541732" target="_blank" rel="noopener noreferrer">学习Spring必学的Java基础知识(8)----国际化信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="事件驱动"><a href="#事件驱动" class="header-anchor">#</a> 事件驱动</h3> <p>此接口代表了Spring的事件驱动(监听器)模式。一个事件驱动包含三部分:</p> <h4 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h4> <p>java的所有事件对象一般都是java.util.EventObject的子类，Spring的整个继承体系如下:</p> <p><img src="/snote/assets/img/EventObject.9a575205.jpg" alt="EventObject继承体系"></p> <h4 id="发布者"><a href="#发布者" class="header-anchor">#</a> 发布者</h4> <h5 id="applicationeventpublisher"><a href="#applicationeventpublisher" class="header-anchor">#</a> ApplicationEventPublisher</h5> <p><img src="/snote/assets/img/ApplicationEventPublisher.93d22995.jpg" alt="ApplicationEventPublisher继承体系"></p> <p>一目了然。</p> <h5 id="applicationeventmulticaster"><a href="#applicationeventmulticaster" class="header-anchor">#</a> ApplicationEventMulticaster</h5> <p>ApplicationEventPublisher实际上正是将请求委托给ApplicationEventMulticaster来实现的。其继承体系:</p> <p><img src="/snote/assets/img/ApplicationEventMulticaster.43c483d6.jpg" alt="ApplicationEventMulticaster继承体系"></p> <h4 id="监听器"><a href="#监听器" class="header-anchor">#</a> 监听器</h4> <p>所有的监听器是jdk EventListener的子类，这是一个mark接口。继承体系:</p> <p><img src="/snote/assets/img/EventListener.a466dc6c.jpg" alt="EventListener继承体系"></p> <p>可以看出SmartApplicationListener和GenericApplicationListener是高度相似的，都提供了事件类型检测和顺序机制，而后者是从Spring4.2加入的，Spring官方文档推荐使用后者代替前者。</p> <h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <p>前面说过ApplicationEventPublisher是通过委托给ApplicationEventMulticaster实现的，所以refresh方法中完成的是对ApplicationEventMulticaster的初始化:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Initialize event multicaster for this context.</span>
<span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>initApplicationEventMulticaster则首先在BeanFactory中寻找ApplicationEventMulticaster的bean，如果找到，那么调用getBean方法将其初始化，如果找不到那么使用SimpleApplicationEventMulticaster。</p> <h4 id="事件发布"><a href="#事件发布" class="header-anchor">#</a> 事件发布</h4> <p>AbstractApplicationContext.publishEvent核心代码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">,</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multicastEvent</span><span class="token punctuation">(</span>applicationEvent<span class="token punctuation">,</span> eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>SimpleApplicationEventMulticaster.multicastEvent:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">,</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResolvableType</span> type <span class="token operator">=</span> <span class="token punctuation">(</span>eventType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> eventType <span class="token operator">:</span> <span class="token function">resolveDefaultEventType</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener <span class="token operator">:</span> <span class="token function">getApplicationListeners</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Executor</span> executor <span class="token operator">=</span> <span class="token function">getTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="监听器获取"><a href="#监听器获取" class="header-anchor">#</a> 监听器获取</h5> <p>获取当然还是通过beanFactory的getBean来完成的，值得注意的是Spring在此处使用了缓存(ConcurrentHashMap)来加速查找的过程。</p> <h5 id="同步-异步"><a href="#同步-异步" class="header-anchor">#</a> 同步/异步</h5> <p>可以看出，如果executor不为空，那么监听器的执行实际上是异步的。那么如何配置同步/异步呢?</p> <h6 id="全局"><a href="#全局" class="header-anchor">#</a> 全局</h6> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>executor</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multicasterExecutor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.context.event.SimpleApplicationEventMulticaster<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>taskExecutor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multicasterExecutor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>task schema是Spring从3.0开始加入的，使我们可以不再依赖于Quartz实现定时任务，源码在org.springframework.core.task包下，使用需要引入schema：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
xsi:schemaLocation=&quot;http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.0.xsd&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以参考: <a href="http://gong1208.iteye.com/blog/1773177" target="_blank" rel="noopener noreferrer">Spring定时任务的几种实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h6 id="注解"><a href="#注解" class="header-anchor">#</a> 注解</h6> <p>开启注解支持:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 开启@AspectJ AOP代理 --&gt;</span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span> <span class="token attr-name">proxy-target-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
<span class="token comment">&lt;!-- 任务调度器 --&gt;</span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>scheduler</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scheduler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
<span class="token comment">&lt;!-- 任务执行器 --&gt;</span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>executor</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>executor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
<span class="token comment">&lt;!--开启注解调度支持 @Async @Scheduled--&gt;</span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>annotation-driven</span> <span class="token attr-name">executor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>executor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scheduler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scheduler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">proxy-target-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在代码中使用示例:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailRegisterListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegisterEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@Async</span>  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RegisterEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;注册成功，发送确认邮件给：&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>event<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参考: <a href="http://jinnianshilongnian.iteye.com/blog/1902886" target="_blank" rel="noopener noreferrer">详解Spring事件驱动模型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="onrefresh"><a href="#onrefresh" class="header-anchor">#</a> onRefresh</h3> <p>这又是一个模版方法，允许子类在进行bean初始化之前进行一些定制操作。默认空实现。</p> <h3 id="applicationlistener注册"><a href="#applicationlistener注册" class="header-anchor">#</a> ApplicationListener注册</h3> <p>registerListeners方法干的，没什么好说的。</p> <h3 id="singleton初始化"><a href="#singleton初始化" class="header-anchor">#</a> singleton初始化</h3> <p>finishBeanFactoryInitialization：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span>CONVERSION_SERVICE_BEAN_NAME<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            beanFactory<span class="token punctuation">.</span><span class="token function">isTypeMatch</span><span class="token punctuation">(</span>CONVERSION_SERVICE_BEAN_NAME<span class="token punctuation">,</span> <span class="token class-name">ConversionService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">setConversionService</span><span class="token punctuation">(</span>
                beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>CONVERSION_SERVICE_BEAN_NAME<span class="token punctuation">,</span> <span class="token class-name">ConversionService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">hasEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">addEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringValueResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resolveStringValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> strVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolvePlaceholders</span><span class="token punctuation">(</span>strVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> weaverAwareNames <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span>getBeanNamesForType
        <span class="token punctuation">(</span><span class="token class-name">LoadTimeWeaverAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> weaverAwareName <span class="token operator">:</span> weaverAwareNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getBean</span><span class="token punctuation">(</span>weaverAwareName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Allow for caching all bean definition metadata, not expecting further changes.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">freezeConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Instantiate all remaining (non-lazy-init) singletons.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">preInstantiateSingletons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>分部分说明。</p> <h4 id="conversionservice"><a href="#conversionservice" class="header-anchor">#</a> ConversionService</h4> <p>此接口用于类型之间的转换，在Spring里其实就是把配置文件中的String转为其它类型，从3.0开始出现，目的和jdk的PropertyEditor接口是一样的，参考ConfigurableBeanFactory.setConversionService注释:</p> <blockquote><blockquote><p>Specify a Spring 3.0 ConversionService to use for converting<br>
property values, as an alternative to JavaBeans PropertyEditors.<br>
@since 3.0</p></blockquote></blockquote> <h4 id="stringvalueresolver"><a href="#stringvalueresolver" class="header-anchor">#</a> StringValueResolver</h4> <p>用于解析注解的值。接口只定义了一个方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token function">resolveStringValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> strVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="loadtimeweaveraware"><a href="#loadtimeweaveraware" class="header-anchor">#</a> LoadTimeWeaverAware</h4> <p>实现了此接口的bean可以得到LoadTimeWeaver，此处仅仅初始化。</p> <h4 id="初始化-2"><a href="#初始化-2" class="header-anchor">#</a> 初始化</h4> <p>DefaultListableBeanFactory.preInstantiateSingletons:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preInstantiateSingletons</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> beanNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> beanNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RootBeanDefinition</span> bd <span class="token operator">=</span> <span class="token function">getMergedLocalBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bd<span class="token punctuation">.</span><span class="token function">isAbstract</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> bd<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bd<span class="token punctuation">.</span><span class="token function">isLazyInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFactoryBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token function">getBean</span><span class="token punctuation">(</span>FACTORY_BEAN_PREFIX 
                    <span class="token operator">+</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> isEagerInit<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> factory <span class="token keyword">instanceof</span> <span class="token class-name">SmartFactoryBean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    isEagerInit <span class="token operator">=</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SmartFactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> factory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEagerInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    isEagerInit <span class="token operator">=</span> <span class="token punctuation">(</span>factory <span class="token keyword">instanceof</span> <span class="token class-name">SmartFactoryBean</span> <span class="token operator">&amp;&amp;</span>
                            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SmartFactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> factory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEagerInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isEagerInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Trigger post-initialization callback for all applicable beans...</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> beanNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> singletonInstance <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonInstance <span class="token keyword">instanceof</span> <span class="token class-name">SmartInitializingSingleton</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">SmartInitializingSingleton</span> smartSingleton <span class="token operator">=</span> 
                <span class="token punctuation">(</span><span class="token class-name">SmartInitializingSingleton</span><span class="token punctuation">)</span> singletonInstance<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        smartSingleton<span class="token punctuation">.</span><span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                smartSingleton<span class="token punctuation">.</span><span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>首先进行Singleton的初始化，其中如果bean是FactoryBean类型(注意，只定义了factory-method属性的普通bean并不是FactoryBean)，并且还是SmartFactoryBean类型，那么需要判断是否需要eagerInit(isEagerInit是此接口定义的方法)。</p> <h1 id="getbean"><a href="#getbean" class="header-anchor">#</a> getBean</h1> <p>这里便是bean初始化的核心逻辑。源码比较复杂，分开说。以getBean(String name)为例。AbstractBeanFactory.getBean:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">doGetBean</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第二个参数表示bean的Class类型，第三个表示创建bean需要的参数，最后一个表示不需要进行类型检查。</p> <h2 id="beanname转化"><a href="#beanname转化" class="header-anchor">#</a> beanName转化</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">String</span> beanName <span class="token operator">=</span> <span class="token function">transformedBeanName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里是将FactoryBean的前缀去掉以及将别名转为真实的名字。</p> <h2 id="手动注册bean检测"><a href="#手动注册bean检测" class="header-anchor">#</a> 手动注册bean检测</h2> <p>前面注册环境一节说过，Spring其实手动注册了一些单例bean。这一步就是检测是不是这些bean。如果是，那么再检测是不是工厂bean，如果是返回其工厂方法返回的实例，如果不是返回bean本身。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> sharedInstance <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>sharedInstance <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> args <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bean <span class="token operator">=</span> <span class="token function">getObjectForBeanInstance</span><span class="token punctuation">(</span>sharedInstance<span class="token punctuation">,</span> name<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="检查父容器"><a href="#检查父容器" class="header-anchor">#</a> 检查父容器</h2> <p>如果父容器存在并且存在此bean定义，那么交由其父容器初始化:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">BeanFactory</span> parentBeanFactory <span class="token operator">=</span> <span class="token function">getParentBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>parentBeanFactory <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Not found -&gt; check parent.</span>
    <span class="token comment">//此方法其实是做了前面beanName转化的逆操作，因为父容器同样会进行转化操作</span>
    <span class="token class-name">String</span> nameToLookup <span class="token operator">=</span> <span class="token function">originalBeanName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Delegation to parent with explicit args.</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> parentBeanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>nameToLookup<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// No args -&gt; delegate to standard getBean method.</span>
        <span class="token keyword">return</span> parentBeanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>nameToLookup<span class="token punctuation">,</span> requiredType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="依赖初始化"><a href="#依赖初始化" class="header-anchor">#</a> 依赖初始化</h2> <p>bean可以由depends-on属性配置依赖的bean。Spring会首先初始化依赖的bean。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dependsOn <span class="token operator">=</span> mbd<span class="token punctuation">.</span><span class="token function">getDependsOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>dependsOn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> dependsOnBean <span class="token operator">:</span> dependsOn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">//检测是否存在循环依赖</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDependent</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> dependsOnBean<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span>
            <span class="token string">&quot;Circular depends-on relationship between '&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;' and '&quot;</span> <span class="token operator">+</span> dependsOnBean <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">registerDependentBean</span><span class="token punctuation">(</span>dependsOnBean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getBean</span><span class="token punctuation">(</span>dependsOnBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>registerDependentBean进行了依赖关系的注册，这么做的原因是Spring在即进行bean销毁的时候会首先销毁被依赖的bean。依赖关系的保存是通过一个ConcurrentHashMap&lt;String, Set<String>&gt;完成的，key是bean的真实名字。</String></p> <h2 id="singleton初始化-2"><a href="#singleton初始化-2" class="header-anchor">#</a> Singleton初始化</h2> <p>虽然这里大纲是Singleton初始化，但是getBean方法本身是包括所有scope的初始化，在这里一次说明了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sharedInstance <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">createBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bean <span class="token operator">=</span> <span class="token function">getObjectForBeanInstance</span><span class="token punctuation">(</span>sharedInstance<span class="token punctuation">,</span> name<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="getsingleton方法"><a href="#getsingleton方法" class="header-anchor">#</a> getSingleton方法</h3> <h4 id="是否存在"><a href="#是否存在" class="header-anchor">#</a> 是否存在</h4> <p>首先会检测是否已经存在，如果存在，直接返回:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>所有的单例bean都保存在这样的数据结构中: <code>ConcurrentHashMap&lt;String, Object&gt;</code>。</p> <h4 id="bean创建"><a href="#bean创建" class="header-anchor">#</a> bean创建</h4> <p>源码位于AbstractAutowireCapableBeanFactory.createBean，主要分为几个部分:</p> <h5 id="lookup-method检测"><a href="#lookup-method检测" class="header-anchor">#</a> lookup-method检测</h5> <p>此部分用于检测lookup-method标签配置的方法是否存在:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">RootBeanDefinition</span> mbdToUse <span class="token operator">=</span> mbd<span class="token punctuation">;</span>
mbdToUse<span class="token punctuation">.</span><span class="token function">prepareMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>prepareMethodOverrides:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepareMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionValidationException</span> <span class="token punctuation">{</span>
    <span class="token comment">// Check that lookup methods exists.</span>
    <span class="token class-name">MethodOverrides</span> methodOverrides <span class="token operator">=</span> <span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>methodOverrides<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MethodOverride</span><span class="token punctuation">&gt;</span></span> overrides <span class="token operator">=</span> methodOverrides<span class="token punctuation">.</span><span class="token function">getOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>overrides<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MethodOverride</span> mo <span class="token operator">:</span> overrides<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">prepareMethodOverride</span><span class="token punctuation">(</span>mo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>prepareMethodOverride:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">prepareMethodOverride</span><span class="token punctuation">(</span><span class="token class-name">MethodOverride</span> mo<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getMethodCountForName</span><span class="token punctuation">(</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mo<span class="token punctuation">.</span><span class="token function">getMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionValidationException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Invalid method override: no method with name '&quot;</span> <span class="token operator">+</span> mo<span class="token punctuation">.</span><span class="token function">getMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token string">&quot;' on class [&quot;</span> <span class="token operator">+</span> <span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Mark override as not overloaded, to avoid the overhead of arg type checking.</span>
        mo<span class="token punctuation">.</span><span class="token function">setOverloaded</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="instantiationawarebeanpostprocessor触发"><a href="#instantiationawarebeanpostprocessor触发" class="header-anchor">#</a> InstantiationAwareBeanPostProcessor触发</h5> <p>在这里触发的是其postProcessBeforeInitialization和postProcessAfterInstantiation方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">resolveBeforeInstantiation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbdToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Object</span> beanInstance <span class="token operator">=</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbdToUse<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> beanInstance<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>继续:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">resolveBeforeInstantiation</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span>FALSE<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mbd<span class="token punctuation">.</span>beforeInstantiationResolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Make sure bean class is actually resolved at this point.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasInstantiationAwareBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetType <span class="token operator">=</span> <span class="token function">determineTargetType</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>targetType <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsBeforeInstantiation</span><span class="token punctuation">(</span>targetType<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    bean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        mbd<span class="token punctuation">.</span>beforeInstantiationResolved <span class="token operator">=</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>从这里可以看出，<strong>如果InstantiationAwareBeanPostProcessor返回的不是空，那么将不会继续执行剩下的Spring初始化流程，此接口用于初始化自定义的bean，主要是在Spring内部使用</strong>。</p> <h5 id="docreatebean"><a href="#docreatebean" class="header-anchor">#</a> doCreateBean</h5> <p>同样分为几部分。</p> <h6 id="创建-createbeaninstance"><a href="#创建-createbeaninstance" class="header-anchor">#</a> 创建(createBeanInstance)</h6> <p>关键代码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">BeanWrapper</span> instanceWrapper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>instanceWrapper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instanceWrapper <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>createBeanInstance的创建过程又分为以下几种情况:</p> <ul><li><p>工厂bean:</p> <p>调用instantiateUsingFactoryMethod方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">BeanWrapper</span> <span class="token function">instantiateUsingFactoryMethod</span><span class="token punctuation">(</span>
  <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> explicitArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConstructorResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiateUsingFactoryMethod</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> explicitArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意，此处的工厂bean指的是配置了factory-bean/factory-method属性的bean，不是实现了FacrotyBean接口的bean。如果没有配置factory-bean属性，那么factory-method指向的方法必须是静态的。此方法主要做了这么几件事:</p> <ul><li><p>初始化一个BeanWrapperImpl对象。</p></li> <li><p>根据设置的参数列表使用反射的方法寻找相应的方法对象。</p></li> <li><p>InstantiationStrategy:</p> <p>bean的初始化在此处又抽成了策略模式，类图:</p> <p><img src="/snote/assets/img/InstantiationStrategy.d00f202f.jpg" alt="InstantiationStrategy类图"></p> <p>instantiateUsingFactoryMethod部分源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>beanInstance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">getInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>
    mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">,</span> factoryBean<span class="token punctuation">,</span> factoryMethodToUse<span class="token punctuation">,</span> argsToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>getInstantiationStrategy返回的是CglibSubclassingInstantiationStrategy对象。此处instantiate实现也很简单，就是调用工厂方法的Method对象反射调用其invoke即可得到对象，SimpleInstantiationStrategy.</p> <p>instantiate核心源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> bd<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanFactory</span> owner<span class="token punctuation">,</span>
    <span class="token class-name">Object</span> factoryBean<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Method</span> factoryMethod<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factoryMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>factoryBean<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li> <li><p>构造器自动装配</p> <p>createBeanInstance部分源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Need to determine the constructor...</span>
<span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctors <span class="token operator">=</span> <span class="token function">determineConstructorsFromBeanPostProcessors</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ctors <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span>
  mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">.</span>AUTOWIRE_CONSTRUCTOR <span class="token operator">||</span>
    <span class="token comment">//配置了&lt;constructor-arg&gt;子元素</span>
  mbd<span class="token punctuation">.</span><span class="token function">hasConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">autowireConstructor</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> ctors<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>determineConstructorsFromBeanPostProcessors源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">determineConstructorsFromBeanPostProcessors</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>beanClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasInstantiationAwareBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> bp <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bp <span class="token keyword">instanceof</span> <span class="token class-name">SmartInstantiationAwareBeanPostProcessor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token class-name">SmartInstantiationAwareBeanPostProcessor</span> ibp <span class="token operator">=</span> 
                  <span class="token punctuation">(</span><span class="token class-name">SmartInstantiationAwareBeanPostProcessor</span><span class="token punctuation">)</span> bp<span class="token punctuation">;</span>
              <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctors <span class="token operator">=</span> ibp<span class="token punctuation">.</span><span class="token function">determineCandidateConstructors</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>ctors <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> ctors<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>可见是由SmartInstantiationAwareBeanPostProcessor决定的，默认是没有配置这种东西的。</p> <p>之后就是判断bean的自动装配模式，可以通过如下方式配置:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>student<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.Student<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>autowire共有以下几种选项:</p> <ul><li>no: 默认的，不进行自动装配。在这种情况下，只能通过ref方式引用其它bean。</li> <li>byName: 根据bean里面属性的名字在BeanFactory中进行查找并装配。</li> <li>byType: 按类型。</li> <li>constructor: 以byType的方式查找bean的构造参数列表。</li> <li>default: 由父bean决定。</li></ul> <p>参考: <a href="http://www.cnblogs.com/ViviChan/p/4981539.html" target="_blank" rel="noopener noreferrer">Spring - bean的autowire属性(自动装配)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>autowireConstructor调用的是ConstructorResolver.autowireConstructor，此方法主要做了两件事:</p> <ul><li><p>得到合适的构造器对象。</p></li> <li><p>根据构造器参数的类型去BeanFactory查找相应的bean:</p> <p>入口方法在ConstructorResolver.resolveAutowiredArgument:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">resolveAutowiredArgument</span><span class="token punctuation">(</span>
        <span class="token class-name">MethodParameter</span> param<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> autowiredBeanNames<span class="token punctuation">,</span> 
        <span class="token class-name">TypeConverter</span> typeConverter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">resolveDependency</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">DependencyDescriptor</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> 
            autowiredBeanNames<span class="token punctuation">,</span> typeConverter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p>最终调用的还是CglibSubclassingInstantiationStrategy.instantiate方法，关键源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> bd<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanFactory</span> owner<span class="token punctuation">,</span>
      <span class="token keyword">final</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> ctor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>bd<span class="token punctuation">.</span><span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//反射调用</span>
      <span class="token keyword">return</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>ctor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">instantiateWithMethodInjection</span><span class="token punctuation">(</span>bd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> owner<span class="token punctuation">,</span> ctor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看出，如果配置了lookup-method标签，<strong>得到的实际上是用Cglib生成的目标类的代理子类</strong>。</p> <p>CglibSubclassingInstantiationStrategy.instantiateWithMethodInjection:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">instantiateWithMethodInjection</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> bd<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanFactory</span> 	owner<span class="token punctuation">,</span><span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> ctor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Must generate CGLIB subclass...</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CglibSubclassCreator</span><span class="token punctuation">(</span>bd<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>ctor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>默认构造器</p> <p>一行代码，很简单:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// No special handling: simply use no-arg constructor.</span>
<span class="token keyword">return</span> <span class="token function">instantiateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h6 id="mergedbeandefinitionpostprocessor"><a href="#mergedbeandefinitionpostprocessor" class="header-anchor">#</a> MergedBeanDefinitionPostProcessor</h6> <p>触发源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span>postProcessingLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mbd<span class="token punctuation">.</span>postProcessed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">applyMergedBeanDefinitionPostProcessors</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mbd<span class="token punctuation">.</span>postProcessed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>此接口也是Spring内部使用的，不管它了。</p> <h6 id="属性解析"><a href="#属性解析" class="header-anchor">#</a> 属性解析</h6> <p>入口方法: AbstractAutowireCapableBeanFactory.populateBean，它的作用是: 根据autowire类型进行autowire by name，by type 或者是直接进行设置，简略后的源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">populateBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//所有&lt;property&gt;的值</span>
    <span class="token class-name">PropertyValues</span> pvs <span class="token operator">=</span> mbd<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">.</span>AUTOWIRE_BY_NAME <span class="token operator">||</span>
            mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">.</span>AUTOWIRE_BY_TYPE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MutablePropertyValues</span> newPvs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">(</span>pvs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Add property values based on autowire by name if applicable.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">.</span>AUTOWIRE_BY_NAME<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">autowireByName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> newPvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Add property values based on autowire by type if applicable.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">.</span>AUTOWIRE_BY_TYPE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">autowireByType</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> newPvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        pvs <span class="token operator">=</span> newPvs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//设值</span>
    <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> pvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>autowireByName源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">autowireByName</span><span class="token punctuation">(</span>
        <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">AbstractBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">,</span> <span class="token class-name">MutablePropertyValues</span> pvs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//返回所有引用(ref=&quot;XXX&quot;)的bean名称</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyNames <span class="token operator">=</span> <span class="token function">unsatisfiedNonSimpleProperties</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> bw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> propertyName <span class="token operator">:</span> propertyNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">containsBean</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">//从BeanFactory获取</span>
            <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">getBean</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pvs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">registerDependentBean</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>autowireByType也是同样的套路，所以可以得出结论: <strong>autowireByName和autowireByType方法只是先获取到引用的bean，真正的设值是在applyPropertyValues中进行的。</strong></p> <h6 id="属性设置"><a href="#属性设置" class="header-anchor">#</a> 属性设置</h6> <p>Spring判断一个属性可不可以被设置(存不存在)是通过java bean的内省操作来完成的，也就是说，属性可以被设置的条件是<strong>此属性拥有public的setter方法，并且注入时的属性名应该是setter的名字</strong>。</p> <h6 id="初始化-3"><a href="#初始化-3" class="header-anchor">#</a> 初始化</h6> <p>此处的初始化指的是bean已经构造完成，执行诸如调用其init方法的操作。相关源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Initialize the bean instance.</span>
<span class="token class-name">Object</span> exposedObject <span class="token operator">=</span> bean<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">populateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> instanceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exposedObject <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exposedObject <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> exposedObject<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>initializeBean:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Object</span> wrappedBean <span class="token operator">=</span> bean<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span>wrappedBean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> wrappedBean<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>wrappedBean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> wrappedBean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>主要的操作步骤一目了然。</p> <ul><li><p>Aware方法触发:</p> <p>我们的bean有可能实现了一些XXXAware接口，此处就是负责调用它们:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">Aware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanNameAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanNameAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanFactoryAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>BeanPostProcessor触发，没什么好说的</p></li> <li><p>调用init方法:</p> <p>在XML配置中，bean可以有一个init-method属性来指定初始化时调用的方法。从原理来说，其实就是一个反射调用。不过注意这里有一个InitializingBean的概念。</p> <p>此接口只有一个方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果我们的bean实现了此接口，那么此方法会首先被调用。此接口的意义在于: 当此bean的所有属性都被设置(注入)后，给bean一个利用现有属性重新组织或是检查属性的机会。感觉和init方法有些冲突，不过此接口在Spring被广泛使用。</p></li></ul> <h3 id="getobjectforbeaninstance"><a href="#getobjectforbeaninstance" class="header-anchor">#</a> getObjectForBeanInstance</h3> <p>位于AbstractBeanFactory，此方法的目的在于如果bean是FactoryBean，那么返回其工厂方法创建的bean，而不是自身。</p> <h2 id="prototype初始化"><a href="#prototype初始化" class="header-anchor">#</a> Prototype初始化</h2> <p>AbstractBeanFactory.doGetBean相关源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">isPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// It's a prototype -&gt; create a new instance.</span>
    <span class="token class-name">Object</span> prototypeInstance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">beforePrototypeCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        prototypeInstance <span class="token operator">=</span> <span class="token function">createBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">afterPrototypeCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    bean <span class="token operator">=</span> <span class="token function">getObjectForBeanInstance</span><span class="token punctuation">(</span>prototypeInstance<span class="token punctuation">,</span> name<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="beforeprototypecreation"><a href="#beforeprototypecreation" class="header-anchor">#</a> beforePrototypeCreation</h3> <p>此方法用于确保在同一时刻只能有一个此bean在初始化。</p> <h3 id="createbean"><a href="#createbean" class="header-anchor">#</a> createBean</h3> <p>和单例的是一样的，不在赘述。</p> <h3 id="afterprototypecreation"><a href="#afterprototypecreation" class="header-anchor">#</a> afterPrototypeCreation</h3> <p>和beforePrototypeCreation对应的，你懂的。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>可以看出，初始化其实和单例是一样的，只不过单例多了一个是否已经存在的检查。</p> <h2 id="其它scope初始化"><a href="#其它scope初始化" class="header-anchor">#</a> 其它Scope初始化</h2> <p>其它就指的是request、session。此部分源码:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> scopeName <span class="token operator">=</span> mbd<span class="token punctuation">.</span><span class="token function">getScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Scope</span> scope <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scopes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>scopeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scope <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;No Scope registered for scope name '&quot;</span> <span class="token operator">+</span> scopeName <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Object</span> scopedInstance <span class="token operator">=</span> scope<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
            <span class="token function">beforePrototypeCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">createBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token function">afterPrototypeCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bean <span class="token operator">=</span> <span class="token function">getObjectForBeanInstance</span><span class="token punctuation">(</span>scopedInstance<span class="token punctuation">,</span> name<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>scopes是一个LinkedHashMap&lt;String, Scope&gt;，可以调用 ConfigurableBeanFactory定义的registerScope方法注册其值。</p> <p>Scope接口继承体系:</p> <p><img src="/snote/assets/img/Scope.21c3d20f.jpg" alt="Scope继承体系"></p> <p>根据socpe.get的注释，此方法如果找到了叫做beanName的bean，那么返回，如果没有，将调用ObjectFactory创建之。Scope的实现参考类图。</p> <h1 id="四、循环依赖"><a href="#四、循环依赖" class="header-anchor">#</a> 四、循环依赖</h1> <blockquote><p><a href="https://blog.csdn.net/java_lyvee/article/details/101793774" target="_blank" rel="noopener noreferrer">spring源码系列（一）——spring循环引用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>singletonsCurrentlyInCreation


AbstractBeanFactory.doGetBean -&gt;
DefaultSingletonBeanRegistry.getSingleton -&gt; 
DefaultSingletonBeanRegistry.beforeSingletonCreation -&gt;
AbstractAutowireCapableBeanFactory.doCreateBean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>
// AbstractBeanFactory
protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType,
    @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException {
  // 尝试通过bean名称获取目标bean对象，比如这里的A对象
  Object sharedInstance = getSingleton(beanName);
  
                // 我们这里的目标对象都是单例的
 				// Create bean instance.
				if (mbd.isSingleton()) {
				    // 这里就尝试创建目标对象，第二个参数传的就是一个ObjectFactory类型的对象，这里是使用Java8的lamada
                    // 表达式书写的，只要上面的getSingleton()方法返回值为空，则会调用这里的getSingleton()方法来创建
                    // 目标对象
					sharedInstance = getSingleton(beanName, () -&gt; {
						try {
						    // 尝试创建目标对象
							return createBean(beanName, mbd, args);
						}
						catch (BeansException ex) {
							// Explicitly remove instance from singleton cache: It might have been put there
							// eagerly by the creation process, to allow for circular reference resolution.
							// Also remove any beans that received a temporary reference to the bean.
							destroySingleton(beanName);
							throw ex;
						}
					});

				}
  
  
  return (T) bean;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// DefaultSingletonBeanRegistry</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    <span class="token comment">// 放入 singletonsCurrentlyInCreation</span>
			<span class="token function">beforeSingletonCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">// 反射调用构造方法创建对象</span>
			singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token function">afterSingletonCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> allowEarlyReference<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isSingletonCurrentlyInCreation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>earlySingletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> allowEarlyReference<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>singletonFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>earlySingletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>singletonFactories<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> singletonObject<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="五、设计模式"><a href="#五、设计模式" class="header-anchor">#</a> 五、设计模式</h2> <p>策略模式</p> <p>模板方法模式</p> <p>单例模式</p> <p>代理模式</p> <p>观察者模式（事件发布与监听）</p> <p>适配器模式（spring MVC）</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2021-06-11 22:12:01</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_springde-xiang-guan-chou-xiang.html" class="prev">
            Spring的相关抽象
          </a></span> <span class="next"><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_03_rong-qi-de-gong-neng-kuo-zhan.html">
            /cs/backend/spring/spring-core/springyuan-ma-fen-xi_03_rong-qi-de-gong-neng-kuo-zhan.html
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#前言" class="sidebar-link reco-side-前言" data-v-70334359>前言</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#推荐阅读" class="sidebar-link reco-side-推荐阅读" data-v-70334359>推荐阅读</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#一、基本概念" class="sidebar-link reco-side-一、基本概念" data-v-70334359>一、基本概念</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_1-容器相关类图" class="sidebar-link reco-side-_1-容器相关类图" data-v-70334359>1.容器相关类图</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#二、容器的创建过程" class="sidebar-link reco-side-二、容器的创建过程" data-v-70334359>二、容器的创建过程</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_1-流程图" class="sidebar-link reco-side-_1-流程图" data-v-70334359>1.流程图</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_2-时序图" class="sidebar-link reco-side-_2-时序图" data-v-70334359>2.时序图</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_3-具体流程分析" class="sidebar-link reco-side-_3-具体流程分析" data-v-70334359>3.具体流程分析</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#三、refresh" class="sidebar-link reco-side-三、refresh" data-v-70334359>三、refresh</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_1-preparerefresh" class="sidebar-link reco-side-_1-preparerefresh" data-v-70334359>1.prepareRefresh</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#_2-obtainfreshbeanfactory" class="sidebar-link reco-side-_2-obtainfreshbeanfactory" data-v-70334359>2.obtainFreshBeanFactory</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#preparebeanfactory" class="sidebar-link reco-side-preparebeanfactory" data-v-70334359>prepareBeanFactory</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#postprocessbeanfactory" class="sidebar-link reco-side-postprocessbeanfactory" data-v-70334359>postProcessBeanFactory</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#invokebeanfactorypostprocessors" class="sidebar-link reco-side-invokebeanfactorypostprocessors" data-v-70334359>invokeBeanFactoryPostProcessors</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#beanpostprocessor注册" class="sidebar-link reco-side-beanpostprocessor注册" data-v-70334359>BeanPostProcessor注册</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#messagesource" class="sidebar-link reco-side-messagesource" data-v-70334359>MessageSource</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#事件驱动" class="sidebar-link reco-side-事件驱动" data-v-70334359>事件驱动</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#onrefresh" class="sidebar-link reco-side-onrefresh" data-v-70334359>onRefresh</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#applicationlistener注册" class="sidebar-link reco-side-applicationlistener注册" data-v-70334359>ApplicationListener注册</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#singleton初始化" class="sidebar-link reco-side-singleton初始化" data-v-70334359>singleton初始化</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#beanname转化" class="sidebar-link reco-side-beanname转化" data-v-70334359>beanName转化</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#手动注册bean检测" class="sidebar-link reco-side-手动注册bean检测" data-v-70334359>手动注册bean检测</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#检查父容器" class="sidebar-link reco-side-检查父容器" data-v-70334359>检查父容器</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#依赖初始化" class="sidebar-link reco-side-依赖初始化" data-v-70334359>依赖初始化</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#singleton初始化-2" class="sidebar-link reco-side-singleton初始化-2" data-v-70334359>Singleton初始化</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#getsingleton方法" class="sidebar-link reco-side-getsingleton方法" data-v-70334359>getSingleton方法</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#getobjectforbeaninstance" class="sidebar-link reco-side-getobjectforbeaninstance" data-v-70334359>getObjectForBeanInstance</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#prototype初始化" class="sidebar-link reco-side-prototype初始化" data-v-70334359>Prototype初始化</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#beforeprototypecreation" class="sidebar-link reco-side-beforeprototypecreation" data-v-70334359>beforePrototypeCreation</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#createbean" class="sidebar-link reco-side-createbean" data-v-70334359>createBean</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#afterprototypecreation" class="sidebar-link reco-side-afterprototypecreation" data-v-70334359>afterPrototypeCreation</a></li><li class="level-3" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#总结" class="sidebar-link reco-side-总结" data-v-70334359>总结</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#其它scope初始化" class="sidebar-link reco-side-其它scope初始化" data-v-70334359>其它Scope初始化</a></li><li class="level-2" data-v-70334359><a href="/snote/cs/backend/spring/spring-core/springyuan-ma-fen-xi_02_rong-qi-de-ji-ben-shi-xian.html#五、设计模式" class="sidebar-link reco-side-五、设计模式" data-v-70334359>五、设计模式</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 snote
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:50px;bottom:10px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas><!----></div></div>
    <script src="/snote/assets/js/app.3cc04e36.js" defer></script><script src="/snote/assets/js/5.22329d81.js" defer></script><script src="/snote/assets/js/1.5e23c49c.js" defer></script><script src="/snote/assets/js/19.4e10afcb.js" defer></script><script src="/snote/assets/js/77.11cc1a2c.js" defer></script>
  </body>
</html>
