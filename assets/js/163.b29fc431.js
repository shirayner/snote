(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{1144:function(s,a,e){"use strict";e.r(a);var t=e(4),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("[TOC]")]),s._v(" "),e("h1",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("h1",{attrs:{id:"一、redis-sentinel部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、redis-sentinel部署"}},[s._v("#")]),s._v(" 一、Redis Sentinel部署")]),s._v(" "),e("h2",{attrs:{id:"_1-部署redis数据结点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-部署redis数据结点"}},[s._v("#")]),s._v(" 1.部署Redis数据结点")]),s._v(" "),e("h3",{attrs:{id:"_1-1-启动主节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-启动主节点"}},[s._v("#")]),s._v(" 1.1 启动主节点")]),s._v(" "),e("p",[s._v("（1）配置：redis-6379.conf")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("6379")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("daemonize")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("logfile")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./log/6379.log")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbfilename")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("dump-6379.rdb")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./data")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("（2）启动主节点")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./redis-server redis-6379.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("（3）验证主节点是否启动")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v(" ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_1-2-启动两个从节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-启动两个从节点"}},[s._v("#")]),s._v(" 1.2 启动两个从节点")]),s._v(" "),e("p",[s._v("（1）配置")]),s._v(" "),e("p",[s._v("redis-6380.conf")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("6380")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("daemonize")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("logfile")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./log/6380.log")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbfilename")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("dump-6380.rdb")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./data")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("slaveof")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("127.0.0.1 6379")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("从节点 redis-6381.conf 同理")]),s._v(" "),e("p",[s._v("（2）启动从节点")]),s._v(" "),e("p",[s._v("使用如下命令，分别启动 6380、6381从节点")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./redis-server redis-6380.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("（3）验证")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v(" ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_1-3-确认主从关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-确认主从关系"}},[s._v("#")]),s._v(" 1.3 确认主从关系")]),s._v(" "),e("p",[s._v("主节点视角：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("λ ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" info replication\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master\nconnected_slaves:2\nslave0:ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(",state"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1781")]),s._v(",lag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nslave1:ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v(",state"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1781")]),s._v(",lag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmaster_repl_offset:1781\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:2\nrepl_backlog_histlen:1780\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("从节点视角：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("λ ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(" info replication\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:slave\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:2\nmaster_sync_in_progress:0\nslave_repl_offset:1837\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_repl_offset:0\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h2",{attrs:{id:"_2-部署sentinel结点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署sentinel结点"}},[s._v("#")]),s._v(" 2.部署Sentinel结点")]),s._v(" "),e("p",[s._v("（1）配置")]),s._v(" "),e("p",[s._v("3个Sentinel节点的部署方法是完全一致的（端口不同）")]),s._v(" "),e("p",[s._v("redis-sentinel-26379.conf")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("port 26379\ndaemonize yes\nlogfile ./log/26379.log\ndir ./data\nsentinel monitor mymaster 127.0.0.1 6379 2\nsentinel down-after-milliseconds mymaster 30000\nsentinel parallel-syncs mymaster 1\nsentinel failover-timeout mymaster 180000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("blockquote",[e("p",[s._v("配置主节点为 127.0.0.1 6379 ，主节点别名为 mymaster，2代表判断主节点失败至少需要2个Sentinel节点同意")])]),s._v(" "),e("p",[s._v("（2）启动sentinel")]),s._v(" "),e("p",[s._v("使用如下命令，分别启动 26379、26380、26381 sentinel节点")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./redis-server redis-sentinel-26379.conf --sentinel\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("（3）确认")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("λ ./redis-cli -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v(" info Sentinel\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sentinel")]),s._v("\nsentinel_masters:1\nsentinel_tilt:0\nsentinel_running_scripts:0\nsentinel_scripts_queue_length:0\nsentinel_simulate_failure_flags:0\nmaster0:name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mymaster,status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ok,address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379,slaves"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",sentinels"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h1",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")])])}),[],!1,null,null,null);a.default=n.exports}}]);