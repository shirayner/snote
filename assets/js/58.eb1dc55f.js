(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{1420:function(s,e,t){"use strict";t.r(e);var a=t(4),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("[TOC]")]),s._v(" "),a("h1",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[a("strong",[s._v("本系列总结转自"),a("a",{attrs:{href:"https://item.jd.com/11909234.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《第一本Dokcer书》"),a("OutboundLink")],1),s._v("，仅作读书笔记用")])]),s._v(" "),a("h1",{attrs:{id:"一、使用dokcer测试静态网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、使用dokcer测试静态网站"}},[s._v("#")]),s._v(" 一、使用Dokcer测试静态网站")]),s._v(" "),a("p",[s._v("将Docker作为本地Web开发环境是Docker的一个最简单的应用场景。")]),s._v(" "),a("p",[s._v("这样的环境可以完全复制生产环境，并确保用户开发的东西在生产环境中也能运行。下面从将NginxWeb服务器安装到容器来架构一个简单的网站开始。这个网站暂且命名为Sample。")]),s._v(" "),a("h2",{attrs:{id:"_1-sample网站初始的dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-sample网站初始的dockerfile"}},[s._v("#")]),s._v(" 1.sample网站初始的Dockerfile")]),s._v(" "),a("p",[s._v("（1）创建一个工作目录，保存Dockerfile")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" sample\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" sample\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" Dockerfile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("（2）创建 nginx 配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/jamtur01/dockerbook-code/master/code/5/sample/nginx/global.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/jamtur01/dockerbook-code/master/code/5/sample/nginx/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("（3）编写Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("18.04\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"james@example.com"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2014"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("06"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("01\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("qq update && apt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("qq install nginx\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/www/html/website\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" nginx/global.conf /etc/nginx/conf.d/\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" nginx/nginx.conf /etc/nginx/\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"_2-构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建镜像"}},[s._v("#")]),s._v(" 2.构建镜像")]),s._v(" "),a("p",[s._v("构建镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("docker build -t jamtur01/nginx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-从镜像构建容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-从镜像构建容器"}},[s._v("#")]),s._v(" 3.从镜像构建容器")]),s._v(" "),a("p",[s._v("（1）添加sample网站的首页代码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir website && cd website\nwget https://raw.githubusercontent.com/jamtur01/dockerbook-code/master/code/5/sample/website/index.html\ncd ..\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("（2）从镜像运行容器（在cmder中要以powershell.exe运行）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v(":80 --name website -v "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/website:/var/www/html/website jamtur01/nginx nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("ul",[a("li",[a("code",[s._v("-v")]),s._v("这个选项允许我们将宿主机的目录作为卷，挂载到容器里。")]),s._v(" "),a("li",[s._v("在nginx的配置文件中，我们指定了网站的站点目录为 "),a("code",[s._v("/var/www/html/website")]),s._v("，而我们又将宿主机的 "),a("code",[s._v("$PWD/website")]),s._v("目录挂载到了容器中的"),a("code",[s._v("/var/www/html/website")]),s._v("目录，这就实现了容器中的nginx发布本地指定目录作为站点")])])]),s._v(" "),a("p",[s._v("什么是卷:")]),s._v(" "),a("blockquote",[a("p",[s._v("卷在Docker里非常重要，也很有用。卷是在一个或者多个容器内被选定的目录，可以绕过分层的联合文件系统（UnionFileSystem），为Docker提供持久数据或者共享数据。这意味着对卷的修改会直接生效，并绕过镜像。当提交或者创建镜像时，卷不被包含在镜像里。")])]),s._v(" "),a("p",[s._v("卷的作用：")]),s._v(" "),a("blockquote",[a("p",[s._v("当我们因为某些原因不想把应用或者代码构建到镜像中时，就体现出卷的价值了。例如：")]),s._v(" "),a("ul",[a("li",[s._v("希望同时对代码做开发和测试；")]),s._v(" "),a("li",[s._v("代码改动很频繁，不想在开发过程中重构镜像；")]),s._v(" "),a("li",[s._v("希望在多个容器间共享代码。")])])]),s._v(" "),a("p",[s._v("（3）在宿主机访问容器中发布的网站")]),s._v(" "),a("blockquote",[a("p",[s._v("http://localhost:8088/")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(972),alt:"1559201402294"}})]),s._v(" "),a("h2",{attrs:{id:"_4-修改网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改网站"}},[s._v("#")]),s._v(" 4.修改网站")]),s._v(" "),a("p",[s._v("修改网站首页代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vi $PWD/website/index.html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改前首页代码如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(973),alt:"1559201848710"}})]),s._v(" "),a("p",[s._v("修改后：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(974),alt:"1559201880905"}})]),s._v(" "),a("p",[s._v("保存文件后，继续在宿主机访问首页")]),s._v(" "),a("p",[a("img",{attrs:{src:t(975),alt:"1559201909209"}})]),s._v(" "),a("h1",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://item.jd.com/11909234.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《第一本Dokcer书》"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/turnbullpress/dockerbook-code",target:"_blank",rel:"noopener noreferrer"}},[s._v("turnbullpress/dockerbook-code"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/jaywcjlove/linux-command",target:"_blank",rel:"noopener noreferrer"}},[s._v("jaywcjlove/linux-command"),a("OutboundLink")],1)]),s._v(" "),a("li")])])}),[],!1,null,null,null);e.default=n.exports},972:function(s,e,t){s.exports=t.p+"assets/img/1559201402294.f34bb4c9.png"},973:function(s,e,t){s.exports=t.p+"assets/img/1559201848710.4b61dee5.png"},974:function(s,e,t){s.exports=t.p+"assets/img/1559201880905.b3c70112.png"},975:function(s,e,t){s.exports=t.p+"assets/img/1559201909209.87b477ac.png"}}]);