(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{1334:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[TOC]")]),t._v(" "),s("h1",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("在上一节  "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")]),t._v("  中，我们了解了 Spring 声明式缓存抽象，知道了：")],1),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("我们使用Spring声明式缓存，使用的是其抽象，无关底层实现。也就是说，不管你底层使用的是什么缓存技术，对Spring声明式缓存的使用是一致的")]),t._v(" "),s("li",[t._v("若想要采用不同的缓存技术，只需要替换掉底层注册的 CacheManager 即可")])])]),t._v(" "),s("p",[t._v("那么，这一节我们将采用 EhCache 作为缓存技术，来实现一个Spring声明式缓存的实例，这显然就很简单了，步骤如下：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("引入 EhCache 依赖")]),t._v(" "),s("li",[t._v("开启缓存支持")]),t._v(" "),s("li",[t._v("配置ehcache（ehcache.xml）")]),t._v(" "),s("li",[t._v("使用声明式缓存")])])]),t._v(" "),s("p",[t._v("其他步骤同上一步： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h1",{attrs:{id:"一、springboot-整合-ehcache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、springboot-整合-ehcache"}},[t._v("#")]),t._v(" 一、SpringBoot 整合 EhCache")]),t._v(" "),s("h2",{attrs:{id:"_1-创建子模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建子模块"}},[t._v("#")]),t._v(" 1.创建子模块")]),t._v(" "),s("p",[t._v("这里我们创建一个子模块，创建步骤同 "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_01_入门示例.html"}},[t._v("SpringBoot_01_入门示例")])],1),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'com.ray.study'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("artifact")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-ehcache'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h2",{attrs:{id:"_2-引入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-引入依赖"}},[t._v("#")]),t._v(" 2.引入依赖")]),t._v(" "),s("h3",{attrs:{id:"_2-1-继承父工程依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-继承父工程依赖"}},[t._v("#")]),t._v(" 2.1 继承父工程依赖")]),t._v(" "),s("p",[t._v("在父工程"),s("code",[t._v("spring-boot-seeds")]),t._v(" 的 "),s("code",[t._v("settings.gradle")]),t._v("加入子工程")]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rootProject.name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-seeds'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-01-helloworld'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-02-restful-test'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-03-thymeleaf'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-04-swagger2'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-jpa'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-mybatis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-tk-mybatis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-06-nosql-redis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-06-nosql-mongodb'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-concurrentmap'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-ehcache'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v("这样，子工程"),s("code",[t._v("spring-boot-07-cache-ehcache")]),t._v("就会自动继承父工程中"),s("code",[t._v("subprojects")]),t._v(" `函数里声明的依赖，主要包含如下依赖：")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("\t\timplementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-web'")]),t._v("\n        testImplementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-test'")]),t._v("\n\n        compileOnly "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok'")]),t._v("\n        annotationProcessor "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h3",{attrs:{id:"_2-2-引入ehcache-依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-引入ehcache-依赖"}},[t._v("#")]),t._v(" 2.2 引入"),s("code",[t._v("ehcache")]),t._v(" `依赖")]),t._v(" "),s("p",[t._v("将子模块"),s("code",[t._v("spring-boot-07-cache-ehcache")]),t._v(" 的"),s("code",[t._v("build.gradle")]),t._v("修改为如下内容：")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("dependencies "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// spring-boot-starter-cache  和 ehcache")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-cache'")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net.sf.ehcache:ehcache'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mysql 驱动和 jpa")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql:mysql-connector-java'")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-data-jpa'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h2",{attrs:{id:"_3-数据库准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据库准备"}},[t._v("#")]),t._v(" 3.数据库准备")]),t._v(" "),s("p",[t._v("同上一节： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h2",{attrs:{id:"_4-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改配置"}},[t._v("#")]),t._v(" 4.修改配置")]),t._v(" "),s("h3",{attrs:{id:"_4-1-修改application-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-修改application-yml"}},[t._v("#")]),t._v(" 4.1 修改"),s("code",[t._v("application.yml")])]),t._v(" "),s("p",[t._v("同上一节： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h3",{attrs:{id:"_4-2-cacheconfiguration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-cacheconfiguration"}},[t._v("#")]),t._v(" 4.2 CacheConfiguration")]),t._v(" "),s("p",[t._v("开启缓存支持")]),t._v(" "),s("p",[t._v("同上一节： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h3",{attrs:{id:"_4-3-配置ehcache-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置ehcache-xml"}},[t._v("#")]),t._v(" 4.3 配置ehcache.xml")]),t._v(" "),s("p",[t._v("（1）默认自动加载resources目录下的ehcache.xml文件")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ehcache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("noNamespaceSchemaLocation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ehcache.xsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--timeToIdleSeconds 当缓存闲置n秒后销毁 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--timeToLiveSeconds 当缓存存活n秒后销毁 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 缓存配置\n        name:缓存名称。\n        maxElementsInMemory：缓存最大个数。\n        eternal:对象是否永久有效，一但设置了，timeout将不起作用。\n        timeToIdleSeconds：设置对象在失效前的允许闲置时间（单位：秒）。仅当eternal=false对象不是永久有效时使用，可选属性，默认值是0，也就是可闲置时间无穷大。\n        timeToLiveSeconds：设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。仅当eternal=false对象不是永久有效时使用，默认是0.，也就是对象存活时间无穷大。\n        overflowToDisk：当内存中对象数量达到maxElementsInMemory时，Ehcache将会对象写到磁盘中。 diskSpoolBufferSizeMB：这个参数设置DiskStore（磁盘缓存）的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区。\n        maxElementsOnDisk：硬盘最大缓存个数。\n        diskPersistent：是否缓存虚拟机重启期数据 Whether the disk\n        store persists between restarts of the Virtual Machine. The default value\n        is false.\n        diskExpiryThreadIntervalSeconds：磁盘失效线程运行时间间隔，默认是120秒。  memoryStoreEvictionPolicy：当达到maxElementsInMemory限制时，Ehcache将会根据指定的策略去清理内存。默认策略是\nLRU（最近最少使用）。你可以设置为FIFO（先进先出）或是LFU（较少使用）。\n        clearOnFlush：内存数量最大时是否清除。 --\x3e")]),t._v("\n    \n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 磁盘缓存位置 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("diskStore")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("java.io.tmpdir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 默认缓存 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("defaultCache")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxElementsInMemory")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("eternal")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("timeToIdleSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("timeToLiveSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxElementsOnDisk")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10000000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("diskExpiryThreadIntervalSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("memoryStoreEvictionPolicy")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("LRU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("persistence")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("strategy")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("localTempSwap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("defaultCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 测试 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("     \n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("eternal")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("timeToIdleSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2400"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("timeToLiveSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2400"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxEntriesLocalHeap")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxEntriesLocalDisk")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10000000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("diskExpiryThreadIntervalSeconds")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("overflowToDisk")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("memoryStoreEvictionPolicy")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("LRU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ehcache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br")])]),s("p",[t._v("这里配置了一个 cacheName为 user 的cache，实际使用时指定的缓存名称必须是在此配置文件中存在的，否则会抛找不到cache的异常")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@CachePut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#user.name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里的cacheName（即user）必须在ehcache.xml中存在")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" u "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userRepository"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"新增：缓存用户，用户id为:{}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" u"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("（2）对于EhCache的配置文件也可以通过"),s("code",[t._v("application.yml")]),t._v("文件中使用"),s("code",[t._v("spring.cache.ehcache.config")]),t._v("属性来指定，比如：")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ehcache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" classpath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ehcache.xml\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("（3）"),s("strong",[t._v("ehcache.xml配置文件详解")])]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("code",[t._v("diskStore")]),t._v("：为缓存路径，ehcache分为内存和磁盘两级，此属性定义磁盘的缓存位置。")]),t._v(" "),s("li",[s("code",[t._v("defaultCache")]),t._v("：默认缓存策略，当ehcache找不到定义的缓存时，则使用这个缓存策略。只能定义一个。")]),t._v(" "),s("li",[s("code",[t._v("name")]),t._v(":缓存名称。")]),t._v(" "),s("li",[s("code",[t._v("maxElementsInMemory")]),t._v(":缓存最大数目")]),t._v(" "),s("li",[s("code",[t._v("maxElementsOnDisk")]),t._v("：硬盘最大缓存个数。")]),t._v(" "),s("li",[s("code",[t._v("eternal")]),t._v(":对象是否永久有效，一但设置了，timeout将不起作用。")]),t._v(" "),s("li",[s("code",[t._v("overflowToDisk")]),t._v(":是否保存到磁盘，当系统宕机时")]),t._v(" "),s("li",[s("code",[t._v("timeToIdleSeconds")]),t._v(":设置对象在失效前的允许闲置时间（单位：秒）。仅当eternal=false对象不是永久有效时使用，可选属性，默认值是0，也就是可闲置时间无穷大。")]),t._v(" "),s("li",[s("code",[t._v("timeToLiveSeconds")]),t._v(":设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。仅当eternal=false对象不是永久有效时使用，默认是0.，也就是对象存活时间无穷大。")]),t._v(" "),s("li",[s("code",[t._v("diskPersistent")]),t._v("：是否缓存虚拟机重启期数据 Whether the disk store persists between restarts of the Virtual Machine. The default value is false.")]),t._v(" "),s("li",[s("code",[t._v("diskSpoolBufferSizeMB")]),t._v("：这个参数设置DiskStore（磁盘缓存）的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区。")]),t._v(" "),s("li",[s("code",[t._v("diskExpiryThreadIntervalSeconds")]),t._v("：磁盘失效线程运行时间间隔，默认是120秒。")]),t._v(" "),s("li",[s("code",[t._v("memoryStoreEvictionPolicy")]),t._v("：当达到maxElementsInMemory限制时，Ehcache将会根据指定的策略去清理内存。默认策略是LRU（最近最少使用）。你可以设置为FIFO（先进先出）或是LFU（较少使用）。")]),t._v(" "),s("li",[s("code",[t._v("clearOnFlush")]),t._v("：内存数量最大时是否清除。")])])]),t._v(" "),s("h2",{attrs:{id:"_5-业务实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-业务实现"}},[t._v("#")]),t._v(" 5.业务实现")]),t._v(" "),s("p",[t._v("同上一节： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h2",{attrs:{id:"_6-单元测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-单元测试"}},[t._v("#")]),t._v(" 6.单元测试")]),t._v(" "),s("p",[t._v("同上一节： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h1",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"http://blog.720ui.com/2017/springboot_02_data_cache_ehcache/",target:"_blank",rel:"noopener noreferrer"}},[t._v("梁桂钊__Spring Boot 揭秘与实战（二） 数据缓存篇 - EhCache"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/qq_28988969/article/details/78210873",target:"_blank",rel:"noopener noreferrer"}},[t._v("SpringBoot学习－（十八）SpringBoot整合EhCache"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);