(window.webpackJsonp=window.webpackJsonp||[]).push([[273],{1339:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[TOC]")]),t._v(" "),s("h1",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("Spring官方说法：")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://github.com/ben-manes/caffeine",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caffeine"),s("OutboundLink")],1),t._v(" is a Java 8 rewrite of Guava’s cache that supersedes support for Guava.")])]),t._v(" "),s("p",[t._v("关于 caffeine 的介绍可参见：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/mawang/p/6756192.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("是什么让spring 5放弃了使用Guava Cache？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://fengfu.io/2018/03/26/Caffeine-%E6%AF%94Guava-Cache%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%BC%93%E5%AD%98/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caffeine-比Guava Cache更好的缓存"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.itcodemonkey.com/article/9498.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caffeine Cache 进程缓存之王"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html#boot-features-caching-provider-caffeine",target:"_blank",rel:"noopener noreferrer"}},[t._v("spring-boot-features-caching"),s("OutboundLink")],1)])])]),t._v(" "),s("p",[t._v("在  "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")]),t._v("  这一节中，我们了解了 Spring 声明式缓存抽象，知道了：")],1),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("我们使用Spring声明式缓存，使用的是其抽象，无关底层实现。也就是说，不管你底层使用的是什么缓存技术，对Spring声明式缓存的使用是一致的")]),t._v(" "),s("li",[t._v("若想要采用不同的缓存技术，只需要替换掉底层注册的 CacheManager 即可")])])]),t._v(" "),s("p",[t._v("那么，这一节我们将采用 "),s("code",[t._v("caffeine")]),t._v("作为缓存技术，来实现一个Spring声明式缓存的实例，这显然就很简单了，步骤如下：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("引入 "),s("code",[t._v("caffeine")]),t._v(" 依赖")]),t._v(" "),s("li",[t._v("开启缓存支持")]),t._v(" "),s("li",[t._v("配置 caffeine")]),t._v(" "),s("li",[t._v("使用声明式缓存")])])]),t._v(" "),s("p",[t._v("其他步骤同上一步： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h1",{attrs:{id:"一、springboot-整合-caffeine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、springboot-整合-caffeine"}},[t._v("#")]),t._v(" 一、SpringBoot 整合 caffeine")]),t._v(" "),s("h2",{attrs:{id:"_1-创建子模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建子模块"}},[t._v("#")]),t._v(" 1.创建子模块")]),t._v(" "),s("p",[t._v("这里我们创建一个子模块，创建步骤同 "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_01_入门示例.html"}},[t._v("SpringBoot_01_入门示例")])],1),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'com.ray.study'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("artifact")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-caffeine'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h2",{attrs:{id:"_2-引入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-引入依赖"}},[t._v("#")]),t._v(" 2.引入依赖")]),t._v(" "),s("h3",{attrs:{id:"_2-1-继承父工程依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-继承父工程依赖"}},[t._v("#")]),t._v(" 2.1 继承父工程依赖")]),t._v(" "),s("p",[t._v("在父工程"),s("code",[t._v("spring-boot-seeds")]),t._v(" 的 "),s("code",[t._v("settings.gradle")]),t._v("加入子工程")]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rootProject.name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-seeds'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-01-helloworld'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-02-restful-test'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-03-thymeleaf'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-04-swagger2'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-jpa'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-mybatis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-05-tk-mybatis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-06-nosql-redis'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-06-nosql-mongodb'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-concurrentmap'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-ehcache'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("'spring-boot-07-cache-caffeine'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("p",[t._v("这样，子工程"),s("code",[t._v("spring-boot-07-cache-caffeine")]),t._v("就会自动继承父工程中"),s("code",[t._v("subprojects")]),t._v(" `函数里声明的依赖，主要包含如下依赖：")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("\t\timplementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-web'")]),t._v("\n        testImplementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-test'")]),t._v("\n\n        compileOnly "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok'")]),t._v("\n        annotationProcessor "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h3",{attrs:{id:"_2-2-引入ehcache-依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-引入ehcache-依赖"}},[t._v("#")]),t._v(" 2.2 引入"),s("code",[t._v("ehcache")]),t._v(" `依赖")]),t._v(" "),s("p",[t._v("将子模块"),s("code",[t._v("spring-boot-07-cache-caffeine")]),t._v(" 的"),s("code",[t._v("build.gradle")]),t._v("修改为如下内容：")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("dependencies "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// spring-boot-starter-cache  和 caffeine")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-cache'")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.ben-manes.caffeine:caffeine'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mysql 驱动和 jpa")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql:mysql-connector-java'")]),t._v("\n    implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-data-jpa'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h2",{attrs:{id:"_3-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改配置"}},[t._v("#")]),t._v(" 3.修改配置")]),t._v(" "),s("h3",{attrs:{id:"_3-1-修改application-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-修改application-yml"}},[t._v("#")]),t._v(" 3.1 修改"),s("code",[t._v("application.yml")])]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8088")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servlet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context-path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("datasource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置数据源")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver-class-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.mysql.cj.jdbc.Driver\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3306/integrate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jpa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v("useUnicode=true"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&characterEncoding=utf8&serverTimezone=GMT%2B8")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jpa")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置jpa")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("database")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据库类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("show-sql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打印sql语句")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hibernate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ddl-auto")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" update    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载 Hibernate时， 自动更新数据库结构")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" caffeine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache-names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("role\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" maximumSize=300"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("expireAfterWrite=2m\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("p",[t._v("caffeine 配置说明：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("initialCapacity=[integer]: 初始的缓存空间大小")]),t._v(" "),s("li",[t._v("maximumSize=[long]: 缓存的最大条数")]),t._v(" "),s("li",[t._v("maximumWeight=[long]: 缓存的最大权重")]),t._v(" "),s("li",[t._v("expireAfterAccess=[duration]: 最后一次写入或访问后经过固定时间过期")]),t._v(" "),s("li",[t._v("expireAfterWrite=[duration]: 最后一次写入后经过固定时间过期")]),t._v(" "),s("li",[t._v("refreshAfterWrite=[duration]: 创建缓存或者最近一次更新缓存后经过固定的时间间隔，刷新缓存")]),t._v(" "),s("li",[t._v("weakKeys: 打开key的弱引用")]),t._v(" "),s("li",[t._v("weakValues：打开value的弱引用")]),t._v(" "),s("li",[t._v("softValues：打开value的软引用")]),t._v(" "),s("li",[t._v("recordStats：开发统计功能")])])]),t._v(" "),s("h3",{attrs:{id:"_3-2-cacheconfiguration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-cacheconfiguration"}},[t._v("#")]),t._v(" 3.2 CacheConfiguration")]),t._v(" "),s("p",[t._v("开启缓存支持")]),t._v(" "),s("blockquote",[s("p",[t._v("通常SpringBoot默认的keyGenerator 是SimpleKeyGenerator，这个策略是以参数作为key值，如果参数为空的，就会返回SimpleKey[]字符串，这对于很多无参的方法的就有问题了."),s("br"),t._v("\n向Spring容器中重新注册一个实现了 "),s("code",[t._v("org.springframework.cache.interceptor.keyGenerator")]),t._v(" 这个接口的Bean即可，将key值设置为类名+方法名+参数名，这样就不会冲突了")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("study"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springboot07cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("caffeine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableCaching")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Spring cache 配置类\n *\n * @author shira 2019/05/13 18:45\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableCaching")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyGenerator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("caffeineKeyGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KeyGenerator#generate")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringBuilder")]),t._v(" sb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\tsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br")])]),s("h2",{attrs:{id:"_3-其他部分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-其他部分"}},[t._v("#")]),t._v(" 3.其他部分")]),t._v(" "),s("p",[t._v("其他部分（数据库准备、业务实现、单元测试）参加： "),s("RouterLink",{attrs:{to:"/cs/backend/spring/spring-boot/SpringBoot_07_Cache_01_快速入门.html"}},[t._v("SpringBoot_07_Cache_01_快速入门")])],1),t._v(" "),s("h1",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"http://blog.joylau.cn/2017/09/19/SpringBoot-CaffeineCache/",target:"_blank",rel:"noopener noreferrer"}},[t._v("重剑无锋,大巧不工SpringBoot---推荐使用CaffeineCache"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.jianshu.com/p/c72fb0c787fc",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot缓存实战 Caffeine"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);